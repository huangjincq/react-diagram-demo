(this["webpackJsonpreact-diagram-demo"]=this["webpackJsonpreact-diagram-demo"]||[]).push([[0],{122:function(e,t,n){},123:function(e,t,n){},147:function(e,t,n){},151:function(e,t,n){},152:function(e,t,n){"use strict";n.r(t);var c=n(0),o=n.n(c),a=n(31),i=n.n(a),r=(n(147),n(17)),u=n(7),s=n(30),d={canvasRef:null,portRefs:{},nodeRefs:{},scale:1},l=Object(c.createContext)(d),f=l.Provider,b=function(){return Object(c.useContext)(l).scale},j=n(1),p=o.a.memo((function(e){var t=e.children,n=e.portRefs,o=e.nodeRefs,a=e.transform,i=a.scale,r=a.translateX,u=a.translateY,d=Object(c.useState)(null),l=Object(s.a)(d,2),b=l[0],p=l[1],O=Object(c.useRef)(null);Object(c.useEffect)((function(){p(O.current)}),[]);var h=Object(c.useMemo)((function(){return{canvasRef:b,portRefs:n,nodeRefs:o,scale:i}}),[b,n,o,i]);return Object(j.jsx)("div",{id:"diagram-canvas",className:"diagram-canvas",ref:O,style:{transform:"matrix(".concat(i,",0,0,").concat(i,",").concat(r,",").concat(u,")")},children:Object(j.jsx)(f,{value:h,children:t})})}));p.displayName="DiagramCanvas";var O=n(141),h=n(163),v=["INPUT","TEXTAREA"],m={ref:null,throttleBy:0},g=function(e){return[e.clientX,e.clientY]},y=function(e){return Object(c.useCallback)((function(t){e.current&&t===e.current||(e.current=t)}),[e])},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=e.ref,n=Object(c.useRef)(),o=Object(c.useRef)(),a=Object(c.useRef)(),i=Object(c.useRef)({isDragging:!1,start:[0,0],end:[0,0],offset:[0,0]}),r=i.current,s=Object(c.useCallback)((function(e){var c=e.target.tagName;r.isDragging||!(null===t||void 0===t?void 0:t.current.contains(e.target))||v.includes(c)||(r.isDragging=!0,r.end=[0,0],r.offset=[0,0],r.start=g(e),n.current&&n.current(e,Object(u.a)({},r)))}),[t,r,n]),d=Object(c.useCallback)(Object(h.a)((function(e){r.isDragging&&(r.offset=[e.clientX-r.start[0],e.clientY-r.start[1]],o.current&&o.current(e,Object(u.a)({},r)))}),e.throttleBy),[t,r,o]),l=Object(c.useCallback)((function(e){r.isDragging&&(r.isDragging=!1,r.end=g(e),a.current&&a.current(e,Object(u.a)({},r)))}),[r,a]);return Object(c.useEffect)((function(){var e=function(e){return s(e)},n=function(e){return d(e)},c=function(e){return l(e)};return(null===t||void 0===t?void 0:t.current)&&(t.current.addEventListener("mousedown",e),document.addEventListener("mousemove",n),document.addEventListener("mouseup",c)),function(){(null===t||void 0===t?void 0:t.current)&&(t.current.removeEventListener("mousedown",e),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",c))}}),[t,s,d,l]),{ref:t,onDragStart:y(n),onDrag:y(o),onDragEnd:y(a)}},x=n(35),k=n(162),C=n(160),N=(n(89),function(e){var t=e.icon,n=e.label;return Object(j.jsxs)("h4",{className:"node-header",children:[t&&Object(j.jsx)("div",{className:"node-header-icon",children:o.a.createElement(t)}),Object(j.jsx)("div",{className:"node-header-text",children:n})]})});N.displayName="NodeTypeHeader";var D=k.a.Panel,E="A dog is a type",S=function(e){var t=e.value,n=e.onChange;return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(N,{icon:Z.nodeTypeInput.icon,label:Z.nodeTypeInput.label}),Object(j.jsx)(C.a,{value:t.inputValue,onChange:function(e){n(Object(u.a)(Object(u.a)({},t),{},{inputValue:e.target.value}))},placeholder:"Basic usage"}),Object(j.jsxs)(k.a,{defaultActiveKey:["1"],children:[Object(j.jsx)(D,{header:"This is panel header 1",children:Object(j.jsx)("p",{children:E})},"1"),Object(j.jsx)(D,{header:"This is panel header 2",children:Object(j.jsx)("p",{children:E})},"2"),Object(j.jsx)(D,{header:"This is panel header 3",children:Object(j.jsx)("p",{children:E})},"3")]})]})};S.displayName="NodeTypeInput";var T=n(158),R=function(e){var t=e.value,n=e.onChange;return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(N,{icon:Z.nodeTypeSelect.icon,label:Z.nodeTypeSelect.label}),Object(j.jsxs)(T.a,{style:{width:120},value:t.selectValue,onChange:function(e){n(Object(u.a)(Object(u.a)({},t),{},{selectValue:e}))},children:[Object(j.jsx)(T.a.Option,{value:"jack",children:"Jack"}),Object(j.jsx)(T.a.Option,{value:"lucy",children:"Lucy"}),Object(j.jsx)(T.a.Option,{value:"disabled",disabled:!0,children:"Disabled"}),Object(j.jsx)(T.a.Option,{value:"Yiminghe",children:"yiminghe"})]})]})};R.displayName="NodeTypeSelect";var I=n(138),w=function(e){var t=e.value;return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(N,{icon:Z.nodeTypeButton.icon,label:Z.nodeTypeButton.label}),t.buttonList.map((function(e,t){return Object(j.jsx)("div",{children:Object(j.jsx)(I.a,{style:{width:"100%"},children:e.text})},t)}))]})};w.displayName="NodeTypeButton";var L,B,M=n(167),H=n(168),V=n(169),Y=n(164),K=n(155);!function(e){e.nodeTypeInput="nodeTypeInput",e.nodeTypeSelect="nodeTypeSelect",e.nodeTypeButton="nodeTypeButton"}(B||(B={}));var Z=(L={},Object(x.a)(L,B.nodeTypeInput,{component:S,label:"Input \u8282\u70b9",icon:M.a}),Object(x.a)(L,B.nodeTypeSelect,{component:R,label:"Select \u8282\u70b9",icon:H.a}),Object(x.a)(L,B.nodeTypeButton,{component:w,label:"Button \u8282\u70b9",icon:V.a}),L),Q=Object.entries(Z).map((function(e){var t=Object(s.a)(e,2),n=t[0],c=t[1];return Object(u.a)(Object(u.a)({},c),{},{type:n})})),z=function(e,t){var n={id:Object(Y.a)(),coordinates:t,type:e,inputs:[],outputs:[],data:{}};switch(e){case B.nodeTypeInput:n=Object(u.a)(Object(u.a)({},n),{},{outputs:[{id:Object(Y.a)(),isLinked:!1}],data:{inputValue:"test"}});break;case B.nodeTypeSelect:n=Object(u.a)(Object(u.a)({},n),{},{outputs:[{id:Object(Y.a)(),isLinked:!1}],data:{inputValue:""}});break;case B.nodeTypeButton:var c={buttonList:[{text:"button-1",id:Object(Y.a)()},{text:"button-2",id:Object(Y.a)()}]},o=c.buttonList.map((function(e){return{id:e.id,isLinked:!1}}));n=Object(u.a)(Object(u.a)({},n),{},{outputs:o,data:c})}return n},P=function(e){var t=Object(K.a)(e);switch(t.id=Object(Y.a)(),t.coordinates=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return[e[0]+t,e[1]+t]}(t.coordinates,20),t.type){case B.nodeTypeInput:case B.nodeTypeSelect:t.outputs.forEach((function(e){e.id=Object(Y.a)(),e.isLinked=!1}));break;case B.nodeTypeButton:t.data.buttonList.forEach((function(e){e.id=Object(Y.a)()})),t.outputs=t.data.buttonList.map((function(e){return{id:e.id,isLinked:!1}}))}return t},F=n(156),W=function(e,t,n){var c=(null===t||void 0===t?void 0:t.getBoundingClientRect())||{x:0,y:0};return[(e.clientX-c.x)/n,(e.clientY-c.y)/n]},U=function e(t){if(!t)return null;var n=t.id,c=t.classList.contains("diagram-node");return n&&c?n:c?null:e(t.parentElement)},X=function(e,t){return t.findIndex((function(t){return t.id===e}))},G=function(e){var t=e,n=t.offsetHeight,c=t.offsetHeight;return{width:n,height:c,left:t.offsetLeft,top:t.offsetTop,right:t.offsetLeft+n,bottom:t.offsetTop+c}},q=function(e,t,n,c){var o=Object(r.a)(n),a=X(e,o),i=t[0]-n[a].coordinates[0],s=t[1]-n[a].coordinates[1];return c.forEach((function(e){o.some((function(t,n){return t.id===e&&(o[n]=Object(u.a)(Object(u.a)({},o[n]),{},{coordinates:[t.coordinates[0]+i,t.coordinates[1]+s]}),!0)}))})),o[a]=Object(u.a)(Object(u.a)({},o[a]),{},{coordinates:t}),o},J=function(e,t){var n=Object(r.a)(e.nodes),c=X(t,n),o=e.nodes[c],a=o.outputs.map((function(e){return e.id})),i=o.inputs.map((function(e){return e.id}));return n.splice(c,1),{links:e.links.filter((function(e){return!i.includes(e.output)&&!a.includes(e.input)&&e.input!==t&&e.output!==t})),nodes:n}},_=function(e){return document.activeElement===e},$=n(5),ee=n.n($),te=o.a.memo((function(e){var t=e.id,n=e.isLinked,o=e.index,a=e.nodeId,i=e.onDragNewSegment,r=e.onSegmentFail,u=e.onSegmentConnect,s=e.onShowSelectModel,d=e.onPortMount,f=e.type,p=Object(c.useContext)(l).canvasRef,O=b(),h=Object(c.useRef)(null),v=Object(c.useRef)(),m=ee()("diagram-port",{"type-input":"input"===f,"type-output":"output"===f,"is-linked":n}),g=A({ref:h,throttleBy:15}),y=g.onDragStart,x=g.onDrag,k=g.onDragEnd;return y((function(e){if(e.stopImmediatePropagation(),e.stopPropagation(),p&&h.current){var t=p.getBoundingClientRect(),n=t.x,c=t.y,o=h.current.getBoundingClientRect(),a=o.x,i=o.y,r=o.width,u=o.height;v.current=[(a-n+r/2)/O,(i-c+u/2)/O]}})),x((function(e){if(v.current){e.stopImmediatePropagation(),e.stopPropagation();var n=W(e,p,O);i(t,v.current,n)}})),k((function(e){var n=e.target;if(n.classList.contains("diagram-port")&&n.id!==t)u(t,n.id);else{var c=U(e.target);if(c&&c!==a)u(t,c);else{var o=document.getElementById("diagram-panel");o&&o.contains(e.target)&&s(e,t),r&&r(t,f)}}})),Object(c.useEffect)((function(){d(t,h.current)}),[t,d]),Object(j.jsx)("div",{className:m,id:t,ref:h,style:{top:0===o?"45%":"calc(45% + ".concat(18*o,"px)")}})})),ne=function(e){var t=e.inputs,n=e.onPortMount,c=e.onDragNewSegment,o=e.onSegmentFail,a=e.onSegmentConnect,i=e.onShowSelectModel,r=e.nodeId,u=e.type;return Object(j.jsx)(j.Fragment,{children:t.map((function(e,t){return Object(j.jsx)(te,{onPortMount:n,onDragNewSegment:c,onSegmentFail:o,onShowSelectModel:i,onSegmentConnect:a,type:u,id:e.id,index:t,isLinked:e.isLinked,nodeId:r},e.id)}))})};ne.displayName="DiagramNodePorts";var ce=n(170),oe=n(171),ae=function(e){var t=e.onNodeDelete,n=e.onNodeCopy,o=e.id,a=Object(c.useCallback)((function(){t(o)}),[o,t]),i=Object(c.useCallback)((function(){n(o)}),[o,n]);return Object(j.jsxs)("div",{className:"diagram-node-action",children:[Object(j.jsx)(I.a,{onClick:i,icon:Object(j.jsx)(ce.a,{})}),Object(j.jsx)(I.a,{onClick:a,icon:Object(j.jsx)(oe.a,{})})]})};ae.displayName="DiagramNodeActionButtons";var ie=n(134),re=n(135),ue=function(){function e(){Object(ie.a)(this,e),this.es={}}return Object(re.a)(e,[{key:"on",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.es[e]||(this.es[e]=[]),this.es[e].push({cb:t,once:n})}},{key:"once",value:function(e,t){this.on(e,t,!0)}},{key:"fire",value:function(e){for(var t=this.es[e]||[],n=t.length,c=arguments.length,o=new Array(c>1?c-1:0),a=1;a<c;a++)o[a-1]=arguments[a];for(var i=0;i<n;i++){var r=t[i],u=r.cb,s=r.once;u.apply(this,o),s&&(t.splice(i,1),i--,n--)}}},{key:"off",value:function(e,t){if(void 0===e)this.es={};else if(void 0===t)delete this.es[e];else for(var n=this.es[e]||[],c=n.length,o=0;o<c;o++)n[o].cb===t&&(n.splice(o,1),o--,c--)}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),c=1;c<t;c++)n[c-1]=arguments[c];this.fire.apply(this,[e].concat(n))}}]),e}();ue.ver="__VERSION__";var se="NODE_MOVING",de="NODE_MOVE_END",le="AUTO_LAYOUT",fe=new ue,be=o.a.memo((function(e){var t,n=e.nodeInfo,a=e.onNodeValueChange,i=e.onNodePositionChange,r=e.onPortMount,s=e.onDragNewSegment,d=e.onNodeMount,l=e.onSegmentFail,f=e.onSegmentConnect,p=e.onShowSelectModel,O=e.onAddHistory,h=e.onToggleActiveNodeId,v=e.isActive,m=e.onNodeDelete,g=e.onNodeCopy,y=n.id,x=n.coordinates,k=n.type,C=n.inputs,N=n.data,D=n.outputs,E=b(),S=null===(t=Z[k])||void 0===t?void 0:t.component,T={value:N,onChange:function(e){a(y,e)}},R=Object(c.useRef)(null),I=A({throttleBy:14,ref:R}),w=I.onDragStart,L=I.onDrag,B=I.onDragEnd,M=Object(c.useRef)(x);w((function(){M.current=x})),L((function(e,t){e.stopImmediatePropagation(),e.stopPropagation();var n=[M.current[0]+t.offset[0]/E,M.current[1]+t.offset[1]/E];i(y,n),fe.emit(se,y,n)})),B((function(e){Object(F.a)(M.current,x)||O(y,M.current),fe.emit(de)}));var H=Object(c.useCallback)((function(e){e.shiftKey&&h(y)}),[y,h]),V={nodeId:y,onPortMount:r,onDragNewSegment:s,onSegmentFail:l,onSegmentConnect:f,onShowSelectModel:p};Object(c.useEffect)((function(){d(y,R.current)}),[y,d]);var Y=Object(c.useMemo)((function(){return ee()("diagram-node",{active:v})}),[v]);return Object(j.jsxs)("div",{id:y,className:Y,ref:R,style:{left:Math.floor(x[0]),top:Math.floor(x[1])},onClick:H,children:[S&&o.a.createElement(S,T),Object(j.jsx)(ne,Object(u.a)(Object(u.a)({inputs:C},V),{},{type:"input"})),Object(j.jsx)(ne,Object(u.a)(Object(u.a)({inputs:D},V),{},{type:"output"})),Object(j.jsx)(ae,{id:y,onNodeDelete:m,onNodeCopy:g})]})}));be.displayName="DiagramNode";var je=o.a.memo((function(e){var t=e.nodes,n=e.activeNodeIds,c=Object(O.a)(e,["nodes","activeNodeIds"]);return Object(j.jsx)(j.Fragment,{children:t.map((function(e){return Object(j.jsx)(be,Object(u.a)({isActive:n.includes(e.id),nodeInfo:e},c),e.id)}))})}));je.displayName="NodesCanvas";var pe=function(e){return[Math.floor(e[0]),Math.floor(e[1])]},Oe=function(e,t){var n,c=[(t[0]+e[0])/2,e[1]],o=[(t[0]+e[0])/2,t[1]];return"M ".concat(e[0],",").concat(e[1]," C ").concat((n=[c,o],n.map((function(e){return"".concat(e[0],",").concat(e[1])})).join(" "))," ").concat(t[0],",").concat(t[1])},he=function(e,t){var n=(e[0]+t[0])/2,c=(e[1]+t[1])/2;return"M".concat(e[0],",").concat(e[1]," ").concat(e[0]+20,",").concat(e[1]," C ").concat(e[0]+100,",").concat(e[1]," ").concat(e[0]+130,",").concat((c+e[1])/2,"  ").concat(n,",").concat(c," C ").concat(n,",").concat(c," ").concat(t[0]-130,",").concat((c+t[1])/2," ").concat(t[0]-2,",").concat(t[1]," M ").concat(t[0]-2,",").concat(t[1]," ").concat(t[0],",").concat(t[1])},ve=function(e,t){if(!e||!t)return"";var n,c,o=pe(e),a=pe(t);return n=o,(c=a)[0]>=n[0]?Oe(n,c):he(n,c)},me=o.a.memo((function(e){var t=e.input,n=e.output,o=e.link,a=e.onDelete,i=Object(c.useRef)(null),r=Object(c.useMemo)((function(){return function(e,t){var n=Math.abs(t[0]-e[0]),c=Math.abs(t[1]-e[1]),o=0,a=0,i={x:0,y:0},r={x:0,y:0};return t[0]>e[0]?(o=e[0],i.x=0,r.x=n):(o=t[0],i.x=n,r.x=0),t[1]>e[1]?(a=e[1],i.y=0,r.y=c):(a=t[1],i.y=c,r.y=0),{width:Math.floor(n)||1,height:Math.floor(c)||1,left:Math.floor(o),top:Math.floor(a),start:[i.x,i.y],end:[r.x,r.y]}}(t,n)}),[t,n]),u=r.width,s=r.height,d=r.left,l=r.top,f=r.start,b=r.end,p=Object(c.useMemo)((function(){return ve(f,b)}),[f,b]),O=Object(c.useCallback)((function(){a(o)}),[a,o]),h=Object(c.useCallback)((function(){var e;null===(e=i.current)||void 0===e||e.classList.add("hover")}),[]),v=Object(c.useCallback)((function(){var e;null===(e=i.current)||void 0===e||e.classList.remove("hover")}),[]);return Object(j.jsxs)("svg",{ref:i,className:"diagram-link",style:{left:d,top:l},width:u,height:s,pointerEvents:"none",children:[Object(j.jsx)("path",{d:p,className:"bi-link-path"}),Object(j.jsx)("path",{d:p,className:"bi-link-ghost",onDoubleClick:O,onMouseOver:h,onMouseOut:v})]})}),(function(e,t){return Object(F.a)(e,t)}));me.displayName="Link";var ge=function(e,t,n,c){for(var o=0;o<t.length;o++){if(t[o].id===n){var a=c[n];return a?[e[0]+a.offsetLeft+a.offsetWidth,e[1]+a.offsetTop+a.offsetHeight/2]:null}}return null},ye=function(e,t,n,c,o){for(var a=0;a<e.length;a++){var i=e[a];if(i.id===t){var r=n[t];return r?[i.coordinates[0],i.coordinates[1]+r.offsetHeight/2]:null}var u=ge(i.coordinates,i.inputs,t,c);if(u)return u;var s=ge(i.coordinates,i.outputs,t,c);if(s)return s}return null},Ae=o.a.memo((function(e){var t=e.nodes,n=e.onDelete,o=e.links,a=Object(c.useContext)(l),i=a.canvasRef,r=a.portRefs,u=a.nodeRefs,s=Object(c.useMemo)((function(){var e=[];return o.forEach((function(n){var c=n.input,o=n.output,a=ye(t,c,u,r),i=ye(t,o,u,r);a&&i&&e.push({link:n,startCoordinates:a,endCoordinates:i})})),e}),[t,o,u,r,i]);return Object(j.jsx)(j.Fragment,{children:s.map((function(e){return Object(j.jsx)(me,{link:e.link,input:e.startCoordinates,output:e.endCoordinates,onDelete:n},"".concat(e.link.input,"-").concat(e.link.output))}))})}));Ae.displayName="LinksCanvas";var xe=o.a.memo((function(e){var t=e.segment,n=t.from,o=t.to,a=t.id,i=Object(c.useMemo)((function(){return ve(n,o)}),[n,o]);return Object(j.jsx)("svg",{className:"diagram-segment-canvas",children:Object(j.jsxs)("g",{className:"diagram-segment-link",id:a,children:[Object(j.jsx)("path",{d:i}),Object(j.jsx)("circle",{r:"5",cx:o[0],cy:o[1]})]})})}));xe.displayName="Segment";n(151);var ke=function(e){var t=Object(c.useRef)(e);return Object(c.useLayoutEffect)((function(){t.current=e})),Object(c.useMemo)((function(){return function(){var e=t.current;return e.apply(void 0,arguments)}}),[])},Ce=function(e){var t=e.type,n=e.onChange,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(c.useEffect)((function(){return fe.on(t,n),function(){fe.off(t,n)}}),[t,n,o])},Ne=function(e){var t=e,n=t.offsetWidth,c=t.offsetHeight;return{width:n,height:c,left:t.offsetLeft,top:t.offsetTop,right:t.offsetLeft+n,bottom:t.offsetTop+c}},De=function(e,t){return Math.abs(e-t)<=3},Ee=o.a.memo((function(e){var t=e.onNodePositionChange,n=Object(c.useRef)(null),o=Object(c.useCallback)((function(){n.current&&n.current.childNodes.forEach((function(e){var t=e;"visible"===t.style.visibility&&(t.style.visibility="hidden")}))}),[n]),a=Object(c.useCallback)((function(e,c){o();var a=document.getElementById(e);if(a){var i=Ne(a);Array.from(document.querySelectorAll(".diagram-node")).forEach((function(o){if(e!==o.id){var a,u,s,d,l,f,b,j,p=Ne(o),O=p.top,h=p.left,v=p.bottom,m=p.right,g={top:[{isNearly:De(i.top,O),lineNode:null===(a=n.current)||void 0===a?void 0:a.childNodes[0],line:"x-top",dragShift:O,lineShift:O},{isNearly:De(i.bottom,O),lineNode:null===(u=n.current)||void 0===u?void 0:u.childNodes[0],line:"x-top",dragShift:O-i.height,lineShift:O},{isNearly:De(i.top,v),lineNode:null===(s=n.current)||void 0===s?void 0:s.childNodes[1],line:"x-bottom",dragShift:v,lineShift:v},{isNearly:De(i.bottom,v),lineNode:null===(d=n.current)||void 0===d?void 0:d.childNodes[1],line:"x-bottom",dragShift:v-i.height,lineShift:v}],left:[{isNearly:De(i.left,h),lineNode:null===(l=n.current)||void 0===l?void 0:l.childNodes[2],line:"y-left",dragShift:h,lineShift:h},{isNearly:De(i.right,h),lineNode:null===(f=n.current)||void 0===f?void 0:f.childNodes[2],line:"y-left",dragShift:h-i.width,lineShift:h},{isNearly:De(i.left,m),lineNode:null===(b=n.current)||void 0===b?void 0:b.childNodes[3],line:"y-right",dragShift:m,lineShift:m},{isNearly:De(i.right,m),lineNode:null===(j=n.current)||void 0===j?void 0:j.childNodes[3],line:"y-right",dragShift:m-i.width,lineShift:m}]};Object.keys(g).forEach((function(n){g[n].forEach((function(o){if(o.isNearly){o.lineNode&&(o.lineNode.style[n]="".concat(o.lineShift,"px"),o.lineNode.style.visibility="visible");var a=Object(r.a)(c);a="top"===n?[c[0],o.dragShift]:[o.dragShift,c[1]],Object(F.a)(a,c)||t(e,a)}}))}))}}))}}),[o,t]);return Ce({type:se,onChange:a}),Ce({type:de,onChange:o}),Object(j.jsxs)("div",{className:"mark-line",ref:n,children:[Object(j.jsx)("div",{className:"mark-line-item x-direction","data-mark-line-id":"x-top"}),Object(j.jsx)("div",{className:"mark-line-item x-direction","data-mark-line-id":"x-bottom"}),Object(j.jsx)("div",{className:"mark-line-item y-direction","data-mark-line-id":"y-left"}),Object(j.jsx)("div",{className:"mark-line-item y-direction","data-mark-line-id":"y-right"})]})}));Ee.displayName="MarkLine";var Se=o.a.memo((function(e){var t=e.position,n=e.onChange;if(!t)return null;var c=function(e){n(e.currentTarget.dataset.type)};return i.a.createPortal(Object(j.jsx)("div",{className:"select-model",onClick:function(){n()},children:Object(j.jsx)("ul",{className:"select-model-content",style:{left:t[0],top:t[1],position:"absolute"},onClick:function(e){e.stopPropagation()},children:Q.map((function(e){return Object(j.jsxs)("li",{className:"select-model-item",onClick:c,"data-type":e.type,children:[e.icon&&o.a.createElement(e.icon),Object(j.jsx)("div",{className:"select-model-text",children:e.label})]},e.type)}))})}),document.body)}));Se.displayName="SelectModel";var Te=n(161),Re=n(166),Ie=n(157),we=function(e,t){for(var n=0;n<e.length;n++){if(e[n].id===t)return!0}return!1},Le=function(e,t){for(var n=0;n<t.length;n++){var c=t[n];if(c.id===e)return c.id;if(we(c.inputs,e))return c.id;if(we(c.outputs,e))return c.id}return e};function Be(e,t){var n=e.links,c=void 0===n?[]:n,o=e.nodes,a=1,i=(void 0===o?[]:o).map((function(e){return Object(u.a)(Object(u.a)({},e),{},{row:0,column:0,style:G(t[e.id])})})),s=function e(t,n,c,o,i){if(!i.includes(t)){i.push(t);var r=c.find((function(e){return e.id===Le(t,c)}));if(r){r.row=r.row||a,r.column=r.column||n,n++;var u=0;r.outputs.forEach((function(t){var r=o.find((function(e){return e.input===t.id}));r&&(++u>1&&a++,e(r.output,n,c,o,i))}))}}};c.forEach((function(e){if(function(e,t,n){return!t.find((function(t){return t.output===Le(e,n)}))}(e.input,c,i)){var t=Le(e.input,i),n=[t],o=i.find((function(e){return e.id===t}));if(!o)return;o.row=o.row||a,o.column=1,s(e.output,2,i,c,n),a++}})),i.forEach((function(e){0===e.row&&(e.row=a,e.column=1,a++)})),Object(r.a)(i).forEach((function(e){var t=e.outputs,n=[];t.forEach((function(e){if(e.isLinked){var t=c.find((function(t){return t.input===e.id}));t&&n.push(t.output)}})),i.sort((function(e,t){return n.findIndex((function(t){return e.id===t}))-n.findIndex((function(e){return t.id===e}))}))}));var d=100,l=100,f=Object(Te.a)(i,(function(e){return e.row})),b=Object.values(f),j=l;b.forEach((function(e,t){e.sort((function(e,t){return e.column-t.column})),e.forEach((function(e,n){if(0===n&&t>0){var c=b[t-1].filter((function(t){return t.column>=e.column})).map((function(e){return e.style.height})),o=Object(Re.a)(c)||0;j+=o+50}e.column&&(e.coordinates=[250*(e.column-1)+d,j])}))}));var p=i.map((function(e){return Object(u.a)({},Object(Ie.a)(e,"column","row","style"))}));return{links:c,nodes:p}}var Me=function(e){return Number(e.toFixed(2))},He=function(e){var t=e.originNodes,n=e.futureNodes,c=e.animationFn,o=e.stepCount;return new Promise((function(e,a){try{var i=0,r=function(e,t,n){return e.map((function(e){var c=t.find((function(t){return t.id===e.id})),o=c?Me((c.coordinates[0]-e.coordinates[0])/n):0,a=c?Me((c.coordinates[1]-e.coordinates[1])/n):0;return Object(u.a)(Object(u.a)({},e),{},{xStep:o,yStep:a})}))}(t,n,o);requestAnimationFrame((function t(){i+=1;var a=(r=r.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{coordinates:[e.coordinates[0]+e.xStep,e.coordinates[1]+e.yStep]})}))).map((function(e){return Object(u.a)({},Object(Ie.a)(e,["xStep","yStep"]))}));c(a),i<o?requestAnimationFrame(t):(c(n),e(n))}))}catch(s){a(s)}}))},Ve=o.a.memo((function(e){var t=e.value,n=e.onChange,o=e.onAddHistory,a=e.transform,i=e.activeNodeIds,d=e.onToggleActiveNodeId,l=Object(c.useState)(),f=Object(s.a)(l,2),b=f[0],O=f[1],h=Object(c.useState)(),v=Object(s.a)(h,2),m=v[0],g=v[1],y=Object(c.useRef)({}).current,A=Object(c.useRef)({}).current,x=Object(c.useRef)(),k=Object(c.useRef)(!1),C=ke((function(e,c){var o=q(e,c,t.nodes,i);n(Object(u.a)(Object(u.a)({},t),{},{nodes:o}),!0)})),N=ke((function(e,c){var o=Object(r.a)(t.nodes),a=X(e,o);o[a]=Object(u.a)(Object(u.a)({},o[a]),{},{data:c}),n(Object(u.a)(Object(u.a)({},t),{},{nodes:o}))})),D=ke((function(e,n){var c=q(e,n,t.nodes,i);o(Object(u.a)(Object(u.a)({},t),{},{nodes:c}))})),E=ke((function(e){var c=X(e,t.nodes),o=P(t.nodes[c]);n(Object(u.a)(Object(u.a)({},t),{},{nodes:[].concat(Object(r.a)(t.nodes),[o])}))})),S=ke((function(e){var c=J(t,e);n(c)})),T=ke((function(e,t){y[e]=t})),R=ke((function(e,t){A[e]=t})),I=Object(c.useCallback)((function(e,t,n){O({id:"segment-".concat(e),from:t,to:n})}),[]),w=Object(c.useCallback)((function(){O(void 0)}),[]),L=ke((function(e,t){x.current=t,g([e.clientX,e.clientY]),O(void 0)})),B=ke((function(e,c){if(!(t.links.findIndex((function(t){return t.input===e&&t.output===c}))>-1)){var o=[].concat(Object(r.a)(t.links),[{input:e,output:c}]);n(Object(u.a)(Object(u.a)({},t),{},{links:o}))}O(void 0)})),M=ke((function(e){var c=t.links.filter((function(t){return!Object(F.a)(t,e)}));n(Object(u.a)(Object(u.a)({},t),{},{links:c}))})),H=ke((function(e){if(e&&m){var c=W({clientX:m[0],clientY:m[1]},document.getElementById("diagram-canvas"),a.scale),o=z(e,c);n(Object(u.a)(Object(u.a)({},t),{},{nodes:[].concat(Object(r.a)(t.nodes),[o])})),setTimeout((function(){B(x.current||"",o.id)}),20)}g(void 0)})),V=Object(c.useCallback)((function(){var e,c=Be(t,A);if(e=t.nodes,c.nodes.some((function(t){var n=t.id,c=t.coordinates,o=e.find((function(e){return e.id===n}));return!o||!Object(F.a)(o.coordinates,c)}))&&!k.current){var a={originNodes:t.nodes,futureNodes:c.nodes,animationFn:function(e){return n(Object(u.a)(Object(u.a)({},c),{},{nodes:e}),!0)},stepCount:60};k.current=!0,He(a).then((function(){o(t)})).finally((function(){return k.current=!1}))}}),[t,A,n,o,k]);return Ce({type:le,onChange:V}),Object(j.jsxs)(p,{portRefs:y,nodeRefs:A,transform:a,children:[Object(j.jsx)(je,{nodes:t.nodes,onNodeMount:R,onPortMount:T,onDragNewSegment:I,onSegmentFail:w,onShowSelectModel:L,onNodePositionChange:C,onNodeValueChange:N,onNodeDelete:S,onNodeCopy:E,onSegmentConnect:B,onAddHistory:D,onToggleActiveNodeId:d,activeNodeIds:i}),t.links.length>0&&Object(j.jsx)(Ae,{nodes:t.nodes,links:t.links,onDelete:M}),b&&Object(j.jsx)(xe,{segment:b}),Object(j.jsx)(Ee,{onNodePositionChange:C}),Object(j.jsx)(Se,{position:m,onChange:H})]})}));Ve.displayName="Diagram";var Ye={past:[],present:null,future:[]},Ke=function(e,t){var n=e.past,c=e.present,o=e.future,a=t.newPresent;switch(t.type){case"UNDO":var i=n[n.length-1];return{past:n.slice(0,n.length-1),present:i,future:[c].concat(Object(r.a)(o))};case"REDO":var s=o[0],d=o.slice(1);return{past:[].concat(Object(r.a)(n),[c]),present:s,future:d};case"SET":return{past:Object(r.a)(n),present:a,future:[]};case"SET_WIDTH_HISTORY":return a===c?e:{past:[].concat(Object(r.a)(n),[c]),present:a,future:[]};case"ADD_A_HISTORY":return a===c?e:{past:[].concat(Object(r.a)(n),[a]),present:c,future:[]};case"CLEAR":var l=t.initialPresent;return Object(u.a)(Object(u.a)({},Ye),{},{present:l})}},Ze=n(165),Qe=(n(122),/macintosh|mac os x/i.test(navigator.userAgent)?"CMD":"Ctrl"),ze=[{text:"\u64a4\u9500",hotKeys:[{key:Qe},{key:"Z"}]},{text:"\u591a\u9009",hotKeys:[{key:"Shift"},{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAE8ElEQVRoQ+2ZbWibVRTH/+c+6YugTKjMTVaoTBRBcFBRHCpVvw3FJmkc7sv8IO1sm3RTaZNqWdyHPunswCVrXQu6itjh0jRxU/ZpWFEYsk0niqK2UFDsVrYxcYy+5LlHbmpqDGlznydFWmy/tfe8/H/3nHse7i1hjf9QKfobAqHzyn8kaj5USpxSfIsC+Hw+Ix6PW4WSrHoAd0voGSHYOzd7reXU4ODNfIhVDeALh8v56kwKRBsl0zfzs1fa8iFWNYDa7fo9wRqjjAaIUCUZ56/9ObV3bGhoJluJVQ+QD8GSzonL5W3xeHhOra0JgByIo0S4QzKPjcYiry01Odx7Oh8QLmxj4hoibGCGC8zXSdAkW/SdMf3Lt0sNBSfTqOgUygZ9rvn16jIXH5YkzdHDkXO5ydSkkpu2Pg/gBSK6azkhDFwH4yNhVRyP94dvOBGd66MNoJwKjVR3c/v9hss4AODuQmKYuR+SbzCJGiKuI6KNyo4ZVyRgJmPm56VA2ALIT+RuDT4lBHUT4FpKRBrclIpGLmTX3c0djwlD+ImwdQGE+xOxyHtOIQoCZA9nftDcL25GiEv0Lide+ecDZCspN9/TRsCujA3zoVQsctwJhCMAz97OzWTJYSK6rVjSQgBZH28gtJsAPysGi5pH+7q/LhYvf91RC3kCoR4BPK2TbDkA5e8JdB4Q4B0MnhRTEzvtTijbAO6W0L2GgWEd8Uu10L8mWHP4VmnMnFLVTEvZlTrSc1o3trKzDeBtDQVJoEE3SbEKqDje1mAjCWpk4GIiar6kG9sZQCD0KQF36ibRAfD427cIMlIZQemKOjvfB1sV8DV2bOBKcUZXvE4LLR5ofyhJhGrLgj/ZZ57VzWELwO3veNAg8a5ucDsAnkAoKoDtsBAe6TM/0c1hC6A+EKx1gQZ0g9sCaA3uF4KeZSCWiJrv6+ZYhQA8mIhGBtcBCu1AtoXUR4csGtLZJQs4m+wzrxaz9Sy20H9QAQZfSEQjTcVE2VlfB9DZrZwWWq9A/oatt9D/q4UYE4mYuVMHWtdmsYUkm4kjkYSun60v8d8X+A+YcTMRM5/QTaJj520NDpCgWkjZNWLjTmALwLdv3y1sVX6hBFlz8zuSR3undcTp2Hj9wc/UpcYCvZiMdn+v4+P0PvAhAfcx86GEw4t4vrj6l4O1rjIaYNCsmCp/MvvypwNhqwIq4OLtifGruDTeYPcOW0iUxx/sFUR1EjgzGjU7dIRnbWwDuFtCVcKgkwSuWIkq5N4x0vPclHrnnzckHRDbAJkqBEKvqDcddZilZTUl+w/+qJMs32ZhM/gYQT1H0lcj0e4Wu3EcAajDLNOVw+oKmHkilAgk+8yf7STPiBfoVy90aiMY1q7R2MHf7MRwdIizCRb+d4BjanJkKgG87bo0/rHOmaj3tz9skLE/8zjAsCxLvprs7/nSrviSAJSzeiMSgmNEVKV+Z+AnCXnCNYOx+GDPH7mCfL5weXrT7KPE8AqB7Rn7BfCuUh54HbVQrjDVCobAGyA8nvt3Bi4T6HcQWyxxO4irCVSRtWHGDxbSb6Zib0042XnHU2ipZGqWizLaLRiPgGAsZaeEk8QJmh4/rdNuxeBKrkChycKwtgkyagDekulTommL5aSYMy6ODnZPFRNlZ33FAewkXwnbdYCV2MVSYqxXoJTdWwnfNV+BvwALEYtPTIIeoAAAAABJRU5ErkJggg=="}]},{text:"\u91cd\u505a",hotKeys:[{key:Qe},{key:"Shift"},{key:"Z"}]},{text:"\u5168\u9009",hotKeys:[{key:Qe},{key:"A"}]},{text:"\u590d\u5236",hotKeys:[{key:Qe},{key:"C"}]},{text:"\u7f29\u653e",hotKeys:[{icon:"data:image/png;base64,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"}]},{text:"\u7c98\u8d34",hotKeys:[{key:Qe},{key:"V"}]},{text:"\u79fb\u52a8\u753b\u5e03",hotKeys:[{key:"Space"},{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAFiUlEQVRoQ+2Zf2hbVRTHzzkvbVNxWFEclQ4L/kJRLEwGGwjCZLAxMT8WpkNh+8N2tEnbqbRJEFfYTLLZuZH0hwuoFXQiaX6IIuyPgsoUNiwIE8fKKsrAlTFBmbq2y7tH7mtfeE1/vNs0td1o/0pz3zvnfO75nnPfO0G4xf/wFo8flAHcgc6nUDj+zPS+/dtqglYCkMETUAIA/mVBTasJwhbADB4R7pA7zwzXVhPEggDultA9SPAmIm9AwHoDAOAiM/yqOcYPp44fv7HScrLNgAxwV0toJ2jQJT/ngZty8djwSgdu+r/9AKTmWfC9ud6jQyalq6Vjq0bUJv8XSOFsPPKTueb1B73M2g8rVdgzMlDoNiySPKkZAJqj8nqqr+tvq2R8jZ136aAZRY1OfgkYtq1UYRcAiruNGTADJ9PxWNIK4PEHDxLh89bv7LqThE4lj/xV7topAOzyh+JAsKXYgSqA0aEEJ9M9saSnMVyLVbqLATchQD0iritsCMM1QDgvQJxx5KuHirO7WMACgO/AgWqhOxMI0MAAP7Lgy0ZQiF9nE9FvrIbdLZ0vIGKDISHCRxDgUcH8KWh0CnVoQ+TnZm8ETiBw1cys8XUAPEVjVR+lUl2Tiw3e8D9D2yaEDrnB3uiX5ppxHlTgA0ZNTFaOWHfN2xpsZIZ1LPAiEXSYB95cmaQrzoGbd/+zQaukzUC0XYJPH46XWFBnKY1gVhuVmchPOjdke6MjZhALnQOu/cF6qIDNDsTXF9rBuaToag5u0xzYhgDrmfm6QApYO5xKRpZ8DrhbQju16UNusQDyepldIu5GxCeNRqDhvsyJyBWV4GdJqPgm9/437kNnZR3qYgsi7p1ax25BMKLhjQs6V9egzp/NJ5sZep+jm5nrRv3lnQOI8CAzn08nYvvKAmAtbKtBWbCZROyYpzV0hAC2qjibS0LW+zzt4VoUMCgLXdehK2upwYXs20qoGKIQfKCjjlDLqQRvFOoCGTBteP3BRiSUTeFSOhF9UcW2LYA0YkIw8wW58/I7byD0KiI0qThRBXDtba9xrKs+DQiarsMeayOZz48SgAHh66q09mpvIPihLLxyAkhbnkCojxA2scAT6Z7Ix3b2lQGKDXkDoW9Vite8T0VCRmZbg40I2CgAv8rEI28tC4DMBtdOfG9nXLULWa8zzxwGHk7HY7YSLSkD8lmHnPzFcgC4WoMbHYAn1wAW2t3bKgOD8ejTi5GS3bX/u4TWAIpSspYBO40ap6Wlja5JaE1CKpopusb6KIHa+DPlnJHu8nduB6JDy3oSTz10hb+TLx/58fzuXPKd0RL2Yc5bvP7wy0jcLgQMZXqinXZ2S3oWmgIIfSKnCjqIQ9n4kc/tHKmuewLBbkJ8lhn70onIB3b3lQ7gD7ch8SuC4VwmEW22c6Sy7mvuulM4xk8jYFX+Jjfl+u2n4CUDuFvDT2jAAzIw1bcnOwjzLY+Z/6Cx0R2pVEq3u6dkAKuM5CSPrlxqUnE4X0ByAkIVFYPyJckcUdoFL9eXBCAHwhrS+9IQA5xKx6PvqjgtvmZ6rHISER5n4N9Jm9it2tmWBDCdhdcQYI8BwTxAY6P9i8mE1L3umDhBAA3AoOdBD+QSR8+pbsSSAXw+n6avfyhCZM6H8CzfFMfS/bFf7IJwt4Q2k8YhBLzfqCWGSDYRzdjdZ11fMoA0ZkDUPnyQgHdMyynPzGcE8xDm9eHse91XTaeeQEcdI24kRpc51WDACaFzVHWYVXYA06B8IWcN2hGgxuqEjd8G+Sri1E7PWGP4WQg4rDIDmiszZcmA1bDRy2nSBcSF8fksxwy6QDjLDOni3x4WI58ldyE7Z3LyDJp4TNOphpGrkHFCJ3HZ4ZgcUe0ydj7KngE7h+Vev+UB/gN5EApeyCXHVgAAAABJRU5ErkJggg=="}]},{text:"\u5220\u9664",hotKeys:[{key:"Del"}]}],Pe=o.a.memo((function(){return Object(j.jsx)("ul",{className:"shortcuts-panel",children:ze.map((function(e,t){return Object(j.jsxs)("li",{className:"shortcuts-panel-item",children:[Object(j.jsxs)("div",{className:"shortcuts-panel-title",children:[e.text," :"]}),Object(j.jsx)("div",{className:"shortcuts-panel-list",children:e.hotKeys.map((function(t,n){return Object(j.jsxs)(o.a.Fragment,{children:[n>0&&Object(j.jsx)("span",{className:"shortcuts-panel-plus",children:"+"}),Object(j.jsxs)("div",{className:"shortcuts-panel-key",children:[t.key,t.icon&&Object(j.jsx)("img",{className:"shortcuts-panel-icon",src:t.icon,alt:e.text})]})]},n)}))})]},t)}))})})),Fe=o.a.memo((function(e){var t=e.undo,n=e.redo,o=e.canUndo,a=e.canRedo,i=e.scale,r=Object(c.useCallback)((function(){fe.emit(le)}),[]);return Object(j.jsxs)("div",{className:"toolbar",children:[Object(j.jsxs)(I.a,{disabled:!0,children:[100*i,"%"]}),Object(j.jsx)(I.a,{disabled:!o,onClick:t,children:"\u64a4\u9500"}),Object(j.jsx)(I.a,{disabled:!a,onClick:n,children:"\u91cd\u505a"}),Object(j.jsx)(Ze.a,{trigger:"click",placement:"right",content:Object(j.jsx)(Pe,{}),overlayClassName:"scale-popover",children:Object(j.jsx)(I.a,{children:"\u5feb\u6377\u952e"})}),Object(j.jsx)(I.a,{onClick:r,children:"\u81ea\u52a8\u6392\u5217"})]})})),We=(n(123),o.a.memo((function(e){var t=e.icon,n=e.label,a=e.type,i=Object(c.useCallback)((function(e){var t;null===(t=e.dataTransfer)||void 0===t||t.setData("nodeType",a)}),[a]);return Object(j.jsxs)("div",{className:"node-list-item",draggable:!0,onDragStart:i,children:[t&&o.a.createElement(t),Object(j.jsx)("div",{className:"node-list-text",children:n})]})})));We.displayName="NodeListItem";var Ue=Object(c.memo)((function(){return Object(j.jsx)("div",{className:"node-list",children:Q.map((function(e){return Object(j.jsx)(We,{icon:e.icon,type:e.type,label:e.label},e.type)}))})}));Ue.displayName="NodeList";var Xe=n(55);var Ge,qe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document,o=arguments.length>3?arguments[3]:void 0,a=Object(c.useRef)();Object(c.useEffect)((function(){a.current=t}),[t]),Object(c.useEffect)((function(){if(n&&n.addEventListener){var t=function(e){return a.current(e)};return n.addEventListener(e,t,o),function(){n.removeEventListener(e,t)}}}),[e,n,o])},Je=.1,_e="DEFAULT",$e="START",et="MOVE",tt="SELECTION",nt=(Ge={},Object(x.a)(Ge,_e,"default"),Object(x.a)(Ge,tt,"default"),Object(x.a)(Ge,$e,"grab"),Object(x.a)(Ge,et,"grabbing"),Ge),ct={links:[{input:"port-1",output:"node-2"},{input:"port-5",output:"841e9704-c295-4915-8ba9-1d8ab4e6b172"},{input:"d0ce404a-d95c-4210-be5d-106cb707ecda",output:"0d8dcb00-7c54-488a-9e85-0f92cb463cc3"},{input:"1751249f-fb2c-44ed-b324-e99cf1d8a5fd",output:"1a5f12bc-9d9c-48e2-905d-97e865845e87"}],nodes:[{id:"node-1",coordinates:[100,100],inputs:[],outputs:[{id:"port-1",isLinked:!0}],type:"nodeTypeInput",data:{inputValue:"defaultValue"}},{id:"841e9704-c295-4915-8ba9-1d8ab4e6b172",coordinates:[600,100],type:"nodeTypeInput",inputs:[],outputs:[{id:"62852bf6-4cb8-4437-8cb9-d1edce72de1b",isLinked:!1}],data:{inputValue:"test"}},{id:"ebac3f07-598e-4e2f-9e81-e67e542322d8",coordinates:[364,353],type:"nodeTypeButton",inputs:[],outputs:[{id:"d0ce404a-d95c-4210-be5d-106cb707ecda",isLinked:!1},{id:"1751249f-fb2c-44ed-b324-e99cf1d8a5fd",isLinked:!1}],data:{buttonList:[{text:"button-1",id:"d0ce404a-d95c-4210-be5d-106cb707ecda"},{text:"button-2",id:"1751249f-fb2c-44ed-b324-e99cf1d8a5fd"}]}},{id:"0d8dcb00-7c54-488a-9e85-0f92cb463cc3",coordinates:[604,353],type:"nodeTypeInput",inputs:[],outputs:[{id:"f854d9bc-0b0e-481c-acfe-786a20483726",isLinked:!1}],data:{inputValue:"input"}},{id:"f57ee82a-2f1e-45e8-905a-187d36a45dbb",coordinates:[100,370],type:"nodeTypeSelect",inputs:[],outputs:[{id:"459c4240-26f7-4351-857d-ba856ca755cb",isLinked:!1}],data:{inputValue:"",selectValue:"lucy"}},{id:"node-2",type:"nodeTypeSelect",coordinates:[367,226],inputs:[{id:"input-1",isLinked:!1}],outputs:[{id:"port-5",isLinked:!1}],data:{selectValue:""}},{id:"1a5f12bc-9d9c-48e2-905d-97e865845e87",coordinates:[597,478],type:"nodeTypeSelect",inputs:[],outputs:[{id:"2d16159f-3f1c-4370-b3fc-28bd8e51c388",isLinked:!1}],data:{inputValue:""}}]};new Array(500).fill({}).map((function(e,t){return{id:"node-"+t,coordinates:[40*t+200,50*t],inputs:[],outputs:[{id:"port-"+t,isLinked:!1}],type:"nodeTypeInput",data:{inputValue:"defaultValue"}}})),new Array(400).fill({}).map((function(e,t){return{input:"port-"+t,output:"node-"+(t+1)}}));function ot(){var e=function(e){var t=Object(c.useReducer)(Ke,Object(u.a)(Object(u.a)({},Ye),{},{present:e})),n=Object(s.a)(t,2),o=n[0],a=n[1],i=0!==o.past.length,r=0!==o.future.length,d=Object(c.useCallback)((function(){i&&a({type:"UNDO"})}),[i,a]),l=Object(c.useCallback)((function(){r&&a({type:"REDO"})}),[r,a]),f=Object(c.useCallback)((function(e){return a({type:"SET",newPresent:e})}),[a]),b=Object(c.useCallback)((function(e){return a({type:"SET_WIDTH_HISTORY",newPresent:e})}),[a]),j=Object(c.useCallback)((function(e){return a({type:"ADD_A_HISTORY",newPresent:e})}),[a]),p=Object(c.useCallback)((function(){return a({type:"CLEAR",initialPresent:e})}),[a,e]);return{present:o.present,set:f,setWithHistory:b,addAHistory:j,undo:d,redo:l,clear:p,canUndo:i,canRedo:r}}(ct),t=e.present,n=e.set,o=e.setWithHistory,a=e.addAHistory,i=e.undo,d=e.redo,l=e.canUndo,f=e.canRedo,b=t,p=Object(c.useState)({scale:1,translateX:0,translateY:0}),O=Object(s.a)(p,2),v=O[0],m=O[1],g=Object(c.useState)(),y=Object(s.a)(g,2),A=y[0],x=y[1],k=Object(c.useState)(_e),C=Object(s.a)(k,2),N=C[0],D=C[1],E=Object(c.useRef)(),S=Object(c.useState)([]),T=Object(s.a)(S,2),R=T[0],I=T[1],w=Object(c.useRef)(null),L=Object(c.useRef)(null),B=Object(c.useRef)([]),M=Object(c.useRef)([]),H=Object(c.useMemo)((function(){var e;return(null===(e=w.current)||void 0===e?void 0:e.getBoundingClientRect())||{x:0,y:0}}),[w.current]),V=Object(c.useCallback)(Object(h.a)((function(e){m(e)}),20),[m]),Y=Object(c.useCallback)((function(e,t){t?n(e):o(e)}),[n,o]),K=Object(c.useCallback)((function(e){a(e)}),[a]),Z=Object(c.useCallback)((function(e){e&&(e=window.event);var t=e.dataTransfer.getData("nodeType"),n=W(e,document.getElementById("diagram-canvas"),v.scale),c=z(t,n);Y(Object(u.a)(Object(u.a)({},b),{},{nodes:[].concat(Object(r.a)(b.nodes),[c])}))}),[Y,v,b]),Q=Object(c.useCallback)((function(e){e.preventDefault()}),[]),F=ke((function(e){var t;if(null===(t=w.current)||void 0===t?void 0:t.contains(e.target)){var n=e.wheelDelta,c=v.scale,o=v.translateX,a=v.translateY,i=(e.clientX-H.x-o)*Je/c,r=(e.clientY-H.y-a)*Je/c;n<0&&(c-=Je,o+=i,a+=r),n>0&&(c+=Je,o-=i,a-=r),c>1||c<.1||V({scale:Number(c.toFixed(2)),translateX:o,translateY:a})}})),U=ke((function(e){E.current={x:e.clientX,y:e.clientY,relativeX:e.clientX-v.translateX,relativeY:e.clientY-v.translateY},function(e,t){return e.target===t||e.target===(null===t||void 0===t?void 0:t.firstChild)}(e,w.current)&&(N===$e?D(et):(D(tt),I([])))})),X=Object(c.useCallback)(Object(h.a)((function(e){if(E.current&&w.current){x({left:Math.min(e.clientX,E.current.x)-H.x,top:Math.min(e.clientY,E.current.y)-H.y,width:Math.abs(e.clientX-E.current.x),height:Math.abs(e.clientY-E.current.y)});var t=L.current,n=b.nodes.map((function(e){return e.id})).filter((function(e){return function(e,t){if(e&&t){var n=e.getBoundingClientRect(),c=t.getBoundingClientRect(),o=Math.max(n.x+n.width,c.x+c.width),a=Math.max(n.y+n.height,c.y+c.height),i=Math.min(n.x,c.x),r=Math.min(n.y,c.y);return o-i<=n.width+c.width&&a-r<=n.height+c.height}return!1}(t,document.getElementById(e))}));I(n)}}),20),[v,b]),G=ke((function(e){D(N===et?$e:_e),x(void 0),E.current=void 0})),q=ke((function(e){N===et&&E.current&&V(Object(u.a)(Object(u.a)({},v),{},{translateX:e.clientX-E.current.relativeX,translateY:e.clientY-E.current.relativeY})),N===tt&&X(e)})),$=ke((function(e){"keydown"===e.type&&N===_e&&D($e),"keyup"===e.type&&D(_e)})),ee=ke((function(e){_(w.current)&&(e.preventDefault(),I(b.nodes.map((function(e){return e.id}))))})),te=ke((function(){if(_(w.current)&&R.length){var e=Object(u.a)({},b);R.forEach((function(t){e=J(e,t)})),Y(e)}})),ne=ke((function(e){_(w.current)&&R.length&&(e.preventDefault(),B.current=b.nodes,M.current=R)})),ce=ke((function(e){if(_(w.current)){e.preventDefault();var t=M.current.map((function(e){var t=B.current.findIndex((function(t){return t.id===e}));return P(B.current[t])}));Y(Object(u.a)(Object(u.a)({},b),{},{nodes:[].concat(Object(r.a)(b.nodes),Object(r.a)(t))}))}})),oe=ke((function(e){var t=Object(r.a)(R),n=t.findIndex((function(t){return t===e}));n>-1?t.splice(n,1):t=[].concat(Object(r.a)(t),[e]),I(t)})),ae=Object(c.useMemo)((function(){return nt[N]}),[N]),ie=Object(c.useMemo)((function(){return N!==tt}),[N]),re=Object(c.useMemo)((function(){return{left:null===A||void 0===A?void 0:A.left,top:null===A||void 0===A?void 0:A.top,width:null===A||void 0===A?void 0:A.width,height:null===A||void 0===A?void 0:A.height}}),[A]);return Object(Xe.a)("ctrl+z, cmd+z",i,{},[i]),Object(Xe.a)("ctrl+shift+z, cmd+shift+z",d,{},[d]),Object(Xe.a)("ctrl+c, cmd+c",ne,{},[ne]),Object(Xe.a)("ctrl+v, cmd+v",ce,{},[ce]),Object(Xe.a)("ctrl+a, cmd+a",ee,{},[ee]),Object(Xe.a)("del",te,{},[te]),Object(Xe.a)("space",$,{keyup:!0,keydown:!0},[$]),qe("wheel",F),qe("mouseup",G),qe("mousemove",q),qe("mousedown",U),Object(j.jsxs)(j.Fragment,{children:[Object(j.jsxs)("div",{id:"diagram-panel",ref:w,className:"diagram-panel",onDrop:Z,onDragEnter:Q,onDragOver:Q,tabIndex:1,style:{cursor:ae},children:[Object(j.jsx)(Ve,{value:b,transform:v,onChange:Y,onAddHistory:K,activeNodeIds:R,onToggleActiveNodeId:oe}),Object(j.jsx)("div",{ref:L,className:"diagram-selection-area",hidden:ie,style:re})]}),Object(j.jsx)(Fe,{undo:i,redo:d,canUndo:l,scale:v.scale,canRedo:f}),Object(j.jsx)(Ue,{})]})}var at=Object(c.memo)(ot),it=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,172)).then((function(t){var n=t.getCLS,c=t.getFID,o=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),c(e),o(e),a(e),i(e)}))};i.a.render(Object(j.jsx)(o.a.StrictMode,{children:Object(j.jsx)(at,{})}),document.getElementById("root")),it()},89:function(e,t,n){}},[[152,1,2]]]);
//# sourceMappingURL=main.c048d023.chunk.js.map