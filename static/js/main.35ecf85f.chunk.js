(this["webpackJsonpreact-diagram-demo"]=this["webpackJsonpreact-diagram-demo"]||[]).push([[0],{122:function(e,t,n){},125:function(e,t,n){},126:function(e,t,n){},127:function(e,t,n){"use strict";n.r(t);var a=n(2),c=n(0),o=n.n(c),r=n(30),i=n.n(r),u=(n(122),n(25)),s=n(7),l=n(24),d=n(32),b={canvasRef:null,portRefs:{},nodeRefs:{},scale:1},j=Object(c.createContext)(b),f=j.Provider,O=function(){return Object(c.useContext)(j).scale},p=o.a.memo((function(e){var t=e.children,n=e.portRefs,o=e.nodeRefs,r=e.transform,i=r.scale,u=r.translateX,s=r.translateY,d=Object(c.useState)(null),b=Object(l.a)(d,2),j=b[0],O=b[1],p=Object(c.useRef)(null);Object(c.useEffect)((function(){O(p.current)}),[]);var v=Object(c.useMemo)((function(){return{canvasRef:j,portRefs:n,nodeRefs:o,scale:i}}),[j,n,o,i]);return Object(a.jsx)("div",{id:"diagram-canvas",className:"diagram-canvas",ref:p,style:{transform:"matrix(".concat(i,",0,0,").concat(i,",").concat(u,",").concat(s,")")},children:Object(a.jsx)(f,{value:v,children:t})})}));p.displayName="DiagramCanvas";var v=n(116),m=n(135),g=["INPUT","TEXTAREA"],h={ref:null,throttleBy:0},y=function(e){return[e.clientX,e.clientY]},x=function(e){return Object(c.useCallback)((function(t){e.current&&t===e.current||(e.current=t)}),[e])},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=e.ref,n=Object(c.useRef)(),a=Object(c.useRef)(),o=Object(c.useRef)(),r=Object(c.useRef)({isDragging:!1,start:[0,0],end:[0,0],offset:[0,0]}),i=r.current,u=Object(c.useCallback)((function(e){var a=e.target.tagName;i.isDragging||!(null===t||void 0===t?void 0:t.current.contains(e.target))||g.includes(a)||(i.isDragging=!0,i.end=[0,0],i.offset=[0,0],i.start=y(e),n.current&&n.current(e,Object(s.a)({},i)))}),[t,i,n]),l=Object(c.useCallback)(Object(m.a)((function(e){i.isDragging&&(i.offset=[e.clientX-i.start[0],e.clientY-i.start[1]],a.current&&a.current(e,Object(s.a)({},i)))}),e.throttleBy),[t,i,a]),d=Object(c.useCallback)((function(e){i.isDragging&&(i.isDragging=!1,i.end=y(e),o.current&&o.current(e,Object(s.a)({},i)))}),[i,o]);return Object(c.useEffect)((function(){var e=function(e){return u(e)},n=function(e){return l(e)},a=function(e){return d(e)};return(null===t||void 0===t?void 0:t.current)&&(t.current.addEventListener("mousedown",e),document.addEventListener("mousemove",n),document.addEventListener("mouseup",a)),function(){(null===t||void 0===t?void 0:t.current)&&(t.current.removeEventListener("mousedown",e),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",a))}}),[t,u,l,d]),{ref:t,onDragStart:x(n),onDrag:x(a),onDragEnd:x(o)}},k=n(134),N=(n(70),function(e){var t=e.icon,n=e.label;return Object(a.jsxs)("h4",{className:"node-header",children:[t&&Object(a.jsx)("div",{className:"node-header-icon",children:o.a.createElement(t)}),Object(a.jsx)("div",{className:"node-header-text",children:n})]})});N.displayName="NodeTypeHeader";var D=function(e){var t=e.value,n=e.onChange;return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(N,{icon:A.nodeTypeInput.icon,label:A.nodeTypeInput.label}),Object(a.jsx)(k.a,{value:t.inputValue,onChange:function(e){n(Object(s.a)(Object(s.a)({},t),{},{inputValue:e.target.value}))},placeholder:"Basic usage"})]})};D.displayName="NodeTypeInput";var T=n(131),R=function(e){var t=e.value,n=e.onChange;return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(N,{icon:A.nodeTypeSelect.icon,label:A.nodeTypeSelect.label}),Object(a.jsxs)(T.a,{style:{width:120},value:t.selectValue,onChange:function(e){n(Object(s.a)(Object(s.a)({},t),{},{selectValue:e}))},children:[Object(a.jsx)(T.a.Option,{value:"jack",children:"Jack"}),Object(a.jsx)(T.a.Option,{value:"lucy",children:"Lucy"}),Object(a.jsx)(T.a.Option,{value:"disabled",disabled:!0,children:"Disabled"}),Object(a.jsx)(T.a.Option,{value:"Yiminghe",children:"yiminghe"})]})]})};R.displayName="NodeTypeSelect";var S=n(113),L=function(e){var t=e.value;return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(N,{icon:A.nodeTypeButton.icon,label:A.nodeTypeButton.label}),t.buttonList.map((function(e,t){return Object(a.jsx)("div",{children:Object(a.jsx)(S.a,{style:{width:"100%"},children:e.text})},t)}))]})};L.displayName="NodeTypeButton";var E,I,M=n(138),w=n(139),P=n(140),B=n(136),Y=n(130);!function(e){e.nodeTypeInput="nodeTypeInput",e.nodeTypeSelect="nodeTypeSelect",e.nodeTypeButton="nodeTypeButton"}(I||(I={}));var A=(E={},Object(d.a)(E,I.nodeTypeInput,{component:D,label:"Input \u8282\u70b9",icon:M.a}),Object(d.a)(E,I.nodeTypeSelect,{component:R,label:"Select \u8282\u70b9",icon:w.a}),Object(d.a)(E,I.nodeTypeButton,{component:L,label:"Button \u8282\u70b9",icon:P.a}),E),X=Object.entries(A).map((function(e){var t=Object(l.a)(e,2),n=t[0],a=t[1];return Object(s.a)(Object(s.a)({},a),{},{type:n})})),F=n(133),H=function e(t){if(!t)return null;var n=t.id,a=t.classList.contains("diagram-node");return n&&a?n:a?null:e(t.parentElement)},V=function(e,t){return t.findIndex((function(t){return t.id===e}))},U=n(5),_=n.n(U),W=o.a.memo((function(e){var t=e.id,n=e.isLinked,o=e.index,r=e.nodeId,i=e.onDragNewSegment,u=e.onSegmentFail,s=e.onSegmentConnect,l=e.onPortMount,d=e.type,b=Object(c.useContext)(j).canvasRef,f=O(),p=Object(c.useRef)(null),v=Object(c.useRef)(),m=_()("diagram-port",{"type-input":"input"===d,"type-output":"output"===d,"is-linked":n}),g=C({ref:p,throttleBy:15}),h=g.onDragStart,y=g.onDrag,x=g.onDragEnd;return h((function(e){if(e.stopImmediatePropagation(),e.stopPropagation(),b&&p.current){var t=b.getBoundingClientRect(),n=t.x,a=t.y,c=p.current.getBoundingClientRect(),o=c.x,r=c.y,i=c.width,u=c.height;v.current=[(o-n+i/2)/f,(r-a+u/2)/f]}})),y((function(e){if(v.current){e.stopImmediatePropagation(),e.stopPropagation();var n=function(e,t,n){var a=(null===t||void 0===t?void 0:t.getBoundingClientRect())||{x:0,y:0};return[(e.clientX-a.x)/n,(e.clientY-a.y)/n]}(e,b,f);i(t,v.current,n)}})),x((function(e){var n=e.target;if(n.classList.contains("diagram-port")&&n.id!==t)s(t,n.id);else{var a=H(e.target);a&&a!==r?s(t,a):u&&u(t,d)}})),Object(c.useEffect)((function(){l(t,p.current)}),[t,l]),Object(a.jsx)("div",{className:m,id:t,ref:p,style:{top:0===o?"45%":"calc(45% + ".concat(18*o,"px)")}})})),J=function(e){var t=e.inputs,n=e.onPortMount,c=e.onDragNewSegment,o=e.onSegmentFail,r=e.onSegmentConnect,i=e.nodeId,u=e.type;return Object(a.jsx)(a.Fragment,{children:t.map((function(e,t){return Object(a.jsx)(W,{onPortMount:n,onDragNewSegment:c,onSegmentFail:o,onSegmentConnect:r,type:u,id:e.id,index:t,isLinked:e.isLinked,nodeId:i},e.id)}))})};J.displayName="DiagramNodePorts";var K=n(141),q=n(142),z=function(e){var t=e.onNodeDelete,n=e.onNodeCopy,o=e.id,r=Object(c.useCallback)((function(){t(o)}),[o,t]),i=Object(c.useCallback)((function(){n(o)}),[o,n]);return Object(a.jsxs)("div",{className:"diagram-node-action",children:[Object(a.jsx)(S.a,{onClick:i,icon:Object(a.jsx)(K.a,{})}),Object(a.jsx)(S.a,{onClick:r,icon:Object(a.jsx)(q.a,{})})]})};z.displayName="DiagramNodeActionButtons";var G=o.a.memo((function(e){var t,n=e.nodeInfo,r=e.onNodeValueChange,i=e.onNodePositionChange,u=e.onPortMount,l=e.onDragNewSegment,d=e.onNodeMount,b=e.onSegmentFail,j=e.onSegmentConnect,f=e.onAddHistory,p=e.activeNodeIds,v=e.onNodeDelete,m=e.onNodeCopy,g=n.id,h=n.coordinates,y=n.type,x=n.inputs,k=n.data,N=n.outputs,D=O(),T=null===(t=A[y])||void 0===t?void 0:t.component,R={value:k,onChange:function(e){r(g,e)}},S=Object(c.useRef)(null),L=C({throttleBy:14,ref:S}),E=L.onDragStart,I=L.onDrag,M=L.onDragEnd,w=Object(c.useRef)(h);E((function(){w.current=h})),I((function(e,t){e.stopImmediatePropagation(),e.stopPropagation();var n=[w.current[0]+t.offset[0]/D,w.current[1]+t.offset[1]/D];i(g,n)})),M((function(e){Object(F.a)(w.current,h)||f(g,w.current)}));var P={nodeId:g,onPortMount:u,onDragNewSegment:l,onSegmentFail:b,onSegmentConnect:j};Object(c.useEffect)((function(){d(g,S.current)}),[g,d]);var B=Object(c.useMemo)((function(){return _()("diagram-node",{active:p.includes(g)})}),[p,g]);return Object(a.jsxs)("div",{id:g,className:B,ref:S,style:{left:h[0],top:h[1]},children:[T&&o.a.createElement(T,R),Object(a.jsx)(J,Object(s.a)(Object(s.a)({inputs:x},P),{},{type:"input"})),Object(a.jsx)(J,Object(s.a)(Object(s.a)({inputs:N},P),{},{type:"output"})),Object(a.jsx)(z,{id:g,onNodeDelete:v,onNodeCopy:m})]})}));G.displayName="DiagramNode";var Q=o.a.memo((function(e){var t=e.nodes,n=Object(v.a)(e,["nodes"]);return Object(a.jsx)(a.Fragment,{children:t.map((function(e){return Object(a.jsx)(G,Object(s.a)({nodeInfo:e},n),e.id)}))})}));Q.displayName="NodesCanvas";var Z=function(e){return[Math.floor(e[0]),Math.floor(e[1])]},$=function(e,t){var n,a=[(t[0]+e[0])/2,e[1]],c=[(t[0]+e[0])/2,t[1]];return"M ".concat(e[0],",").concat(e[1]," C ").concat((n=[a,c],n.map((function(e){return"".concat(e[0],",").concat(e[1])})).join(" "))," ").concat(t[0],",").concat(t[1])},ee=function(e,t){var n=(e[0]+t[0])/2,a=(e[1]+t[1])/2;return"M".concat(e[0],",").concat(e[1]," ").concat(e[0]+20,",").concat(e[1]," C ").concat(e[0]+100,",").concat(e[1]," ").concat(e[0]+130,",").concat((a+e[1])/2,"  ").concat(n,",").concat(a," C ").concat(n,",").concat(a," ").concat(t[0]-130,",").concat((a+t[1])/2," ").concat(t[0]-2,",").concat(t[1]," M ").concat(t[0]-2,",").concat(t[1]," ").concat(t[0],",").concat(t[1])},te=function(e,t){if(!e||!t)return"";var n,a,c=Z(e),o=Z(t);return n=c,(a=o)[0]>=n[0]?$(n,a):ee(n,a)},ne=o.a.memo((function(e){var t=e.position,n=e.onDelete;return Object(a.jsx)("foreignObject",{x:t[0],y:t[1],children:Object(a.jsx)("div",{className:"bi-diagram-link-label",children:Object(a.jsx)(q.a,{onClick:n})})})}));ne.displayName="LinkDelete";var ae=o.a.memo((function(e){var t=e.input,n=e.output,o=e.link,r=e.onDelete,i=Object(c.useRef)(null),u=Object(c.useState)(),s=Object(l.a)(u,2),d=s[0],b=s[1],j=Object(c.useMemo)((function(){return te(t,n)}),[t,n]);Object(c.useEffect)((function(){i.current&&b(function(e){if(e.getTotalLength&&e.getPointAtLength){var t=e.getTotalLength()/2,n=e.getPointAtLength(t);return[n.x,n.y]}return[0,0]}(i.current))}),[i,t,n]);var f=Object(c.useCallback)((function(){r(o)}),[r,o]);return Object(a.jsxs)("g",{className:"diagram-link",children:[Object(a.jsx)("path",{d:j,className:"bi-link-ghost"}),Object(a.jsx)("path",{d:j,ref:i,className:"bi-link-path"}),d&&Object(a.jsx)(ne,{position:d,onDelete:f})]})}),(function(e,t){return Object(F.a)(e,t)}));ae.displayName="Link";var ce=function(e,t,n,a){for(var c=0;c<t.length;c++){if(t[c].id===n){var o=a[n];return o?[e[0]+o.offsetLeft+o.offsetWidth/2,e[1]+o.offsetTop+o.offsetHeight/2]:null}}return null},oe=function(e,t,n,a,c){for(var o=0;o<e.length;o++){var r=e[o];if(r.id===t){var i=n[t];return i?[r.coordinates[0],r.coordinates[1]+i.offsetHeight/2]:null}var u=ce(r.coordinates,r.inputs,t,a);if(u)return u;var s=ce(r.coordinates,r.outputs,t,a);if(s)return s}return null},re=o.a.memo((function(e){var t=e.nodes,n=e.onDelete,o=e.links,r=Object(c.useContext)(j),i=r.canvasRef,u=r.portRefs,s=r.nodeRefs,l=Object(c.useMemo)((function(){var e=[];return o.forEach((function(n){var a=n.input,c=n.output,o=oe(t,a,s,u),r=oe(t,c,s,u);o&&r&&e.push({link:n,startCoordinates:o,endCoordinates:r})})),e}),[t,o,s,u,i]);return Object(a.jsx)("svg",{className:"diagram-link-canvas",children:l.map((function(e){return Object(a.jsx)(ae,{link:e.link,input:e.startCoordinates,output:e.endCoordinates,onDelete:n},"".concat(e.link.input,"-").concat(e.link.output))}))})}));re.displayName="LinksCanvas";var ie=o.a.memo((function(e){var t=e.segment,n=t.from,o=t.to,r=t.id,i=Object(c.useMemo)((function(){return te(n,o)}),[n,o]);return Object(a.jsx)("svg",{className:"diagram-segment-canvas",children:Object(a.jsxs)("g",{className:"diagram-segment-link",id:r,children:[Object(a.jsx)("path",{d:i}),Object(a.jsx)("circle",{r:"5",cx:o[0],cy:o[1]})]})})}));ie.displayName="Segment";n(125);var ue=function(e){var t=Object(c.useRef)(e);return Object(c.useLayoutEffect)((function(){t.current=e})),Object(c.useMemo)((function(){return function(){var e=t.current;return e.apply(void 0,arguments)}}),[])},se=o.a.memo((function(e){var t=e.value,n=e.onChange,o=e.onAddHistory,r=e.transform,i=e.activeNodeIds,d=Object(c.useState)(),b=Object(l.a)(d,2),j=b[0],f=b[1],O=Object(c.useRef)({}).current,v=Object(c.useRef)({}).current,m=ue((function(e,a){var c=Object(u.a)(t.nodes),o=V(e,c);c[o]=Object(s.a)(Object(s.a)({},c[o]),{},{coordinates:a}),n(Object(s.a)(Object(s.a)({},t),{},{nodes:c}),!0)})),g=ue((function(e,a){var c=Object(u.a)(t.nodes),o=V(e,c);c[o]=Object(s.a)(Object(s.a)({},c[o]),{},{data:a}),n(Object(s.a)(Object(s.a)({},t),{},{nodes:c}))})),h=ue((function(e,n){var a=Object(u.a)(t.nodes),c=V(e,a);a[c]=Object(s.a)(Object(s.a)({},a[c]),{},{coordinates:n}),o(Object(s.a)(Object(s.a)({},t),{},{nodes:a}))})),y=ue((function(e){var a=V(e,t.nodes),c=function(e){var t=Object(Y.a)(e);switch(t.id=Object(B.a)(),t.coordinates=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return[e[0]+t,e[1]+t]}(t.coordinates,20),t.type){case I.nodeTypeInput:case I.nodeTypeSelect:t.outputs.forEach((function(e){e.id=Object(B.a)(),e.isLinked=!1}));break;case I.nodeTypeButton:t.data.buttonList.forEach((function(e){e.id=Object(B.a)()})),t.outputs=t.data.buttonList.map((function(e){return{id:e.id,isLinked:!1}}))}return t}(t.nodes[a]);n(Object(s.a)(Object(s.a)({},t),{},{nodes:[].concat(Object(u.a)(t.nodes),[c])}))})),x=ue((function(e){var a=Object(u.a)(t.nodes),c=V(e,a),o=t.nodes[c],r=o.outputs.map((function(e){return e.id})),i=o.inputs.map((function(e){return e.id}));a.splice(c,1);var l=t.links.filter((function(t){return!i.includes(t.output)&&!r.includes(t.input)&&t.input!==e&&t.output!==e}));n(Object(s.a)(Object(s.a)({},t),{},{links:l,nodes:a}))})),C=ue((function(e,t){O[e]=t})),k=ue((function(e,t){v[e]=t})),N=Object(c.useCallback)((function(e,t,n){f({id:"segment-".concat(e),from:t,to:n})}),[]),D=Object(c.useCallback)((function(){f(void 0)}),[]),T=ue((function(e,a){var c=[].concat(Object(u.a)(t.links),[{input:e,output:a}]);n(Object(s.a)(Object(s.a)({},t),{},{links:c})),f(void 0)})),R=ue((function(e){var a=t.links.filter((function(t){return!Object(F.a)(t,e)}));n(Object(s.a)(Object(s.a)({},t),{},{links:a}))}));return Object(a.jsxs)(p,{portRefs:O,nodeRefs:v,transform:r,children:[Object(a.jsx)(Q,{nodes:t.nodes,onNodeMount:k,onPortMount:C,onDragNewSegment:N,onSegmentFail:D,onNodePositionChange:m,onNodeValueChange:g,onNodeDelete:x,onNodeCopy:y,onSegmentConnect:T,onAddHistory:h,activeNodeIds:i}),t.links.length>0&&Object(a.jsx)(re,{nodes:t.nodes,links:t.links,onDelete:R}),j&&Object(a.jsx)(ie,{segment:j})]})}));se.displayName="Diagram";var le={past:[],present:null,future:[]},de=function(e,t){var n=e.past,a=e.present,c=e.future,o=t.newPresent;switch(t.type){case"UNDO":var r=n[n.length-1];return{past:n.slice(0,n.length-1),present:r,future:[a].concat(Object(u.a)(c))};case"REDO":var i=c[0],l=c.slice(1);return{past:[].concat(Object(u.a)(n),[a]),present:i,future:l};case"SET":return{past:Object(u.a)(n),present:o,future:[]};case"SET_WIDTH_HISTORY":return o===a?e:{past:[].concat(Object(u.a)(n),[a]),present:o,future:[]};case"ADD_A_HISTORY":return o===a?e:{past:[].concat(Object(u.a)(n),[o]),present:a,future:[]};case"CLEAR":var d=t.initialPresent;return Object(s.a)(Object(s.a)({},le),{},{present:d})}},be=n(137),je=(n(126),[{text:"\u6eda\u8f6e\u653e\u5927\u7f29\u5c0f",value:1},{text:"\u7a7a\u683c + \u9f20\u6807\u62d6\u52a8",value:2}]),fe=o.a.memo((function(e){var t=e.undo,n=e.redo,o=e.canUndo,r=e.canRedo,i=e.scale,u=Object(c.useMemo)((function(){return Object(a.jsx)("div",{children:je.map((function(e){return Object(a.jsx)("div",{className:"scale-item",children:e.text},e.value)}))})}),[]);return Object(a.jsxs)("div",{className:"toolbar",children:[Object(a.jsx)(S.a,{disabled:!o,onClick:t,children:"\u64a4\u9500"}),Object(a.jsx)(S.a,{disabled:!r,onClick:n,children:"\u91cd\u505a"}),Object(a.jsx)(be.a,{placement:"right",content:u,overlayClassName:"scale-popover",children:Object(a.jsx)(S.a,{children:"\u5feb\u6377\u952e"})}),Object(a.jsxs)(S.a,{children:[100*i,"%"]})]})})),Oe=(n(98),o.a.memo((function(e){var t=e.icon,n=e.label,r=e.type,i=Object(c.useCallback)((function(e){var t;null===(t=e.dataTransfer)||void 0===t||t.setData("nodeType",r)}),[r]);return Object(a.jsxs)("div",{className:"node-list-item",draggable:!0,onDragStart:i,children:[t&&o.a.createElement(t),Object(a.jsx)("div",{className:"node-list-text",children:n})]})})));Oe.displayName="NodeListItem";var pe,ve=Object(c.memo)((function(){return Object(a.jsx)("div",{className:"node-list",children:X.map((function(e){return Object(a.jsx)(Oe,{icon:e.icon,type:e.type,label:e.label},e.type)}))})}));ve.displayName="NodeList";new Array(100).fill({}).map((function(e,t){return{id:"node-"+t,coordinates:[40*t,50*t],inputs:[],outputs:[{id:"port-"+t,isLinked:!1}],type:"nodeTypeInput",data:{inputValue:"defaultValue"}}})),new Array(99).fill({}).map((function(e,t){return{input:"port-"+t,output:"node-"+(t+1)}}));var me={nodes:[{id:"node-1",coordinates:[100,150],inputs:[],outputs:[{id:"port-1",isLinked:!0}],type:"nodeTypeInput",data:{inputValue:"defaultValue"}},{id:"node-2",type:"nodeTypeSelect",coordinates:[400,200],inputs:[{id:"input-1",isLinked:!1}],outputs:[{id:"port-5",isLinked:!1}],data:{selectValue:""}}],links:[{input:"port-1",output:"node-2"}]},ge=.1,he="DEFAULT",ye="START",xe="MOVE",Ce="SELECTION",ke=(pe={},Object(d.a)(pe,he,"default"),Object(d.a)(pe,Ce,"default"),Object(d.a)(pe,ye,"grab"),Object(d.a)(pe,xe,"grabbing"),pe);function Ne(){var e=function(e){var t=Object(c.useReducer)(de,Object(s.a)(Object(s.a)({},le),{},{present:e})),n=Object(l.a)(t,2),a=n[0],o=n[1],r=0!==a.past.length,i=0!==a.future.length,u=Object(c.useCallback)((function(){r&&o({type:"UNDO"})}),[r,o]),d=Object(c.useCallback)((function(){i&&o({type:"REDO"})}),[i,o]),b=Object(c.useCallback)((function(e){return o({type:"SET",newPresent:e})}),[o]),j=Object(c.useCallback)((function(e){return o({type:"SET_WIDTH_HISTORY",newPresent:e})}),[o]),f=Object(c.useCallback)((function(e){return o({type:"ADD_A_HISTORY",newPresent:e})}),[o]),O=Object(c.useCallback)((function(){return o({type:"CLEAR",initialPresent:e})}),[o,e]);return{value:a.present,set:b,setWithHistory:j,addAHistory:f,undo:u,redo:d,clear:O,canUndo:r,canRedo:i}}(me),t=e.value,n=e.set,o=e.setWithHistory,r=e.addAHistory,i=e.undo,d=e.redo,b=e.canUndo,j=e.canRedo,f=Object(c.useState)({scale:1,translateX:0,translateY:0}),O=Object(l.a)(f,2),p=O[0],v=O[1],g=Object(c.useState)(),h=Object(l.a)(g,2),y=h[0],x=h[1],C=Object(c.useState)(he),k=Object(l.a)(C,2),N=k[0],D=k[1],T=Object(c.useRef)(),R=Object(c.useState)([]),S=Object(l.a)(R,2),L=S[0],E=S[1],M=Object(c.useRef)(null),w=Object(c.useRef)(null),P=Object(c.useCallback)(Object(m.a)((function(e){v(e)}),20),[]),Y=Object(c.useCallback)((function(e,t){t?n(e):o(e)}),[n,o]),A=Object(c.useCallback)((function(e){r(e)}),[r]),X=Object(c.useCallback)((function(e){var n;e&&(e=window.event);var a=e.dataTransfer.getData("nodeType"),c=e.clientX,o=e.clientY,r=(null===(n=document.getElementById("diagram-canvas"))||void 0===n?void 0:n.getBoundingClientRect())||{x:0,y:0},i=function(e,t){var n={id:Object(B.a)(),coordinates:t,type:e,inputs:[],outputs:[],data:{}};switch(e){case I.nodeTypeInput:n=Object(s.a)(Object(s.a)({},n),{},{outputs:[{id:Object(B.a)(),isLinked:!1}],data:{inputValue:"test"}});break;case I.nodeTypeSelect:n=Object(s.a)(Object(s.a)({},n),{},{outputs:[{id:Object(B.a)(),isLinked:!1}],data:{inputValue:""}});break;case I.nodeTypeButton:var a={buttonList:[{text:"button-1",id:Object(B.a)()},{text:"button-2",id:Object(B.a)()}]},c=a.buttonList.map((function(e){return{id:e.id,isLinked:!1}}));n=Object(s.a)(Object(s.a)({},n),{},{outputs:c,data:a})}return n}(a,[(c-r.x)/p.scale,(o-r.y)/p.scale]);Y(Object(s.a)(Object(s.a)({},t),{},{nodes:[].concat(Object(u.a)(t.nodes),[i])}))}),[Y,p,t]),F=Object(c.useCallback)((function(e){e.preventDefault()}),[]),H=Object(c.useCallback)((function(e){var t=e.nativeEvent.wheelDelta,n=p.scale,a=p.translateX,c=p.translateY,o=(e.clientX-a)*ge/n,r=(e.clientY-c)*ge/n;t<0&&(n-=ge,a+=o,c+=r),t>0&&(n+=ge,a-=o,c-=r),n>1||n<.1||P({scale:Number(n.toFixed(2)),translateX:a,translateY:c})}),[P,p]),V=Object(c.useCallback)((function(e){T.current={x:e.clientX,y:e.clientY,relativeX:e.clientX-p.translateX,relativeY:e.clientY-p.translateY},function(e,t){return e.target===t||e.target===(null===t||void 0===t?void 0:t.firstChild)}(e,M.current)&&D(N===ye?xe:Ce)}),[N,p]),U=Object(c.useCallback)(Object(m.a)((function(e){if(T.current&&M.current){var n=M.current.getBoundingClientRect();x({left:Math.min(e.clientX,T.current.x)-n.x,top:Math.min(e.clientY,T.current.y)-n.y,width:Math.abs(e.clientX-T.current.x),height:Math.abs(e.clientY-T.current.y)});var a=w.current,c=t.nodes.map((function(e){return e.id})).filter((function(e){return function(e,t){if(e&&t){var n=e.getBoundingClientRect(),a=t.getBoundingClientRect(),c=Math.max(n.x+n.width,a.x+a.width),o=Math.max(n.y+n.height,a.y+a.height),r=Math.min(n.x,a.x),i=Math.min(n.y,a.y);return c-r<=n.width+a.width&&o-i<=n.height+a.height}return!1}(a,document.getElementById(e))}));E(c)}}),20),[p,t]),_=Object(c.useCallback)((function(e){D(N===xe?ye:he),x(void 0),T.current=void 0}),[N]),W=Object(c.useCallback)((function(e){N===xe&&T.current&&P(Object(s.a)(Object(s.a)({},p),{},{translateX:e.clientX-T.current.relativeX,translateY:e.clientY-T.current.relativeY})),N===Ce&&U(e)}),[N,U,P,p,T]),J=Object(c.useCallback)((function(e){32===e.keyCode&&N===he&&D(ye)}),[N]),K=Object(c.useCallback)((function(e){32===e.keyCode&&D(he)}),[]),q=Object(c.useMemo)((function(){return ke[N]}),[N]),z=Object(c.useMemo)((function(){return N!==Ce}),[N]),G=Object(c.useMemo)((function(){return{left:null===y||void 0===y?void 0:y.left,top:null===y||void 0===y?void 0:y.top,width:null===y||void 0===y?void 0:y.width,height:null===y||void 0===y?void 0:y.height}}),[y]);return Object(a.jsxs)("div",{ref:M,className:"diagram-panel",onDrop:X,onDragEnter:F,onDragOver:F,tabIndex:1,onWheel:H,onMouseDown:V,onMouseMove:W,onMouseUp:_,onKeyDown:J,onKeyUp:K,style:{cursor:q},children:[Object(a.jsx)(se,{value:t,transform:p,onChange:Y,onAddHistory:A,activeNodeIds:L}),Object(a.jsx)(ve,{}),Object(a.jsx)(fe,{undo:i,redo:d,canUndo:b,scale:p.scale,canRedo:j}),Object(a.jsx)("div",{ref:w,className:"diagram-selection-area",hidden:z,style:G})]})}var De=Object(c.memo)(Ne),Te=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,143)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),a(e),c(e),o(e),r(e)}))};i.a.render(Object(a.jsx)(o.a.StrictMode,{children:Object(a.jsx)(De,{})}),document.getElementById("root")),Te()},70:function(e,t,n){},98:function(e,t,n){}},[[127,1,2]]]);
//# sourceMappingURL=main.35ecf85f.chunk.js.map