(this["webpackJsonpreact-diagram-demo"]=this["webpackJsonpreact-diagram-demo"]||[]).push([[0],{124:function(e,t,n){},125:function(e,t,n){},149:function(e,t,n){},153:function(e,t,n){},154:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),c=n(30),r=n.n(c),i=(n(149),n(10)),u=n(5),s=n(29),d={canvasRef:null,portRefs:{},nodeRefs:{},scale:1},l=Object(o.createContext)(d),f=l.Provider,p=function(){return Object(o.useContext)(l)},j={onDragNewSegment:function(e,t,n){},onSegmentFail:function(e){},onSegmentConnect:function(e,t){},onShowSelectModel:function(e,t){},onPortMount:function(e,t){}},b=Object(o.createContext)(j),O=b.Provider,m=n(1),v=a.a.memo((function(e){var t=e.children,n=e.portRefs,a=e.nodeRefs,c=e.transform,r=e.onDragNewSegment,i=e.onSegmentFail,u=e.onSegmentConnect,d=e.onShowSelectModel,l=e.onPortMount,p=c.scale,j=c.translateX,b=c.translateY,v=Object(o.useState)(null),g=Object(s.a)(v,2),h=g[0],y=g[1],A=Object(o.useRef)(null);Object(o.useEffect)((function(){y(A.current)}),[]);var x=Object(o.useMemo)((function(){return{canvasRef:h,portRefs:n,nodeRefs:a,scale:p}}),[h,n,a,p]),C=Object(o.useMemo)((function(){return{onDragNewSegment:r,onSegmentFail:i,onSegmentConnect:u,onShowSelectModel:d,onPortMount:l}}),[r,i,u,d,l]);return Object(m.jsx)("div",{id:"diagram-canvas",className:"diagram-canvas",ref:A,style:{transform:"matrix(".concat(p,",0,0,").concat(p,",").concat(j,",").concat(b,")")},children:Object(m.jsx)(f,{value:x,children:Object(m.jsx)(O,{value:C,children:t})})})}));v.displayName="DiagramCanvas";var g=n(114),h=n(163),y=["INPUT","TEXTAREA"],A={ref:null,throttleBy:16},x=function(e){return[e.clientX,e.clientY]},C=function(e){return Object(o.useCallback)((function(t){e.current&&t===e.current||(e.current=t)}),[e])},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,t=e.ref,n=Object(o.useRef)(),a=Object(o.useRef)(),c=Object(o.useRef)(),r=Object(o.useRef)({isDragging:!1,start:[0,0],end:[0,0],offset:[0,0]}),i=r.current,s=Object(o.useCallback)((function(e){var o=e.target.tagName;i.isDragging||!(null===t||void 0===t?void 0:t.current.contains(e.target))||y.includes(o)||(i.isDragging=!0,i.end=[0,0],i.offset=[0,0],i.start=x(e),n.current&&n.current(e,Object(u.a)({},i)))}),[t,i,n]),d=Object(o.useCallback)(Object(h.a)((function(e){i.isDragging&&(i.offset=[e.clientX-i.start[0],e.clientY-i.start[1]],a.current&&a.current(e,Object(u.a)({},i)))}),e.throttleBy),[t,i,a]),l=Object(o.useCallback)((function(e){i.isDragging&&(i.isDragging=!1,i.end=x(e),c.current&&c.current(e,Object(u.a)({},i)))}),[i,c]);return Object(o.useEffect)((function(){var e=function(e){return s(e)},n=function(e){return d(e)},o=function(e){return l(e)};return(null===t||void 0===t?void 0:t.current)&&(t.current.addEventListener("mousedown",e),document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)),function(){(null===t||void 0===t?void 0:t.current)&&(t.current.removeEventListener("mousedown",e),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",o))}}),[t,s,d,l]),{ref:t,onDragStart:C(n),onDrag:C(a),onDragEnd:C(c)}},R=n(32),D=n(161),T=(n(63),function(e){var t=e.icon,n=e.label;return Object(m.jsxs)("h4",{className:"node-header",children:[t&&Object(m.jsx)("div",{className:"node-header-icon",children:a.a.createElement(t)}),Object(m.jsx)("div",{className:"node-header-text",children:n})]})});T.displayName="NodeTypeHeader";var N=D.a.TextArea,I=function(e){var t=e.value,n=e.onChange;return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(T,{icon:ce.nodeTypeSingleOutputs.icon,label:ce.nodeTypeSingleOutputs.label}),Object(m.jsx)("div",{className:"node-content",children:Object(m.jsx)(N,{placeholder:"Input message here",rows:2,value:t.inputValue,onChange:function(e){n(Object(u.a)(Object(u.a)({},t),{},{inputValue:e.target.value}))}})})]})};I.displayName="NodeTypeSingleOutputs";var E=n(159),w=D.a.TextArea,S=function(e){var t=e.value,n=e.onChange;return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(T,{icon:ce.nodeTypeSingleInputs.icon,label:ce.nodeTypeSingleInputs.label}),Object(m.jsxs)("div",{className:"node-content",children:[Object(m.jsx)(w,{placeholder:"Input message here",rows:2,value:t.inputValue,onChange:function(e){n(Object(u.a)(Object(u.a)({},t),{},{inputValue:e.target.value}))}}),Object(m.jsx)("div",{style:{marginTop:8},children:Object(m.jsxs)(E.a,{style:{width:"100%"},value:t.selectValue,onChange:function(e){n(Object(u.a)(Object(u.a)({},t),{},{selectValue:e}))},children:[Object(m.jsx)(E.a.Option,{value:"jack",children:"Jack"}),Object(m.jsx)(E.a.Option,{value:"lucy",children:"Lucy"}),Object(m.jsx)(E.a.Option,{value:"disabled",children:"Disabled"}),Object(m.jsx)(E.a.Option,{value:"Yiminghe",children:"yiminghe"})]})})]})]})};S.displayName="NodeTypeSingleInputs";var L=n(33),M=function(e,t,n){var o=(null===t||void 0===t?void 0:t.getBoundingClientRect())||{x:0,y:0};return[U((e.clientX-o.x)/n),U((e.clientY-o.y)/n)]},V=function e(t){if(!t)return null;var n=t.id,o=t.classList.contains("diagram-node");return n&&o?n:o?null:e(t.parentElement)},B=function(e,t){return t.findIndex((function(t){return t.id===e}))},H=function(e){var t=e,n=t.offsetWidth,o=t.offsetHeight;return{width:n,height:o,left:t.offsetLeft,top:t.offsetTop,right:t.offsetLeft+n,bottom:t.offsetTop+o}},Y=function(e,t,n,o){var a=Object(i.a)(n),c=B(e,a),r=t[0]-n[c].coordinates[0],s=t[1]-n[c].coordinates[1];return o.forEach((function(e){a.some((function(t,n){return t.id===e&&(a[n]=Object(u.a)(Object(u.a)({},a[n]),{},{coordinates:[U(t.coordinates[0]+r),U(t.coordinates[1]+s)]}),!0)}))})),a[c]=Object(u.a)(Object(u.a)({},a[c]),{},{coordinates:[U(t[0]),U(t[1])]}),a},P=function(e,t){var n=Object(i.a)(e.nodes),o=B(t,n),a=e.nodes[o],c=a.outputs.map((function(e){return e.id})),r=a.inputs.map((function(e){return e.id}));return n.splice(o,1),{links:e.links.filter((function(e){return!r.includes(e.output)&&!c.includes(e.input)&&e.input!==t&&e.output!==t})),nodes:n}},K=function(e){return document.activeElement===e},Z=function(e){var t=!1,n=!1,o=0;return e.wheelDelta?(o=-e.wheelDelta,t=e.wheelDelta<0,n=e.wheelDelta>0):(o=e.deltaY,t=e.deltaX>0||e.deltaY>0||e.deltaZ>0,n=e.deltaX<0||e.deltaY<0||e.deltaZ<0),{wheelDown:t,wheelUp:n,deltaY:o}},U=function(e){var t=e%2;return 2*Math.floor(e/2)+(t=t>1?2:0)},Q=/macintosh|mac os x/i.test(navigator.userAgent),z=n(7),F=n.n(z),W=a.a.memo((function(e){var t=e.id,n=e.isLinked,a=e.nodeId,c=p(),r=c.scale,i=c.canvasRef,u=Object(o.useContext)(b),s=u.onDragNewSegment,d=u.onSegmentFail,l=u.onSegmentConnect,f=u.onShowSelectModel,j=u.onPortMount,O=Object(o.useRef)(null),v=Object(o.useRef)(),g=F()("diagram-port",{"is-linked":n}),h=k({ref:O,throttleBy:16}),y=h.onDragStart,A=h.onDrag,x=h.onDragEnd;return y((function(e){if(e.stopImmediatePropagation(),e.stopPropagation(),i&&O.current){var t=i.getBoundingClientRect(),n=t.x,o=t.y,a=O.current.getBoundingClientRect(),c=a.x,u=a.y,s=a.width,d=a.height;v.current=[(c-n+s/2)/r,(u-o+d/2)/r]}})),A((function(e){if(v.current){e.stopImmediatePropagation(),e.stopPropagation();var n=M(e,i,r);s(t,v.current,n)}})),x((function(e){var n=e.target;if(n.classList.contains("diagram-port")&&n.id!==t)l(t,n.id);else{var o=V(e.target);if(o&&o!==a)l(t,o);else{var c=document.getElementById("diagram-panel");c&&c.contains(e.target)&&f(e,t),d&&d(t)}}})),Object(o.useEffect)((function(){j(t,O.current)}),[t,j]),Object(m.jsx)("b",{className:g,id:t,ref:O})})),X=function(e){var t=e.value,n=e.onChange,o=e.outputs,a=e.nodeId,c=function(e){var o=e.target.dataset.index,a=Object(i.a)(t.branchList);a[o].text=e.target.value,n(Object(u.a)(Object(u.a)({},t),{},{branchList:a}))};return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(T,{icon:ce.nodeTypeCustomRenderPort.icon,label:ce.nodeTypeCustomRenderPort.label}),Object(m.jsx)("div",{className:"node-content",children:t.branchList.map((function(e,t){return Object(m.jsxs)("div",{className:"branch-input",children:[Object(m.jsx)(D.a,{placeholder:"Input message here",value:e.text,"data-index":t,onChange:c}),o&&Object(m.jsx)(W,{id:o[t].id,isLinked:o[t].isLinked,nodeId:a})]},t)}))})]})};X.displayName="NodeTypeCustomRenderPort";var G=D.a.TextArea,q=function(e){var t=e.value,n=e.onChange;return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(T,{icon:ce.nodeTypeNoInputOutput.icon,label:ce.nodeTypeNoInputOutput.label}),Object(m.jsx)("div",{className:"node-content",children:Object(m.jsx)(G,{placeholder:"Input message here",rows:2,value:t.inputValue,onChange:function(e){n(Object(u.a)(Object(u.a)({},t),{},{inputValue:e.target.value}))}})})]})};q.displayName="NodeTypeNoInputOutput";var J,_,$=n(168),ee=n(169),te=n(170),ne=n(164),oe=D.a.TextArea,ae=function(e){var t=e.value,n=e.onChange;return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(T,{icon:ce.nodeTypeMultipleInputsOutputs.icon,label:ce.nodeTypeMultipleInputsOutputs.label}),Object(m.jsx)("div",{className:"node-content",children:Object(m.jsx)(oe,{placeholder:"Input message here",rows:2,value:t.inputValue,onChange:function(e){n(Object(u.a)(Object(u.a)({},t),{},{inputValue:e.target.value}))}})})]})};ae.displayName="NodeTypeMultipleInputsOutputs",function(e){e.nodeTypeSingleOutputs="nodeTypeSingleOutputs",e.nodeTypeSingleInputs="nodeTypeSingleInputs",e.nodeTypeNoInputOutput="nodeTypeNoInputOutput",e.nodeTypeMultipleInputsOutputs="nodeTypeMultipleInputsOutputs",e.nodeTypeCustomRenderPort="nodeTypeCustomRenderPort"}(_||(_={}));var ce=(J={},Object(R.a)(J,_.nodeTypeSingleOutputs,{component:I,label:"\u5355\u51fa\u53e3 \u8282\u70b9",icon:$.a,customRenderPort:!1,defaultValue:function(){return{id:Object(ne.a)(),coordinates:[0,0],type:_.nodeTypeSingleOutputs,inputs:[],outputs:[{id:Object(ne.a)(),isLinked:!1}],data:{inputValue:""}}}}),Object(R.a)(J,_.nodeTypeSingleInputs,{component:S,label:"\u5355\u5165\u53e3 \u8282\u70b9",icon:ee.a,customRenderPort:!1,defaultValue:function(){return{id:Object(ne.a)(),coordinates:[0,0],type:_.nodeTypeSingleInputs,inputs:[{id:Object(ne.a)(),isLinked:!1}],outputs:[],data:{inputValue:"",selectValue:""}}}}),Object(R.a)(J,_.nodeTypeNoInputOutput,{component:q,label:"\u65e0\u51fa\u5165\u53e3 \u8282\u70b9",icon:ee.a,customRenderPort:!1,defaultValue:function(){return{id:Object(ne.a)(),coordinates:[0,0],type:_.nodeTypeNoInputOutput,inputs:[],outputs:[],data:{inputValue:"",selectValue:""}}}}),Object(R.a)(J,_.nodeTypeMultipleInputsOutputs,{component:ae,label:"\u591a\u51fa\u53e3 \u591a\u5165\u53e3 \u8282\u70b9",icon:ee.a,customRenderPort:!1,defaultValue:function(){return{id:Object(ne.a)(),coordinates:[0,0],type:_.nodeTypeNoInputOutput,inputs:[{id:Object(ne.a)(),isLinked:!1},{id:Object(ne.a)(),isLinked:!1}],outputs:[{id:Object(ne.a)(),isLinked:!1},{id:Object(ne.a)(),isLinked:!1},{id:Object(ne.a)(),isLinked:!1}],data:{inputValue:"",selectValue:""}}}}),Object(R.a)(J,_.nodeTypeCustomRenderPort,{component:X,label:"\u81ea\u5b9a\u4e49\u6e32\u67d3 \u70b9 \u8282\u70b9",icon:te.a,customRenderPort:!0,defaultValue:function(){var e=[{id:Object(ne.a)(),text:""},{id:Object(ne.a)(),text:""}],t=e.map((function(e){return{id:e.id,isLinked:!1}}));return{id:Object(ne.a)(),coordinates:[0,0],type:_.nodeTypeCustomRenderPort,inputs:[],outputs:t,data:{inputValue:"",branchList:e}}}}),J),re=Object.entries(ce).map((function(e){var t=Object(s.a)(e,2),n=t[0],o=t[1];return Object(u.a)(Object(u.a)({},o),{},{type:n})})),ie=function(e,t){var n=ce[e].defaultValue;return Object(u.a)(Object(u.a)({},n()),{},{coordinates:t})},ue=n(156),se=function(e){var t=e.ports,n=e.nodeId,o=e.type,a=F()("diagram-port-wrapper",{"type-input":"input"===o,"type-output":"output"===o});return Object(m.jsx)(m.Fragment,{children:Object(m.jsx)("div",{className:a,children:t.map((function(e){return Object(m.jsx)(W,{id:e.id,isLinked:e.isLinked,nodeId:n},e.id)}))})})};se.displayName="DiagramNodePorts";var de=n(140),le=n(171),fe=n(172),pe=function(e){var t=e.onNodeDelete,n=e.onNodeCopy,a=e.id,c=Object(o.useCallback)((function(){t(a)}),[a,t]),r=Object(o.useCallback)((function(){n(a)}),[a,n]);return Object(m.jsxs)("div",{className:"diagram-node-action",children:[Object(m.jsx)(de.a,{onClick:r,icon:Object(m.jsx)(le.a,{})}),Object(m.jsx)(de.a,{onClick:c,icon:Object(m.jsx)(fe.a,{})})]})};pe.displayName="DiagramNodeActionButtons";var je=n(134),be=n(135),Oe=function(){function e(){Object(je.a)(this,e),this.es={}}return Object(be.a)(e,[{key:"on",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.es[e]||(this.es[e]=[]),this.es[e].push({cb:t,once:n})}},{key:"once",value:function(e,t){this.on(e,t,!0)}},{key:"fire",value:function(e){for(var t=this.es[e]||[],n=t.length,o=arguments.length,a=new Array(o>1?o-1:0),c=1;c<o;c++)a[c-1]=arguments[c];for(var r=0;r<n;r++){var i=t[r],u=i.cb,s=i.once;u.apply(this,a),s&&(t.splice(r,1),r--,n--)}}},{key:"off",value:function(e,t){if(void 0===e)this.es={};else if(void 0===t)delete this.es[e];else for(var n=this.es[e]||[],o=n.length,a=0;a<o;a++)n[a].cb===t&&(n.splice(a,1),a--,o--)}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];this.fire.apply(this,[e].concat(n))}}]),e}();Oe.ver="__VERSION__";var me="AUTO_LAYOUT",ve=new Oe,ge=a.a.memo((function(e){var t=e.nodeInfo,n=e.onNodeValueChange,c=e.onNodePositionChange,r=e.onNodeMount,i=e.onAddHistory,u=e.onToggleActiveNodeId,s=e.isActive,d=e.onNodeDelete,f=e.onNodeCopy,p=t.id,j=t.coordinates,b=t.type,O=t.inputs,v=t.data,g=t.outputs,h=Object(o.useContext)(l).scale,y=ce[b],A={value:v,onChange:function(e){n(p,e)},nodeId:p,inputs:(null===y||void 0===y?void 0:y.customRenderPort)?O:void 0,outputs:(null===y||void 0===y?void 0:y.customRenderPort)?g:void 0},x=Object(o.useRef)(null),C=k({throttleBy:16,ref:x}),R=C.onDragStart,D=C.onDrag,T=C.onDragEnd,N=Object(o.useRef)(j);R((function(){N.current=j})),D((function(e,t){e.stopImmediatePropagation(),e.stopPropagation();var n=[N.current[0]+t.offset[0]/h,N.current[1]+t.offset[1]/h];c(p,n),ve.emit("NODE_MOVING",p,n)})),T((function(e){Object(ue.a)(N.current,j)||i(p,N.current),ve.emit("NODE_MOVE_END")}));var I=Object(o.useCallback)((function(e){e.shiftKey&&u(p)}),[p,u]);Object(o.useEffect)((function(){r(p,x.current)}),[p,r]);var E=Object(o.useMemo)((function(){return F()("diagram-node",{active:s})}),[s]);return y.component?Object(m.jsxs)("div",{id:p,className:E,ref:x,style:{left:j[0],top:j[1]},onClick:I,children:[y.component&&a.a.createElement(y.component,A),!y.customRenderPort&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(se,{ports:O,nodeId:p,type:"input"}),Object(m.jsx)(se,{ports:g,nodeId:p,type:"output"})]}),Object(m.jsx)(pe,{id:p,onNodeDelete:d,onNodeCopy:f})]}):(console.warn('NodeType "'.concat(b,'" does not exist')),null)}));ge.displayName="DiagramNode";var he=a.a.memo((function(e){var t=e.nodes,n=e.activeNodeIds,o=Object(g.a)(e,["nodes","activeNodeIds"]);return Object(m.jsx)(m.Fragment,{children:t.map((function(e){return Object(m.jsx)(ge,Object(u.a)({isActive:n.includes(e.id),nodeInfo:e},o),e.id)}))})}));he.displayName="NodesCanvas";var ye=function(e){return[Math.floor(e[0]),Math.floor(e[1])]},Ae=function(e,t){var n,o=[(t[0]+e[0])/2,e[1]],a=[(t[0]+e[0])/2,t[1]];return"M ".concat(e[0],",").concat(e[1]," C ").concat((n=[o,a],n.map((function(e){return"".concat(e[0],",").concat(e[1])})).join(" "))," ").concat(t[0],",").concat(t[1])},xe=function(e,t){var n=(e[0]+t[0])/2,o=(e[1]+t[1])/2;return"M".concat(e[0],",").concat(e[1]," ").concat(e[0]+20,",").concat(e[1]," C ").concat(e[0]+100,",").concat(e[1]," ").concat(e[0]+130,",").concat((o+e[1])/2,"  ").concat(n,",").concat(o," C ").concat(n,",").concat(o," ").concat(t[0]-130,",").concat((o+t[1])/2," ").concat(t[0]-2,",").concat(t[1]," M ").concat(t[0]-2,",").concat(t[1]," ").concat(t[0],",").concat(t[1])},Ce=function(e,t){if(!e||!t)return"";var n,o,a=ye(e),c=ye(t);return n=a,(o=c)[0]>=n[0]?Ae(n,o):xe(n,o)},ke=a.a.memo((function(e){var t=e.input,n=e.output,a=e.link,c=e.onDelete,r=Object(o.useRef)(null),i=Object(o.useMemo)((function(){return function(e,t){var n=Math.abs(t[0]-e[0]),o=Math.abs(t[1]-e[1]),a=0,c=0,r={x:0,y:0},i={x:0,y:0};return t[0]>e[0]?(a=e[0],r.x=0,i.x=n):(a=t[0],r.x=n,i.x=0),t[1]>e[1]?(c=e[1],r.y=0,i.y=o):(c=t[1],r.y=o,i.y=0),{width:Math.floor(n)||1,height:Math.floor(o)||1,left:Math.floor(a),top:Math.floor(c),start:[r.x,r.y],end:[i.x,i.y]}}(t,n)}),[t,n]),u=i.width,s=i.height,d=i.left,l=i.top,f=i.start,p=i.end,j=Object(o.useMemo)((function(){return Ce(f,p)}),[f,p]),b=Object(o.useCallback)((function(){c(a)}),[c,a]),O=Object(o.useCallback)((function(){var e;null===(e=r.current)||void 0===e||e.classList.add("hover")}),[]),v=Object(o.useCallback)((function(){var e;null===(e=r.current)||void 0===e||e.classList.remove("hover")}),[]);return Object(m.jsxs)("svg",{ref:r,className:"diagram-link",style:{left:d,top:l},width:u,height:s,pointerEvents:"none",children:[Object(m.jsx)("path",{d:j,className:"bi-link-path"}),Object(m.jsx)("path",{d:j,className:"bi-link-ghost",onDoubleClick:b,onMouseOver:O,onMouseOut:v})]})}),(function(e,t){return Object(ue.a)(e,t)}));ke.displayName="Link";var Re=a.a.memo((function(e){var t=e.nodes,n=e.onDelete,a=e.links,c=p(),r=c.canvasRef,i=c.portRefs,u=c.nodeRefs,s=c.scale,d=Object(o.useMemo)((function(){var e=[];return a.forEach((function(n){var o=n.input,a=n.output,c=Ne({nodes:t,entityId:o,nodeRefs:u,portRefs:i,canvasRef:r,scale:s}),d=Ne({nodes:t,entityId:a,nodeRefs:u,portRefs:i,canvasRef:r,scale:s});c&&d&&e.push({link:n,startCoordinates:c,endCoordinates:d})})),e}),[t,a,u,i,r]);return Object(m.jsx)(m.Fragment,{children:d.map((function(e){return Object(m.jsx)(ke,{link:e.link,input:e.startCoordinates,output:e.endCoordinates,onDelete:n},"".concat(e.link.input,"-").concat(e.link.output))}))})}));Re.displayName="LinksCanvas";var De=function(e,t,n){var o=e.getBoundingClientRect(),a=t.getBoundingClientRect();return{offsetLeft:(a.left-o.left)/n,offsetTop:(a.top-o.top)/n}},Te=function(e){for(var t=e.nodeCoordinates,n=e.ports,o=e.entityId,a=e.portRefs,c=e.nodeDom,r=e.scale,i=0;i<n.length;i++){if(n[i].id===o){var u=a[o];if(!u)return null;var s=u.offsetWidth,d=u.offsetHeight,l=De(c,u,r),f=l.offsetLeft,p=l.offsetTop;return[t[0]+f+s/2,t[1]+p+d/2]}}return null},Ne=function(e){for(var t=e.nodes,n=e.entityId,o=e.nodeRefs,a=e.portRefs,c=(e.canvasRef,e.scale),r=0;r<t.length;r++){var i=t[r],u=o[i.id];if(i.id===n)return u?[i.coordinates[0],i.coordinates[1]+u.offsetHeight/2]:null;var s=Te({nodeCoordinates:i.coordinates,ports:i.inputs,entityId:n,portRefs:a,nodeDom:u,scale:c});if(s)return s;var d=Te({nodeCoordinates:i.coordinates,ports:i.outputs,entityId:n,portRefs:a,nodeDom:u,scale:c});if(d)return d}return null},Ie=a.a.memo((function(e){var t=e.segment,n=t.from,a=t.to,c=t.id,r=Object(o.useMemo)((function(){return Ce(n,a)}),[n,a]);return Object(m.jsx)("svg",{className:"diagram-segment-canvas",children:Object(m.jsxs)("g",{className:"diagram-segment-link",id:c,children:[Object(m.jsx)("path",{d:r}),Object(m.jsx)("circle",{r:"5",cx:a[0],cy:a[1]})]})})}));Ie.displayName="Segment";n(153);var Ee=function(e){var t=Object(o.useRef)(e);return Object(o.useLayoutEffect)((function(){t.current=e})),Object(o.useMemo)((function(){return function(){var e=t.current;return e.apply(void 0,arguments)}}),[])},we=a.a.memo((function(e){var t=e.position,n=e.onChange;if(!t)return null;var o=function(e){n(e.currentTarget.dataset.type)};return r.a.createPortal(Object(m.jsx)("div",{className:"select-model",onClick:function(){n()},children:Object(m.jsx)("ul",{className:"select-model-content",style:{left:t[0],top:t[1],position:"absolute"},onClick:function(e){e.stopPropagation()},children:re.map((function(e){return Object(m.jsxs)("li",{className:"select-model-item",onClick:o,"data-type":e.type,children:[e.icon&&a.a.createElement(e.icon),Object(m.jsx)("div",{className:"select-model-text",children:e.label})]},e.type)}))})}),document.body)}));we.displayName="SelectModel";var Se=n(162),Le=n(166),Me=n(158),Ve=function(e,t){for(var n=0;n<e.length;n++){if(e[n].id===t)return!0}return!1},Be=function(e,t){for(var n=0;n<t.length;n++){var o=t[n];if(o.id===e)return o.id;if(Ve(o.inputs,e))return o.id;if(Ve(o.outputs,e))return o.id}return e};function He(e,t){var n=e.links,o=void 0===n?[]:n,a=e.nodes,c=1,r=(void 0===a?[]:a).map((function(e){return Object(u.a)(Object(u.a)({},e),{},{row:0,column:0,style:H(t[e.id])})})),s=function e(t,n,o,a,r){if(!r.includes(t)){r.push(t);var i=o.find((function(e){return e.id===Be(t,o)}));if(i){i.row=i.row||c,i.column=i.column||n,n++;var u=0;i.outputs.forEach((function(t){var i=a.find((function(e){return e.input===t.id}));i&&(++u>1&&c++,e(i.output,n,o,a,r))}))}}};o.forEach((function(e){if(function(e,t,n){return!t.find((function(t){return t.output===Be(e,n)}))}(e.input,o,r)){var t=Be(e.input,r),n=[t],a=r.find((function(e){return e.id===t}));if(!a)return;a.row=a.row||c,a.column=1,s(e.output,2,r,o,n),c++}})),r.forEach((function(e){0===e.row&&(e.row=c,e.column=1,c++)})),Object(i.a)(r).forEach((function(e){var t=e.outputs,n=[];t.forEach((function(e){if(e.isLinked){var t=o.find((function(t){return t.input===e.id}));t&&n.push(t.output)}})),r.sort((function(e,t){return n.findIndex((function(t){return e.id===t}))-n.findIndex((function(e){return t.id===e}))}))}));var d=100,l=100,f=Object(Se.a)(r,(function(e){return e.row})),p=Object.values(f),j=l;p.forEach((function(e,t){e.sort((function(e,t){return e.column-t.column})),e.forEach((function(e,n){if(0===n&&t>0){var o=p[t-1].filter((function(t){return t.column>=e.column})).map((function(e){return e.style.height})),a=Object(Le.a)(o)||0;j+=a+50}e.column&&(e.coordinates=[250*(e.column-1)+d,j])}))}));var b=r.map((function(e){return Object(u.a)({},Object(Me.a)(e,"column","row","style"))}));return{links:o,nodes:b}}var Ye=function(e){return Number(e.toFixed(2))},Pe=function(e){var t=e.originNodes,n=e.futureNodes,o=e.animationFn,a=e.stepCount;return new Promise((function(e,c){try{var r=0,i=function(e,t,n){return e.map((function(e){var o=t.find((function(t){return t.id===e.id})),a=o?Ye((o.coordinates[0]-e.coordinates[0])/n):0,c=o?Ye((o.coordinates[1]-e.coordinates[1])/n):0;return Object(u.a)(Object(u.a)({},e),{},{xStep:a,yStep:c})}))}(t,n,a);requestAnimationFrame((function t(){r+=1;var c=(i=i.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{coordinates:[e.coordinates[0]+e.xStep,e.coordinates[1]+e.yStep]})}))).map((function(e){return Object(u.a)({},Object(Me.a)(e,["xStep","yStep"]))}));o(c),r<a?requestAnimationFrame(t):(o(n),e(n))}))}catch(s){c(s)}}))},Ke=function(e){var t=e.type,n=e.onChange,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(o.useEffect)((function(){return ve.on(t,n),function(){ve.off(t,n)}}),[t,n,a])},Ze=n(167),Ue=n(157),Qe=function(e,t,n){return e.map((function(e){var o=e.input===t,a=e.output===t;return Object(u.a)(Object(u.a)({},e),{},{input:o?n:e.input,output:a?n:e.output,inputUpdated:o||e.inputUpdated,outputUpdated:a||e.outputUpdated})}))},ze=a.a.memo((function(e){var t=e.value,n=e.onChange,a=e.onAddHistory,c=e.transform,r=e.activeNodeIds,d=e.onToggleActiveNodeId,l=Object(o.useState)(),f=Object(s.a)(l,2),p=f[0],j=f[1],b=Object(o.useState)(),O=Object(s.a)(b,2),g=O[0],h=O[1],y=Object(o.useRef)({}).current,A=Object(o.useRef)({}).current,x=Object(o.useRef)(),C=Object(o.useRef)(!1),k=Ee((function(e,o){var a=Y(e,o,t.nodes,r);n(Object(u.a)(Object(u.a)({},t),{},{nodes:a}),!0)})),R=Ee((function(e,o){var a=Object(i.a)(t.nodes),c=B(e,a);a[c]=Object(u.a)(Object(u.a)({},a[c]),{},{data:o}),n(Object(u.a)(Object(u.a)({},t),{},{nodes:a}))})),D=Ee((function(e,n){var o=Y(e,n,t.nodes,r);a(Object(u.a)(Object(u.a)({},t),{},{nodes:o}))})),T=Ee((function(e){var o=B(e,t.nodes),a=function(e){var t=Object(Ue.a)(e);return Object(u.a)(Object(u.a)({},t),{},{id:Object(ne.a)(),outputs:t.outputs.map((function(e){return{id:Object(ne.a)(),isLinked:!1}})),inputs:t.outputs.map((function(e){return{id:Object(ne.a)(),isLinked:!1}})),coordinates:[t.coordinates[0]+20,t.coordinates[1]+20]})}(t.nodes[o]);n(Object(u.a)(Object(u.a)({},t),{},{nodes:[].concat(Object(i.a)(t.nodes),[a])}))})),N=Ee((function(e){var o=P(t,e);n(o)})),I=Ee((function(e,t){y[e]=t})),E=Ee((function(e,t){A[e]=t})),w=Object(o.useCallback)((function(e,t,n){j({id:"segment-".concat(e),from:t,to:n})}),[]),S=Object(o.useCallback)((function(){j(void 0)}),[]),L=Ee((function(e,t){x.current=t,h([e.clientX,e.clientY]),j(void 0)})),V=Ee((function(e,o){if(!(t.links.findIndex((function(t){return t.input===e&&t.output===o}))>-1)){var a=[].concat(Object(i.a)(t.links),[{input:e,output:o}]);n(Object(u.a)(Object(u.a)({},t),{},{links:a}))}j(void 0)})),H=Ee((function(e){var o=t.links.filter((function(t){return!Object(ue.a)(t,e)}));n(Object(u.a)(Object(u.a)({},t),{},{links:o}))})),K=Ee((function(e){if(e&&g){var o=M({clientX:g[0],clientY:g[1]},document.getElementById("diagram-canvas"),c.scale),a=ie(e,o);n(Object(u.a)(Object(u.a)({},t),{},{nodes:[].concat(Object(i.a)(t.nodes),[a])})),setTimeout((function(){V(x.current||"",a.id)}),20)}h(void 0)})),Z=Object(o.useCallback)((function(){var e,o=He(t,A);if(e=t.nodes,o.nodes.some((function(t){var n=t.id,o=t.coordinates,a=e.find((function(e){return e.id===n}));return!a||!Object(ue.a)(a.coordinates,o)}))&&!C.current){var c={originNodes:t.nodes,futureNodes:o.nodes,animationFn:function(e){return n(Object(u.a)(Object(u.a)({},o),{},{nodes:e}),!0)},stepCount:60};C.current=!0,Pe(c).then((function(){a(t)})).finally((function(){return C.current=!1}))}}),[t,A,n,a,C]);return Ke({type:me,onChange:Z}),Object(m.jsxs)(v,{portRefs:y,nodeRefs:A,transform:c,onDragNewSegment:w,onSegmentFail:S,onSegmentConnect:V,onShowSelectModel:L,onPortMount:I,children:[Object(m.jsx)(he,{nodes:t.nodes,onNodeMount:E,onNodePositionChange:k,onNodeValueChange:R,onNodeDelete:N,onNodeCopy:T,onAddHistory:D,onToggleActiveNodeId:d,activeNodeIds:r}),t.links.length>0&&Object(m.jsx)(Re,{nodes:t.nodes,links:t.links,onDelete:H}),p&&Object(m.jsx)(Ie,{segment:p}),Object(m.jsx)(we,{position:g,onChange:K})]})}));ze.displayName="Diagram";var Fe={past:[],present:null,future:[]},We=function(e,t){var n=e.past,o=e.present,a=e.future,c=t.newPresent;switch(t.type){case"UNDO":var r=n[n.length-1];return{past:n.slice(0,n.length-1),present:r,future:[o].concat(Object(i.a)(a))};case"REDO":var s=a[0],d=a.slice(1);return{past:[].concat(Object(i.a)(n),[o]),present:s,future:d};case"SET":return{past:Object(i.a)(n),present:c,future:[]};case"SET_WIDTH_HISTORY":return c===o?e:{past:[].concat(Object(i.a)(n),[o]),present:c,future:[]};case"ADD_A_HISTORY":return c===o?e:{past:[].concat(Object(i.a)(n),[c]),present:o,future:[]};case"CLEAR":var l=t.initialPresent;return Object(u.a)(Object(u.a)({},Fe),{},{present:l})}},Xe=n(165),Ge=(n(124),Q?"CMD":"Ctrl"),qe=[{text:"\u64a4\u9500",hotKeys:[{key:Ge},{key:"Z"}]},{text:"\u591a\u9009",hotKeys:[{key:"Shift"},{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAE8ElEQVRoQ+2ZbWibVRTH/+c+6YugTKjMTVaoTBRBcFBRHCpVvw3FJmkc7sv8IO1sm3RTaZNqWdyHPunswCVrXQu6itjh0jRxU/ZpWFEYsk0niqK2UFDsVrYxcYy+5LlHbmpqDGlznydFWmy/tfe8/H/3nHse7i1hjf9QKfobAqHzyn8kaj5USpxSfIsC+Hw+Ix6PW4WSrHoAd0voGSHYOzd7reXU4ODNfIhVDeALh8v56kwKRBsl0zfzs1fa8iFWNYDa7fo9wRqjjAaIUCUZ56/9ObV3bGhoJluJVQ+QD8GSzonL5W3xeHhOra0JgByIo0S4QzKPjcYiry01Odx7Oh8QLmxj4hoibGCGC8zXSdAkW/SdMf3Lt0sNBSfTqOgUygZ9rvn16jIXH5YkzdHDkXO5ydSkkpu2Pg/gBSK6azkhDFwH4yNhVRyP94dvOBGd66MNoJwKjVR3c/v9hss4AODuQmKYuR+SbzCJGiKuI6KNyo4ZVyRgJmPm56VA2ALIT+RuDT4lBHUT4FpKRBrclIpGLmTX3c0djwlD+ImwdQGE+xOxyHtOIQoCZA9nftDcL25GiEv0Lide+ecDZCspN9/TRsCujA3zoVQsctwJhCMAz97OzWTJYSK6rVjSQgBZH28gtJsAPysGi5pH+7q/LhYvf91RC3kCoR4BPK2TbDkA5e8JdB4Q4B0MnhRTEzvtTijbAO6W0L2GgWEd8Uu10L8mWHP4VmnMnFLVTEvZlTrSc1o3trKzDeBtDQVJoEE3SbEKqDje1mAjCWpk4GIiar6kG9sZQCD0KQF36ibRAfD427cIMlIZQemKOjvfB1sV8DV2bOBKcUZXvE4LLR5ofyhJhGrLgj/ZZ57VzWELwO3veNAg8a5ucDsAnkAoKoDtsBAe6TM/0c1hC6A+EKx1gQZ0g9sCaA3uF4KeZSCWiJrv6+ZYhQA8mIhGBtcBCu1AtoXUR4csGtLZJQs4m+wzrxaz9Sy20H9QAQZfSEQjTcVE2VlfB9DZrZwWWq9A/oatt9D/q4UYE4mYuVMHWtdmsYUkm4kjkYSun60v8d8X+A+YcTMRM5/QTaJj520NDpCgWkjZNWLjTmALwLdv3y1sVX6hBFlz8zuSR3undcTp2Hj9wc/UpcYCvZiMdn+v4+P0PvAhAfcx86GEw4t4vrj6l4O1rjIaYNCsmCp/MvvypwNhqwIq4OLtifGruDTeYPcOW0iUxx/sFUR1EjgzGjU7dIRnbWwDuFtCVcKgkwSuWIkq5N4x0vPclHrnnzckHRDbAJkqBEKvqDcddZilZTUl+w/+qJMs32ZhM/gYQT1H0lcj0e4Wu3EcAajDLNOVw+oKmHkilAgk+8yf7STPiBfoVy90aiMY1q7R2MHf7MRwdIizCRb+d4BjanJkKgG87bo0/rHOmaj3tz9skLE/8zjAsCxLvprs7/nSrviSAJSzeiMSgmNEVKV+Z+AnCXnCNYOx+GDPH7mCfL5weXrT7KPE8AqB7Rn7BfCuUh54HbVQrjDVCobAGyA8nvt3Bi4T6HcQWyxxO4irCVSRtWHGDxbSb6Zib0042XnHU2ipZGqWizLaLRiPgGAsZaeEk8QJmh4/rdNuxeBKrkChycKwtgkyagDekulTommL5aSYMy6ODnZPFRNlZ33FAewkXwnbdYCV2MVSYqxXoJTdWwnfNV+BvwALEYtPTIIeoAAAAABJRU5ErkJggg=="}]},{text:"\u91cd\u505a",hotKeys:[{key:Ge},{key:"Shift"},{key:"Z"}]},{text:"\u5168\u9009",hotKeys:[{key:Ge},{key:"A"}]},{text:"\u590d\u5236",hotKeys:[{key:Ge},{key:"C"}]},{text:"\u7f29\u653e",hotKeys:[{key:Ge},{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAGMklEQVRoQ+2YfWxTVRTAz7mvbMNIJC4CQf+YMjAaEk0kxhhNjBCMH2BHVxESDREFt/WVIWFrYZMK0rcJBtZ2fEwx+BEFurYDRKKRhET8AxBDNCERtgARN4aQYAZzXd+7x9yuj9Wu63srLUqy/dXs3XvO+Z2ve+9BuM3/8Da3H0YB/usIjkbgto+AffnysWp0TAmgNF4CKOZjsBOj/Cq73HE+GAxq+QbMKoXsdk+BOiE6GyWwIsB0BLCkGkoEvQTwA3AMhZu9P+cLZMQAZQ7Xs4zhCgSYqBtFAL8RURcQ9CCDyUBQgojFSd9PksbWhZvXn881iGkAu90u8YmlK5FBuTCCCH4Hoi+0a32H2nZuvppqWFmVexpjNBuQLUCgQgKKapzebws0HkwH8YzHYzns8agjBTQFEDd+0tT1iDQLCDROWovUfXanmRwvq3IXSwzqAOFpYZxG4I34lXCqodZqVwnTcHHYX7gGwMPNgpgCsMm1FYhssTBe0/iKyJbGI6kK5sk194FkmSD1ah3Blsa/kr8LB2iTplQzxAUEoBKSHG5qOJ68Zo6j7v5CpgWJ4AC72L7WjHPEfkOAMueq6QzoY1GoKuf16VLAJrveQMTKRGr1EsfqdIU7T3avZwjPEVAnk6Lzg5s2/a1D6ABxGUBHWFdRTTDo6TeKhCFAuezeBggzOKf94UDDe2lyvZhJcCC5ExHBqZBfeT11rWi5XCtqFQ2ACLaH/MpH+hpbhesBHIN7bhQ+0Y+9cL3moN8fzQSREUAUoiTBlwQY5RrNjTQrV4bkrtP1mAVwe/L/RZqEfMoT6RSXV7lfAgk8BNDNutrn6qmSCjAQCTzOugqWZYpERgA99znBt2G/sjqdQdY0AGJdq0+ZkW69OEP4pOj3iHCHGqOlbVsbToh1VnnlFAtadg+kIfUQweHE75OR5sa9w0UhM4DTLXL/UZVjfVvAm7b9jRRAGDJYC+AP+ZRPhwJAR8ivzDfKf8Mitslu4anxap86v61lQ0cuIhAHcLgXMwYVyXU1t9JVWmDBXYlG0B7yK6/eNEC50/1TnLKPz0xtjbrwbCKg1wEAHm31eauELHulq5TyBTBcPgvFeqGnFHF3yKe8OJwHBwuZToR8DUtTAQDgTKtPWZCzCGQCEEpssvszRHh4sAXCjpBf2ToSAJtz5VQEy1diDwc4E76VAPZKz51c6ltEIC5x7FjI573RzzO30sEI2Jx1UxG0OAAhnA41KQtvWQTMKEpeky6FxGXu7s7+e8S6GERj+1s+vGxGbsY2qhexUQqZUWQEMFIZ+vpRgGw8l7YLvb36Xl6gvZs4nC60+hrWmZH9v4lA8jlwy9uoGU8Z1UBeDzLsKnzSzN3cLEi6FMrPVUJ2HwUEiWvMlssHebmz9mUAVs85HAoHlFoBnhcAm9PVioAlGvDqiG/oM9Ksx1PX2ZzudxBgIRHuDvm9G8T3f1+nITeXOf3ayznsCQeUD7I1eAiA7N6FCKWaBp5Is/J1KgAQ/KEirY2fypz69wYafx1Od+b3gKPGikyqI6Ir7GLRnFzUQVllzUOSRfpcGKT1x16IbNt4aQhAwloCuh6LqfK+rRt/yQog/oZVC79BxHEEg4+Pm4nEPNm9icVHLINXaSEvzZu4J6aqyzIZnzgzMptjk10ORFwUHxVy9trNFLPVUfu8hbH4AZX8nEwFIKJL/aRW7Q9sPGvkLMOpxMAkoXA3Ak4W0zjO4c10j3sjRWVy7SMMmF+8hTmn78KBhlXJe5Ii0MU15jDrKEMAoUTkLZOk7UK5mCZwDZZHmpXTRkbr362ya7YEWDewn84xtWhRcIvnWvJ+MRcqYGpTDNlb+5q83WZlmwKIF1lVzUyJSWsSECoQhTjHTzJFQ7zWkEHFQM7HB1bniDE5vNnblWqgfUntXVDICoJ+5U+zxpuqgWRhiSldY/JkmgOcRIITiLxT49gjMRpHIJUA0OMI8KC+nwiOcQ712aRfJiDTEdCFxGsiNnYJMHhFTJ2NvEWEnYjajlbf8LMdIxk5BbgBIp6RrHcWIXsKgU1DpMkDaYJRILpARKcI8bDlYvsRs4PabEBGHIFslORzzyhAPr1rRvZoBMx4KZ9rRiOQT++akf0PMQlFXonRH20AAAAASUVORK5CYII="}]},{text:"\u7c98\u8d34",hotKeys:[{key:Ge},{key:"V"}]},{text:"\u79fb\u52a8\u753b\u5e03",hotKeys:[{key:"Space"},{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAFiUlEQVRoQ+2Zf2hbVRTHzzkvbVNxWFEclQ4L/kJRLEwGGwjCZLAxMT8WpkNh+8N2tEnbqbRJEFfYTLLZuZH0hwuoFXQiaX6IIuyPgsoUNiwIE8fKKsrAlTFBmbq2y7tH7mtfeE1/vNs0td1o/0pz3zvnfO75nnPfO0G4xf/wFo8flAHcgc6nUDj+zPS+/dtqglYCkMETUAIA/mVBTasJwhbADB4R7pA7zwzXVhPEggDultA9SPAmIm9AwHoDAOAiM/yqOcYPp44fv7HScrLNgAxwV0toJ2jQJT/ngZty8djwSgdu+r/9AKTmWfC9ud6jQyalq6Vjq0bUJv8XSOFsPPKTueb1B73M2g8rVdgzMlDoNiySPKkZAJqj8nqqr+tvq2R8jZ136aAZRY1OfgkYtq1UYRcAiruNGTADJ9PxWNIK4PEHDxLh89bv7LqThE4lj/xV7topAOzyh+JAsKXYgSqA0aEEJ9M9saSnMVyLVbqLATchQD0iritsCMM1QDgvQJxx5KuHirO7WMACgO/AgWqhOxMI0MAAP7Lgy0ZQiF9nE9FvrIbdLZ0vIGKDISHCRxDgUcH8KWh0CnVoQ+TnZm8ETiBw1cys8XUAPEVjVR+lUl2Tiw3e8D9D2yaEDrnB3uiX5ppxHlTgA0ZNTFaOWHfN2xpsZIZ1LPAiEXSYB95cmaQrzoGbd/+zQaukzUC0XYJPH46XWFBnKY1gVhuVmchPOjdke6MjZhALnQOu/cF6qIDNDsTXF9rBuaToag5u0xzYhgDrmfm6QApYO5xKRpZ8DrhbQju16UNusQDyepldIu5GxCeNRqDhvsyJyBWV4GdJqPgm9/437kNnZR3qYgsi7p1ax25BMKLhjQs6V9egzp/NJ5sZep+jm5nrRv3lnQOI8CAzn08nYvvKAmAtbKtBWbCZROyYpzV0hAC2qjibS0LW+zzt4VoUMCgLXdehK2upwYXs20qoGKIQfKCjjlDLqQRvFOoCGTBteP3BRiSUTeFSOhF9UcW2LYA0YkIw8wW58/I7byD0KiI0qThRBXDtba9xrKs+DQiarsMeayOZz48SgAHh66q09mpvIPihLLxyAkhbnkCojxA2scAT6Z7Ix3b2lQGKDXkDoW9Vite8T0VCRmZbg40I2CgAv8rEI28tC4DMBtdOfG9nXLULWa8zzxwGHk7HY7YSLSkD8lmHnPzFcgC4WoMbHYAn1wAW2t3bKgOD8ejTi5GS3bX/u4TWAIpSspYBO40ap6Wlja5JaE1CKpopusb6KIHa+DPlnJHu8nduB6JDy3oSTz10hb+TLx/58fzuXPKd0RL2Yc5bvP7wy0jcLgQMZXqinXZ2S3oWmgIIfSKnCjqIQ9n4kc/tHKmuewLBbkJ8lhn70onIB3b3lQ7gD7ch8SuC4VwmEW22c6Sy7mvuulM4xk8jYFX+Jjfl+u2n4CUDuFvDT2jAAzIw1bcnOwjzLY+Z/6Cx0R2pVEq3u6dkAKuM5CSPrlxqUnE4X0ByAkIVFYPyJckcUdoFL9eXBCAHwhrS+9IQA5xKx6PvqjgtvmZ6rHISER5n4N9Jm9it2tmWBDCdhdcQYI8BwTxAY6P9i8mE1L3umDhBAA3AoOdBD+QSR8+pbsSSAXw+n6avfyhCZM6H8CzfFMfS/bFf7IJwt4Q2k8YhBLzfqCWGSDYRzdjdZ11fMoA0ZkDUPnyQgHdMyynPzGcE8xDm9eHse91XTaeeQEcdI24kRpc51WDACaFzVHWYVXYA06B8IWcN2hGgxuqEjd8G+Sri1E7PWGP4WQg4rDIDmiszZcmA1bDRy2nSBcSF8fksxwy6QDjLDOni3x4WI58ldyE7Z3LyDJp4TNOphpGrkHFCJ3HZ4ZgcUe0ydj7KngE7h+Vev+UB/gN5EApeyCXHVgAAAABJRU5ErkJggg=="}]},{text:"\u5220\u9664",hotKeys:[{key:"Del"}]}],Je=a.a.memo((function(){return Object(m.jsx)("ul",{className:"shortcuts-panel",children:qe.map((function(e,t){return Object(m.jsxs)("li",{className:"shortcuts-panel-item",children:[Object(m.jsxs)("div",{className:"shortcuts-panel-title",children:[e.text," :"]}),Object(m.jsx)("div",{className:"shortcuts-panel-list",children:e.hotKeys.map((function(t,n){return Object(m.jsxs)(a.a.Fragment,{children:[n>0&&Object(m.jsx)("span",{className:"shortcuts-panel-plus",children:"+"}),Object(m.jsxs)("div",{className:"shortcuts-panel-key",children:[t.key,t.icon&&Object(m.jsx)("img",{className:"shortcuts-panel-icon",src:t.icon,alt:e.text})]})]},n)}))})]},t)}))})})),_e=a.a.memo((function(e){var t=e.undo,n=e.redo,a=e.canUndo,c=e.canRedo,r=e.scale,i=Object(o.useCallback)((function(){ve.emit(me)}),[]);return Object(m.jsxs)("div",{className:"toolbar",children:[Object(m.jsxs)(de.a,{disabled:!0,children:[(100*r).toFixed(0),"%"]}),Object(m.jsx)(de.a,{disabled:!a,onClick:t,children:"\u64a4\u9500"}),Object(m.jsx)(de.a,{disabled:!c,onClick:n,children:"\u91cd\u505a"}),Object(m.jsx)(Xe.a,{trigger:"click",placement:"right",content:Object(m.jsx)(Je,{}),overlayClassName:"scale-popover",children:Object(m.jsx)(de.a,{children:"\u5feb\u6377\u952e"})}),Object(m.jsx)(de.a,{onClick:i,children:"\u81ea\u52a8\u6392\u5217"})]})})),$e=(n(125),a.a.memo((function(e){var t=e.icon,n=e.label,c=e.type,r=Object(o.useCallback)((function(e){var t;null===(t=e.dataTransfer)||void 0===t||t.setData("nodeType",c)}),[c]);return Object(m.jsxs)("div",{className:"node-list-item",draggable:!0,onDragStart:r,children:[t&&a.a.createElement(t),Object(m.jsx)("div",{className:"node-list-text",children:n})]})})));$e.displayName="NodeListItem";var et=Object(o.memo)((function(){return Object(m.jsx)("div",{className:"node-list",children:re.map((function(e){return Object(m.jsx)($e,{icon:e.icon,type:e.type,label:e.label},e.type)}))})}));et.displayName="NodeList";var tt=n(61);var nt,ot=function(e,t,n,a){var c=Object(o.useRef)(),r=n||document;Object(o.useEffect)((function(){c.current=t}),[t]),Object(o.useEffect)((function(){if(r&&r.addEventListener){var t=function(e){return c.current(e)};return r.addEventListener(e,t,a),function(){r.removeEventListener(e,t)}}}),[e,r,a])},at=.05,ct="DEFAULT",rt="START",it="MOVE",ut="SELECTION",st=(nt={},Object(R.a)(nt,ct,"default"),Object(R.a)(nt,ut,"default"),Object(R.a)(nt,rt,"grab"),Object(R.a)(nt,it,"grabbing"),nt),dt={links:[{input:"port-1",output:"node-2"},{input:"port-1",output:"ebac3f07-598e-4e2f-9e81-e67e542322d8"},{input:"node-5-port-1",output:"node-2"},{input:"node-1-port-1",output:"node-5"},{input:"node-5-port-2",output:"node-4"},{input:"node-4-port-3",output:"node-3"}],nodes:[{id:"node-1",coordinates:[100,100],inputs:[],outputs:[{id:"node-1-port-1",isLinked:!0}],type:"nodeTypeSingleOutputs",data:{inputValue:"defaultValue"}},{id:"node-2",coordinates:[600,100],type:"nodeTypeSingleInputs",inputs:[{id:"node-2-port-1",isLinked:!1}],outputs:[],data:{inputValue:"test"}},{id:"node-3",coordinates:[850,297],type:"nodeTypeNoInputOutput",inputs:[],outputs:[],data:{inputValue:"test"}},{id:"node-4",coordinates:[600,297],type:"nodeTypeMultipleInputsOutputs",inputs:[{id:"node-4-port-1",isLinked:!1},{id:"node-4-port-2",isLinked:!1}],outputs:[{id:"node-4-port-3",isLinked:!1},{id:"node-4-port-4",isLinked:!1},{id:"node-4-port-5",isLinked:!1}],data:{inputValue:"test"}},{id:"node-5",coordinates:[350,100],type:"nodeTypeCustomRenderPort",inputs:[],outputs:[{id:"node-5-port-1",isLinked:!1},{id:"node-5-port-2",isLinked:!1}],data:{branchList:[{text:"button-1",id:"d0ce404a"},{text:"button-2",id:"1751249f"}]}}]};new Array(1e3).fill({}).map((function(e,t){return{id:"node-"+t,coordinates:[40*t+200,50*t],inputs:[],outputs:[{id:"port-"+t,isLinked:!1}],type:"nodeTypeInput",data:{inputValue:"defaultValue"}}})),new Array(999).fill({}).map((function(e,t){return{input:"port-"+t,output:"node-"+(t+1)}}));function lt(){var e=function(e){var t=Object(o.useReducer)(We,Object(u.a)(Object(u.a)({},Fe),{},{present:e})),n=Object(s.a)(t,2),a=n[0],c=n[1],r=0!==a.past.length,i=0!==a.future.length,d=Object(o.useCallback)((function(){r&&c({type:"UNDO"})}),[r,c]),l=Object(o.useCallback)((function(){i&&c({type:"REDO"})}),[i,c]),f=Object(o.useCallback)((function(e){return c({type:"SET",newPresent:e})}),[c]),p=Object(o.useCallback)((function(e){return c({type:"SET_WIDTH_HISTORY",newPresent:e})}),[c]),j=Object(o.useCallback)((function(e){return c({type:"ADD_A_HISTORY",newPresent:e})}),[c]),b=Object(o.useCallback)((function(){return c({type:"CLEAR",initialPresent:e})}),[c,e]);return{present:a.present,set:f,setWithHistory:p,addAHistory:j,undo:d,redo:l,clear:b,canUndo:r,canRedo:i}}(dt),t=e.present,n=e.set,a=e.setWithHistory,c=e.addAHistory,r=e.undo,d=e.redo,l=e.canUndo,f=e.canRedo,p=t,j=Object(o.useState)({scale:1,translateX:0,translateY:0}),b=Object(s.a)(j,2),O=b[0],v=b[1],y=Object(o.useState)(),A=Object(s.a)(y,2),x=A[0],C=A[1],k=Object(o.useState)(ct),R=Object(s.a)(k,2),D=R[0],T=R[1],N=Object(o.useRef)(),I=Object(o.useState)([]),E=Object(s.a)(I,2),w=E[0],S=E[1],V=Object(o.useRef)(null),B=Object(o.useRef)(null),Y=Object(o.useMemo)((function(){var e;return(null===(e=V.current)||void 0===e?void 0:e.getBoundingClientRect())||{x:0,y:0}}),[V.current]),U=Object(o.useCallback)(Object(h.a)((function(e){v(e)}),20),[v]),z=Object(o.useCallback)((function(e,t){t?n(e):a(e)}),[n,a]),F=Object(o.useCallback)((function(e){c(e)}),[c]),W=Object(o.useCallback)((function(e){e&&(e=window.event);var t=e.dataTransfer.getData("nodeType"),n=M(e,document.getElementById("diagram-canvas"),O.scale),o=ie(t,n);z(Object(u.a)(Object(u.a)({},p),{},{nodes:[].concat(Object(i.a)(p.nodes),[o])}))}),[z,O,p]),X=Object(o.useCallback)((function(e){e.preventDefault()}),[]),G=Ee((function(e){var t=Z(e),n=t.wheelDown,o=t.wheelUp,a=O.scale,c=O.translateX,r=O.translateY,i=(e.clientX-Y.x-c)*at/a,u=(e.clientY-Y.y-r)*at/a;n&&(a-=at,c+=i,r+=u),o&&(a+=at,c-=i,r-=u),a>1||a<.1||v({scale:Number(a.toFixed(2)),translateX:c,translateY:r})})),q=Ee((function(e){var t=Z(e).deltaY,n=O.translateX,o=O.translateY;L.a.shift?n-=t/2:o-=t/2,v(Object(u.a)(Object(u.a)({},O),{},{translateX:n,translateY:o}))})),J=Ee((function(e){var t;e||(e=window.event),(null===(t=V.current)||void 0===t?void 0:t.contains(e.target))&&(e.returnValue=!1,(Q?L.a.command:L.a.ctrl)?G(e):q(e))})),_=Ee((function(e){N.current={x:e.clientX,y:e.clientY,relativeX:e.clientX-O.translateX,relativeY:e.clientY-O.translateY},function(e,t){return e.target===t||e.target===(null===t||void 0===t?void 0:t.firstChild)}(e,V.current)&&(D===rt?T(it):(T(ut),S([])))})),$=Object(o.useCallback)(Object(h.a)((function(e){if(N.current&&V.current){C({left:Math.min(e.clientX,N.current.x)-Y.x,top:Math.min(e.clientY,N.current.y)-Y.y,width:Math.abs(e.clientX-N.current.x),height:Math.abs(e.clientY-N.current.y)});var t=B.current,n=p.nodes.map((function(e){return e.id})).filter((function(e){return function(e,t){if(e&&t){var n=e.getBoundingClientRect(),o=t.getBoundingClientRect(),a=Math.max(n.x+n.width,o.x+o.width),c=Math.max(n.y+n.height,o.y+o.height),r=Math.min(n.x,o.x),i=Math.min(n.y,o.y);return a-r<=n.width+o.width&&c-i<=n.height+o.height}return!1}(t,document.getElementById(e))}));S(n)}}),20),[O,p]),ee=Ee((function(e){T(D===it?rt:ct),C(void 0),N.current=void 0})),te=Ee((function(e){D===it&&N.current&&U(Object(u.a)(Object(u.a)({},O),{},{translateX:e.clientX-N.current.relativeX,translateY:e.clientY-N.current.relativeY})),D===ut&&$(e)})),oe=Ee((function(e){"keydown"===e.type&&D===ct&&T(rt),"keyup"===e.type&&T(ct)})),ae=Ee((function(e){K(V.current)&&(e.preventDefault(),S(p.nodes.map((function(e){return e.id}))))})),ce=Ee((function(){if(K(V.current)&&w.length){var e=Object(u.a)({},p);w.forEach((function(t){e=P(e,t)})),z(e)}})),re=Ee((function(e){if(K(V.current)&&w.length){e.preventDefault();var t=function(e,t){var n,o,a=e.nodes.filter((function(e){return t.includes(e.id)})),c=(null===(n=Object(Ze.a)(a,"coordinates[0]"))||void 0===n?void 0:n.coordinates[0])||0,r=(null===(o=Object(Ze.a)(a,"coordinates[1]"))||void 0===o?void 0:o.coordinates[1])||0;return{nodes:a.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{coordinates:[e.coordinates[0]-c,e.coordinates[1]-r]})})),links:e.links}}(p,w);e.clipboardData.setData("text/json",JSON.stringify(t))}})),ue=Ee((function(e){if(K(V.current)){e.preventDefault();var t=V.current?function(e,t){var n=e.scale,o=e.translateX,a=e.translateY,c=H(t);return{x:-o/n+c.width/n/3,y:-a/n+c.height/n/2}}(O,V.current):{x:20,y:20},n=e.clipboardData.getData("text/json");if(n){var o=function(e,t){var n=e.links;return{nodes:e.nodes.map((function(e){var o=Object(ne.a)(),a=[e.coordinates[0]+t.x,e.coordinates[1]+t.y];return n=Qe(n,e.id,o),Object(u.a)(Object(u.a)({},e),{},{coordinates:a,inputs:e.inputs.map((function(e){var t=Object(ne.a)();return n=Qe(n,e.id,t),Object(u.a)(Object(u.a)({},e),{},{id:t})})),outputs:e.outputs.map((function(e){var t=Object(ne.a)();return n=Qe(n,e.id,t),Object(u.a)(Object(u.a)({},e),{},{id:t})})),id:o})})),links:n.filter((function(e){return e.inputUpdated&&e.outputUpdated})).map((function(e){e.inputUpdated,e.outputUpdated;var t=Object(g.a)(e,["inputUpdated","outputUpdated"]);return Object(u.a)({},t)}))}}(JSON.parse(n),t);z({links:[].concat(Object(i.a)(p.links),Object(i.a)(o.links)),nodes:[].concat(Object(i.a)(p.nodes),Object(i.a)(o.nodes))})}}})),se=Ee((function(e){var t=Object(i.a)(w),n=t.findIndex((function(t){return t===e}));n>-1?t.splice(n,1):t=[].concat(Object(i.a)(t),[e]),S(t)})),de=Object(o.useMemo)((function(){return st[D]}),[D]),le=Object(o.useMemo)((function(){return D!==ut}),[D]),fe=Object(o.useMemo)((function(){return{left:null===x||void 0===x?void 0:x.left,top:null===x||void 0===x?void 0:x.top,width:null===x||void 0===x?void 0:x.width,height:null===x||void 0===x?void 0:x.height}}),[x]);return Object(tt.a)("ctrl+z, cmd+z",r,{},[r]),Object(tt.a)("ctrl+shift+z, cmd+shift+z",d,{},[d]),Object(tt.a)("ctrl+a, cmd+a",ae,{},[ae]),Object(tt.a)("del, backspace",ce,{},[ce]),Object(tt.a)("space",oe,{keyup:!0,keydown:!0},[oe]),Object(tt.a)("*",(function(e){console.log("keyDownEvent",e),console.log("isPressed 8 ?=>",L.a.isPressed(8)),console.log("isPressed delete ?=>",L.a.isPressed("delete")),console.log("isPressed backspace ?=>",L.a.isPressed("backspace"))}),{},[oe]),ot("wheel",J,null,{passive:!1}),ot("mouseup",ee),ot("mousemove",te),ot("mousedown",_),ot("copy",re),ot("paste",ue),Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)("div",{id:"diagram-panel",ref:V,className:"diagram-panel",onDrop:W,onDragEnter:X,onDragOver:X,tabIndex:1,style:{cursor:de},children:[Object(m.jsx)(ze,{value:p,transform:O,onChange:z,onAddHistory:F,activeNodeIds:w,onToggleActiveNodeId:se}),Object(m.jsx)("div",{ref:B,className:"diagram-selection-area",hidden:le,style:fe})]}),Object(m.jsx)(_e,{undo:r,redo:d,canUndo:l,scale:O.scale,canRedo:f}),Object(m.jsx)(et,{})]})}var ft=Object(o.memo)(lt),pt=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,173)).then((function(t){var n=t.getCLS,o=t.getFID,a=t.getFCP,c=t.getLCP,r=t.getTTFB;n(e),o(e),a(e),c(e),r(e)}))};r.a.render(Object(m.jsx)(a.a.StrictMode,{children:Object(m.jsx)(ft,{})}),document.getElementById("root")),pt()},63:function(e,t,n){}},[[154,1,2]]]);
//# sourceMappingURL=main.366146b4.chunk.js.map