{"version":3,"sources":["components/Context/DiagramManager.ts","components/Context/PortManager.ts","components/Diagram/DiagramCanvas.tsx","hooks/useDrag.ts","components/NodeTypes/NodeTypeHeader.tsx","components/NodeTypes/NodeTypeSingleOutputs.tsx","components/NodeTypes/NodeTypeSingleInputs.tsx","utils/index.ts","components/Diagram/Port.tsx","components/NodeTypes/NodeTypeCustomRenderPort.tsx","components/NodeTypes/NodeTypeNoInputOutput.tsx","components/NodeTypes/config.ts","components/NodeTypes/NodeTypeMultipleInputsOutputs.tsx","components/Diagram/DiagramNodePorts.tsx","components/Diagram/DiagramNodeActionButtons.tsx","utils/onfire.ts","utils/eventBus.ts","components/Diagram/DiagramNode.tsx","components/Diagram/NodesCanvas.tsx","utils/makeSvgPath.ts","components/Diagram/Link.tsx","components/Diagram/LinksCanvas.tsx","components/Diagram/Segment.tsx","hooks/useEventCallback.ts","components/Diagram/SelectModel.tsx","utils/autoLayout.ts","hooks/useEventBus.ts","utils/copyPaste.ts","components/Diagram/index.tsx","hooks/useHistory.ts","components/Toolbar/ShortcutsPanel.tsx","static/icon-click.png","static/icon-wheel.png","static/icon-move.png","components/Toolbar/Toolbar.tsx","components/NodeList/NodeListItem.tsx","components/NodeList/NodeList.tsx","hooks/useEventListener.ts","constant/index.ts","utils/creatMockData.ts","DiagramPanel.tsx","constant/hotKeys.ts","reportWebVitals.ts","index.tsx"],"names":["defaultValue","canvasRef","portRefs","nodeRefs","scale","DiagramManagerContext","createContext","DiagramManagerProvider","Provider","useDiagramManager","useContext","onDragNewSegment","id","from","to","onSegmentFail","onSegmentConnect","targetPort","onShowSelectModel","event","input","onPortMount","dom","PortManagerContext","PortManagerContextProvider","DiagramCanvas","React","memo","props","children","transform","translateX","translateY","useState","canvasDom","setBoundingBox","useRef","useEffect","current","contextValue","useMemo","portContextValue","className","ref","style","value","displayName","DISABLED_DRAG_TAGS","defaultOptions","throttleBy","getEventCoordinates","clientX","clientY","CreateCallbackRef","useCallback","callback","useDrag","options","targetRef","dragStartHandlerRef","dragHandlerRef","dragEndHandlerRef","isDragging","start","end","offset","info","onDragStart","targetTagName","target","tagName","contains","includes","onDrag","throttle","onDragEnd","_onDragStart","e","_onDrag","_onDragEnd","addEventListener","document","removeEventListener","NodeTypeHeader","icon","label","createElement","TextArea","Input","NodeTypeSingleOutputs","onChange","nodesConfig","nodeTypeSingleOutputs","placeholder","rows","inputValue","NodeTypeSingleInputs","nodeTypeSingleInputs","marginTop","width","selectValue","Option","calculatingCoordinates","referenceDom","referenceDomRect","getBoundingClientRect","x","y","getInteger","findEventTargetParentNodeId","nodeId","isNodeDom","classList","parentElement","findIndexById","nodes","findIndex","node","getNodeStyle","nodeDom","offsetWidth","height","offsetHeight","left","offsetLeft","top","offsetTop","right","bottom","batchUpdateCoordinates","nextCoordinates","activeNodeIds","nextNodes","index","offsetCoordinate","coordinates","forEach","activeNodeId","some","nextIndex","oneNodeDelete","currentNode","nodeOutputs","outputs","map","port","nodeInputs","inputs","splice","links","filter","link","output","checkIsFocusInPanel","panelDom","activeElement","num","remainder","Math","floor","BASE_NUM","isMac","test","navigator","userAgent","Port","isLinked","startCoordinatesRef","classnames","stopImmediatePropagation","stopPropagation","canvasX","canvasY","targetDom","targetNode","getElementById","NodeTypeCustomRenderPort","handleInputChange","dataset","newBranchList","branchList","text","nodeTypeCustomRenderPort","item","data-index","NodeTypeNoInputOutput","nodeTypeNoInputOutput","NodeTypes","NodeTypeMultipleInputsOutputs","nodeTypeMultipleInputsOutputs","component","AppleOutlined","customRenderPort","uuidv4","type","data","WindowsOutlined","GithubOutlined","nodesList","Object","entries","key","createNode","nodeType","coordinate","DiagramNodePorts","ports","DiagramNodeActionButtons","onNodeDelete","onNodeCopy","handleNodeDelete","handleNodeCopy","onClick","CopyOutlined","DeleteOutlined","OnFire","es","eventName","cb","once","this","push","on","listeners","l","length","params","i","apply","undefined","fire","ver","EVENT_AUTO_LAYOUT","EE","DiagramNode","nodeInfo","onNodeValueChange","onNodePositionChange","onNodeMount","onAddHistory","onToggleActiveNodeId","isActive","nodeConfig","nodeItemProps","nextNodeData","dragStartPoint","nextCoords","eventBus","emit","isEqual","handleClick","shiftKey","active","console","warn","NodesCanvas","others","roundPoint","point","getCubicBezierPath","points","controlPointForStart","controlPointForEnd","join","getAdvancedCubicBezierPath","midX","midY","makeSvgPath","startPoint","endPoint","roundedStart","roundedEnd","Link","onDelete","svgRef","abs","computedLinkSvgInfo","path","handleDelete","handleMouseOver","add","handleMouseOut","remove","pointerEvents","d","onDoubleClick","onMouseOver","onMouseOut","prev","next","LinksCanvas","result","res","startCoordinates","computedLinkCoordinate","entityId","endCoordinates","calculatingPortRelativeNode","portDom","nodeRect","portRect","findPortCoordinate","nodeCoordinates","j","nodeEl","inputRes","outputRes","Segment","segment","r","cx","cy","useEventCallback","fn","useLayoutEffect","SelectModel","prop","position","handleItemClick","currentTarget","ReactDOM","createPortal","data-type","body","checkPortIsNodeSon","findPortFatherNodeId","autoLayout","row","extendNodes","column","recursionLookup","linkEndId","baseColumn","catchNodeIds","find","outputHasLinkNum","findLink","linkInput","checkIsStartLink","portFatherNodeId","nextNodeIds","sort","a","b","LAYOUT_BASIC_COORDINATE","groupRowMap","groupBy","groupRows","values","currentTop","aRow","rowIndex","cell","cellIndex","currentAfterPreRowMaxHeightList","preCell","rowMaxHeight","maxBy","newNodes","omit","toFixed2","Number","toFixed","autoLayoutAnimation","originNodes","futureNodes","animationFn","stepCount","Promise","resolve","reject","animationCount","nodeWithStep","oldNodes","findNextNode","xStep","yStep","computedAnimationStep","requestAnimationFrame","step","error","useEventBus","dep","off","updatePasteLink","oldId","newId","inputUpdated","outputUpdated","Diagram","setSegment","selectModelPosition","setSelectModelPosition","startPortIdRef","isAutoLayoutRef","handleNodePositionChange","handleNodeValueChange","nextNodeValue","handleAddHistory","newNode","originNode","nodeData","cloneDeep","createSinglePasteValue","nextValue","onPortRegister","portId","portEl","onNodeRegister","nextLinks","onLinkDelete","handleSelectModelChange","setTimeout","handleAutoLayout","then","finally","initialState","past","present","future","reducer","state","action","newPresent","previous","slice","newFuture","initialPresent","CTRL_OR_CMD","hotkeyList","hotKeys","ShortcutsPanel","keyItem","keyIndex","Fragment","src","alt","Toolbar","undo","redo","canUndo","canRedo","disabled","trigger","placement","content","overlayClassName","NodeListItem","handleDragStart","dataTransfer","setData","draggable","NodeList","useEventListener","handler","element","savedHandler","eventListener","SCALE_STEP","DRAG_STATE","CURSOR_MAP","Array","fill","DiagramPanel","useReducer","dispatch","set","setWithHistory","addAHistory","clear","useHistory","handleUndo","handleRedo","setTransform","selectionArea","setSelectionArea","dragState","setDragState","mouseDownStartPosition","setActiveNodeIds","panelRef","selectionAreaRef","panelRect","handleThrottleSetTransform","handleChange","newValue","notAddHistory","handleDrop","window","getData","handleDrag","preventDefault","handlePanelScale","wheelDown","deltaY","wheelUp","checkWheelDirection","offsetX","offsetY","handlePanelTranslate","deltaX","hotkeys","shift","computedWheelDelta","handleWheel","returnValue","command","ctrlKey","ctrl","isTriggerScale","handleMouseDown","relativeX","relativeY","firstChild","checkMouseDownTargetIsDrawPanel","handleThrottleSetSelectionArea","min","selectAreaDom","v","dom1","dom2","rect1","rect2","maxX","max","maxY","minX","minY","collideCheck","handleMouseUp","handleMouseMove","handleSpaceHotKey","isPressed","handleSelectAll","handleBatchDelete","handleBatchCopy","originCopyData","minBy","createCopyValue","clipboardData","JSON","stringify","handleBatchPaste","pasteOffset","calculatePasteOriginCoordination","pasteString","newLinks","newNodeId","newCoordinates","newPortId","createPasteValue","parse","handleToggleActiveNodeId","nextActiveNodeIds","cursor","hideSelectionArea","selectionAreaStyled","useHotkeys","keyup","keydown","passive","onDrop","onDragEnter","onDragOver","tabIndex","hidden","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","render","StrictMode"],"mappings":"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","file":"static/js/main.6294766f.chunk.js","sourcesContent":["import { createContext, useContext } from 'react'\nimport { IPortRefs, INodeRefs } from '../../types'\n\nexport interface IDiagramManager {\n  canvasRef: HTMLDivElement | null\n  portRefs: IPortRefs\n  nodeRefs: INodeRefs\n  scale: number\n}\n\nconst defaultValue: IDiagramManager = { canvasRef: null, portRefs: {}, nodeRefs: {}, scale: 1 }\n\nconst DiagramManagerContext = createContext(defaultValue)\n\nexport const DiagramManagerProvider = DiagramManagerContext.Provider\n\n// export DiagramManager Context\nexport const useDiagramManager = (): IDiagramManager => {\n  return useContext(DiagramManagerContext)\n}\n\n// export DiagramCanvas Context\nexport const useDiagramCanvas = (): HTMLDivElement | null => {\n  const { canvasRef } = useContext(DiagramManagerContext)\n  return canvasRef\n}\n\n// return  DiagramNod dom 节点\nexport const useDiagramNodeRefs = (): INodeRefs => {\n  const { nodeRefs } = useContext(DiagramManagerContext)\n  return nodeRefs\n}\n\n// return  DiagramNodePorts ports 节点\nexport const usePortRefs = (): IPortRefs => {\n  const { portRefs } = useContext(DiagramManagerContext)\n  return portRefs\n}\n\n// return scale\nexport const useScale = (): number => {\n  const { scale } = useContext(DiagramManagerContext)\n  return scale\n}\n","import { createContext, useContext } from 'react'\nimport { ICoordinateType } from '../../types'\n\nexport interface IPortManager {\n  onDragNewSegment: (id: string, from: ICoordinateType, to: ICoordinateType) => void\n  onSegmentFail: (id: string) => void\n  onSegmentConnect: (id: string, targetPort: string) => void\n  onShowSelectModel: (event: MouseEvent, input: string) => void\n  onPortMount: (id: string, dom: HTMLElement) => void\n}\n\nconst defaultValue: IPortManager = {\n  onDragNewSegment: (id, from, to) => {},\n  onSegmentFail: (id) => {},\n  onSegmentConnect: (id, targetPort) => {},\n  onShowSelectModel: (event, input) => {},\n  onPortMount: (id, dom) => {},\n}\n\nconst PortManagerContext = createContext(defaultValue)\n\nexport const PortManagerContextProvider = PortManagerContext.Provider\n\nexport const usePortManager = (): IPortManager => {\n  return useContext(PortManagerContext)\n}\n","import React, { useEffect, useMemo, useRef, useState } from 'react'\nimport { DiagramManagerProvider } from '../Context/DiagramManager'\nimport { IPortRefs, INodeRefs, ITransform } from '../../types'\nimport { IPortManager, PortManagerContextProvider } from '../Context/PortManager'\n\ninterface DiagramCanvasProps extends IPortManager {\n  portRefs: IPortRefs\n  nodeRefs: INodeRefs\n  transform: ITransform\n}\n\nexport const DiagramCanvas: React.FC<DiagramCanvasProps> = React.memo((props) => {\n  const {\n    children,\n    portRefs,\n    nodeRefs,\n    transform,\n    onDragNewSegment,\n    onSegmentFail,\n    onSegmentConnect,\n    onShowSelectModel,\n    onPortMount,\n  } = props\n  const { scale, translateX, translateY } = transform\n\n  const [canvasDom, setBoundingBox] = useState<HTMLDivElement | null>(null)\n  const canvasRef = useRef<HTMLDivElement>(null)\n\n  // 储存 canvas dom\n  useEffect(() => {\n    setBoundingBox(canvasRef.current)\n  }, [])\n\n  const contextValue = useMemo(\n    () => ({\n      canvasRef: canvasDom,\n      portRefs,\n      nodeRefs,\n      scale,\n    }),\n    [canvasDom, portRefs, nodeRefs, scale]\n  )\n  const portContextValue = useMemo(\n    () => ({\n      onDragNewSegment,\n      onSegmentFail,\n      onSegmentConnect,\n      onShowSelectModel,\n      onPortMount,\n    }),\n    [onDragNewSegment, onSegmentFail, onSegmentConnect, onShowSelectModel, onPortMount]\n  )\n\n  return (\n    <div\n      id=\"diagram-canvas\"\n      className=\"diagram-canvas\"\n      ref={canvasRef}\n      // style={{ transform: `translate(${translate.x}px, ${translate.y}px) scale(${scale})` }}\n      style={{ transform: `matrix(${scale},0,0,${scale},${translateX},${translateY})` }}\n    >\n      <DiagramManagerProvider value={contextValue}>\n        <PortManagerContextProvider value={portContextValue}>{children}</PortManagerContextProvider>\n      </DiagramManagerProvider>\n    </div>\n  )\n})\n\nDiagramCanvas.displayName = 'DiagramCanvas'\n","import { throttle } from 'lodash-es'\nimport { useRef, useCallback, useEffect } from 'react'\nimport { ICoordinateType } from '../types'\n\nconst DISABLED_DRAG_TAGS = ['INPUT', 'TEXTAREA']\n\ninterface DefaultOptions {\n  ref: React.RefObject<any> | null\n  throttleBy: number\n}\n\ninterface InfoType {\n  isDragging: boolean\n  start: ICoordinateType\n  end: ICoordinateType\n  offset: ICoordinateType\n}\n\nconst defaultOptions: DefaultOptions = {\n  ref: null,\n  throttleBy: 16,\n}\n\nconst getEventCoordinates = (event: MouseEvent): ICoordinateType => [event.clientX, event.clientY]\n\n/**\n * 创建一个持久回调引用\n * @param ref\n * @returns {Function}\n */\nconst CreateCallbackRef = (ref: any) =>\n  useCallback(\n    (callback) => {\n      if (!ref.current || callback !== ref.current) {\n        ref.current = callback\n      }\n    },\n    [ref]\n  )\n\nconst useDrag = (options = defaultOptions) => {\n  const targetRef = options.ref\n  const dragStartHandlerRef = useRef<any>()\n  const dragHandlerRef = useRef<any>()\n  const dragEndHandlerRef = useRef<any>()\n  const { current: info } = useRef<InfoType>({ isDragging: false, start: [0, 0], end: [0, 0], offset: [0, 0] })\n\n  const onDragStart = useCallback(\n    (event) => {\n      const targetTagName = event.target.tagName\n      if (\n        !info.isDragging &&\n        targetRef?.current.contains(event.target) &&\n        !DISABLED_DRAG_TAGS.includes(targetTagName)\n      ) {\n        info.isDragging = true\n        info.end = [0, 0]\n        info.offset = [0, 0]\n        info.start = getEventCoordinates(event)\n\n        if (dragStartHandlerRef.current) {\n          dragStartHandlerRef.current(event, { ...info })\n        }\n      }\n    },\n    [targetRef, info, dragStartHandlerRef]\n  )\n\n  // eslint-disable-next-line\n  const onDrag = useCallback(\n    throttle((event) => {\n      if (info.isDragging) {\n        info.offset = [event.clientX - info.start[0], event.clientY - info.start[1]]\n\n        if (dragHandlerRef.current) {\n          dragHandlerRef.current(event, { ...info })\n        }\n      }\n    }, options.throttleBy),\n    [targetRef, info, dragHandlerRef]\n  )\n\n  const onDragEnd = useCallback(\n    (event) => {\n      if (info.isDragging) {\n        info.isDragging = false\n        info.end = getEventCoordinates(event)\n\n        if (dragEndHandlerRef.current) {\n          dragEndHandlerRef.current(event, { ...info })\n        }\n      }\n    },\n    [info, dragEndHandlerRef]\n  )\n\n  useEffect(() => {\n    const _onDragStart = (e: any) => onDragStart(e)\n    const _onDrag = (e: any) => onDrag(e)\n    const _onDragEnd = (e: any) => onDragEnd(e)\n\n    if (targetRef?.current) {\n      targetRef.current.addEventListener('mousedown', _onDragStart)\n      document.addEventListener('mousemove', _onDrag)\n      document.addEventListener('mouseup', _onDragEnd)\n    }\n\n    return () => {\n      if (targetRef?.current) {\n        // eslint-disable-next-line\n        targetRef.current.removeEventListener('mousedown', _onDragStart)\n        document.removeEventListener('mousemove', _onDrag)\n        document.removeEventListener('mouseup', _onDragEnd)\n      }\n    }\n  }, [targetRef, onDragStart, onDrag, onDragEnd])\n\n  return {\n    ref: targetRef,\n    onDragStart: CreateCallbackRef(dragStartHandlerRef),\n    onDrag: CreateCallbackRef(dragHandlerRef),\n    onDragEnd: CreateCallbackRef(dragEndHandlerRef),\n  }\n}\n\nexport default useDrag\n","import React from 'react'\n\nimport './style.scss'\n\n\nexport interface NodeTypeHeaderProps {\n  icon: React.FC\n  label: string;\n}\n\n\nexport const NodeTypeHeader: React.FC<NodeTypeHeaderProps> = (props) => {\n  const {icon, label} = props\n\n  return (\n    <h4 className='node-header'>\n      {icon && <div className='node-header-icon'>\n        {React.createElement(icon)}\n      </div>}\n      <div className='node-header-text'>{label}</div>\n    </h4>\n  )\n}\n\nNodeTypeHeader.displayName = 'NodeTypeHeader'\n","import React from 'react'\nimport { Input } from 'antd'\nimport './style.scss'\nimport { INodeItemProps } from '../../types'\nimport { NodeTypeHeader } from './NodeTypeHeader'\nimport { nodesConfig } from './config'\nconst { TextArea } = Input\n\nexport interface NodeTypeSingleOutputsProps extends INodeItemProps<any> {}\n\nexport const NodeTypeSingleOutputs: React.FC<NodeTypeSingleOutputsProps> = (props) => {\n  const { value, onChange } = props\n  const handleInputChange = (e: any) => {\n    onChange({\n      ...value,\n      inputValue: e.target.value,\n    })\n  }\n\n  return (\n    <>\n      <NodeTypeHeader icon={nodesConfig.nodeTypeSingleOutputs.icon} label={nodesConfig.nodeTypeSingleOutputs.label} />\n      <div className=\"node-content\">\n        <TextArea placeholder=\"Input message here\" rows={2} value={value.inputValue} onChange={handleInputChange} />\n      </div>\n    </>\n  )\n}\n\nNodeTypeSingleOutputs.displayName = 'NodeTypeSingleOutputs'\n","import React from 'react'\nimport { Select } from 'antd'\nimport { Input } from 'antd'\nimport './style.scss'\nimport { INodeItemProps } from '../../types'\nimport { NodeTypeHeader } from './NodeTypeHeader'\nimport { nodesConfig } from './config'\nconst { TextArea } = Input\n\nexport interface NodeTypeSingleInputsProps extends INodeItemProps<any> {}\n\nexport const NodeTypeSingleInputs: React.FC<NodeTypeSingleInputsProps> = ({ value, onChange }) => {\n  const handleInputChange = (e: any) => {\n    onChange({\n      ...value,\n      inputValue: e.target.value,\n    })\n  }\n\n  const handleSelectChange = (e: any) => {\n    onChange({\n      ...value,\n      selectValue: e,\n    })\n  }\n\n  return (\n    <>\n      <NodeTypeHeader icon={nodesConfig.nodeTypeSingleInputs.icon} label={nodesConfig.nodeTypeSingleInputs.label} />\n      <div className=\"node-content\">\n        <TextArea placeholder=\"Input message here\" rows={2} value={value.inputValue} onChange={handleInputChange} />\n        <div style={{ marginTop: 8 }}>\n          <Select style={{ width: '100%' }} value={value.selectValue} onChange={handleSelectChange}>\n            <Select.Option value=\"jack\">Jack</Select.Option>\n            <Select.Option value=\"lucy\">Lucy</Select.Option>\n            <Select.Option value=\"disabled\">Disabled</Select.Option>\n            <Select.Option value=\"Yiminghe\">yiminghe</Select.Option>\n          </Select>\n        </div>\n      </div>\n    </>\n  )\n}\n\nNodeTypeSingleInputs.displayName = 'NodeTypeSingleInputs'\n","import { ICoordinateType, IDiagramType, INodeStyle, INodeType } from '../types'\nimport hotkeys from 'hotkeys-js'\n\n// 计算 鼠标事件 相对在 参照物(diagram 画布)内的坐标\nexport const calculatingCoordinates = (\n  event: MouseEvent,\n  referenceDom: HTMLDivElement | HTMLElement | null,\n  scale: number\n): ICoordinateType => {\n  const referenceDomRect = referenceDom?.getBoundingClientRect() || { x: 0, y: 0 }\n  return [\n    getInteger((event.clientX - referenceDomRect.x) / scale),\n    getInteger((event.clientY - referenceDomRect.y) / scale),\n  ]\n}\n\nexport const findEventTargetParentNodeId = (dom: HTMLElement | null): null | string => {\n  if (!dom) {\n    return null\n  }\n  const nodeId = dom.id\n  const isNodeDom = dom.classList.contains('diagram-node')\n  if (nodeId && isNodeDom) {\n    return nodeId\n  }\n  if (isNodeDom) {\n    return null\n  }\n  return findEventTargetParentNodeId(dom.parentElement)\n}\n\n// 检测鼠标按下的时候是否是点击在画布空白区域\nexport const checkMouseDownTargetIsDrawPanel = (event: any, panelDom: HTMLElement | null) =>\n  event.target === panelDom || event.target === panelDom?.firstChild\n\n// 碰撞检测 检测两个div 是否相交\nexport const collideCheck = (dom1: HTMLElement | null, dom2: HTMLElement | null) => {\n  if (dom1 && dom2) {\n    const rect1 = dom1.getBoundingClientRect()\n    const rect2 = dom2.getBoundingClientRect()\n    const maxX: number = Math.max(rect1.x + rect1.width, rect2.x + rect2.width)\n    const maxY: number = Math.max(rect1.y + rect1.height, rect2.y + rect2.height)\n    const minX: number = Math.min(rect1.x, rect2.x)\n    const minY: number = Math.min(rect1.y, rect2.y)\n    return maxX - minX <= rect1.width + rect2.width && maxY - minY <= rect1.height + rect2.height\n  }\n  return false\n}\n\nexport const findIndexById = (nodeId: string, nodes: INodeType[]) => nodes.findIndex((node) => node.id === nodeId)\n\nexport const getNodeStyle = (nodeDom: Element): INodeStyle => {\n  const dom = nodeDom as HTMLElement\n  const width = dom.offsetWidth\n  const height = dom.offsetHeight\n  return {\n    width,\n    height,\n    left: dom.offsetLeft,\n    top: dom.offsetTop,\n    right: dom.offsetLeft + width,\n    bottom: dom.offsetTop + height,\n  }\n}\n\nexport const batchUpdateCoordinates = (\n  nodeId: string,\n  nextCoordinates: ICoordinateType,\n  nodes: INodeType[],\n  activeNodeIds: string[]\n): INodeType[] => {\n  const nextNodes = [...nodes]\n\n  const index = findIndexById(nodeId, nextNodes)\n\n  const offsetCoordinate = {\n    xOffset: nextCoordinates[0] - nodes[index].coordinates[0],\n    yOffset: nextCoordinates[1] - nodes[index].coordinates[1],\n  }\n  // update activeNodeIds\n  activeNodeIds.forEach((activeNodeId) => {\n    nextNodes.some((node, nextIndex) => {\n      if (node.id === activeNodeId) {\n        nextNodes[nextIndex] = {\n          ...nextNodes[nextIndex],\n          coordinates: [\n            getInteger(node.coordinates[0] + offsetCoordinate.xOffset),\n            getInteger(node.coordinates[1] + offsetCoordinate.yOffset),\n          ],\n        }\n        return true\n      } else {\n        return false\n      }\n    })\n  })\n  // update self\n  nextNodes[index] = {\n    ...nextNodes[index],\n    coordinates: [getInteger(nextCoordinates[0]), getInteger(nextCoordinates[1])],\n  }\n\n  return nextNodes\n}\n\nexport const oneNodeDelete = (value: IDiagramType, nodeId: string): IDiagramType => {\n  const nextNodes = [...value.nodes]\n  const index = findIndexById(nodeId, nextNodes)\n  const currentNode = value.nodes[index]\n  const nodeOutputs = currentNode.outputs.map((port) => port.id)\n  const nodeInputs = currentNode.inputs.map((port) => port.id)\n  nextNodes.splice(index, 1)\n  // 删除和节点相关的所有线\n  let nextLinks = value.links.filter((link) => {\n    return (\n      !nodeInputs.includes(link.output) &&\n      !nodeOutputs.includes(link.input) &&\n      link.input !== nodeId &&\n      link.output !== nodeId\n    )\n  })\n  return { links: nextLinks, nodes: nextNodes }\n}\n\nexport const checkIsFocusInPanel = (panelDom: HTMLElement | null) => document.activeElement === panelDom\n\n/*\n * 画出 link 的 svg 矩形容器，和位置，并且重新计算在 矩形容器内的起点和终点\n * */\nexport const computedLinkSvgInfo = (input: ICoordinateType, output: ICoordinateType) => {\n  const width = Math.abs(output[0] - input[0])\n  const height = Math.abs(output[1] - input[1])\n  const MIN_SIZE = 1\n  let left = 0\n  let top = 0\n  const start = { x: 0, y: 0 }\n  const end = { x: 0, y: 0 }\n\n  // x 轴防方向\n  if (output[0] > input[0]) {\n    left = input[0]\n\n    start.x = 0\n    end.x = width\n  } else {\n    left = output[0]\n\n    start.x = width\n    end.x = 0\n  }\n\n  // y 轴防方向\n  if (output[1] > input[1]) {\n    top = input[1]\n\n    start.y = 0\n    end.y = height\n  } else {\n    top = output[1]\n\n    start.y = height\n    end.y = 0\n  }\n\n  return {\n    width: Math.floor(width) || MIN_SIZE,\n    height: Math.floor(height) || MIN_SIZE,\n    left: Math.floor(left),\n    top: Math.floor(top),\n    start: [start.x, start.y],\n    end: [end.x, end.y],\n  }\n}\n\n/*\n * 检测鼠标滚轮方向\n */\nexport const checkWheelDirection = (event: WheelEvent) => {\n  return {\n    wheelDown: event.deltaY > 0,\n    wheelUp: event.deltaY < 0,\n  }\n}\n\n/*\n * 计算滚轮滚动距离\n */\nexport const computedWheelDelta = (event: WheelEvent) => {\n  const SENSITIVITY = 2 // 设置灵敏度\n  let deltaX = event.deltaX / SENSITIVITY\n  let deltaY = event.deltaY / SENSITIVITY\n\n  if (!isMac && hotkeys.shift) {\n    deltaX = deltaY\n    deltaY = 0\n  }\n\n  return {\n    deltaX,\n    deltaY,\n  }\n}\n\nconst BASE_NUM = 2\nexport const getInteger = (num: number) => {\n  const integer = Math.floor(num / BASE_NUM)\n  let remainder = num % BASE_NUM\n\n  remainder = remainder > BASE_NUM / 2 ? BASE_NUM : 0\n\n  const res = integer * BASE_NUM + remainder\n  return res\n}\n\nexport const isMac = (() => /macintosh|mac os x/i.test(navigator.userAgent))()\n\nexport const isTriggerScale = (event: WheelEvent) => (isMac ? hotkeys.command || event.ctrlKey : hotkeys.ctrl)\n","import React, { useEffect, useRef } from 'react'\nimport useDrag from '../../hooks/useDrag'\nimport { ICoordinateType, IPointType } from '../../types'\nimport { calculatingCoordinates, findEventTargetParentNodeId } from '../../utils'\nimport { useDiagramManager } from '../Context/DiagramManager'\nimport classnames from 'classnames'\nimport { usePortManager } from '../Context/PortManager'\n\ninterface PortProps extends IPointType {\n  nodeId: string\n}\n\nexport const Port: React.FC<PortProps> = React.memo((props) => {\n  const { id, isLinked, nodeId } = props\n  const { scale, canvasRef } = useDiagramManager()\n  const { onDragNewSegment, onSegmentFail, onSegmentConnect, onShowSelectModel, onPortMount } = usePortManager()\n  const ref: any = useRef<React.RefObject<HTMLElement>>(null)\n  const startCoordinatesRef = useRef<ICoordinateType | undefined>()\n\n  const className = classnames('diagram-port', {\n    'is-linked': isLinked,\n  })\n\n  const { onDragStart, onDrag, onDragEnd } = useDrag({ ref, throttleBy: 16 })\n\n  onDragStart((event: MouseEvent) => {\n    event.stopImmediatePropagation()\n    event.stopPropagation()\n    if (canvasRef && ref.current) {\n      const { x: canvasX, y: canvasY } = canvasRef.getBoundingClientRect()\n      const { x, y, width, height } = ref.current.getBoundingClientRect()\n      startCoordinatesRef.current = [(x - canvasX + width / 2) / scale, (y - canvasY + height / 2) / scale]\n    }\n  })\n\n  onDrag((event: MouseEvent) => {\n    if (startCoordinatesRef.current) {\n      event.stopImmediatePropagation()\n      event.stopPropagation()\n      const to: ICoordinateType = calculatingCoordinates(event, canvasRef, scale)\n\n      onDragNewSegment(id, startCoordinatesRef.current, to)\n    }\n  })\n\n  onDragEnd((event: MouseEvent) => {\n    const targetDom = event.target as HTMLElement\n    const targetIsPort = targetDom.classList.contains('diagram-port')\n    // 如果目标元素是 port 区域 并且不是起点port\n    if (targetIsPort && targetDom.id !== id) {\n      onSegmentConnect(id, targetDom.id)\n      return\n    }\n\n    // 如果目标元素是 node 区域 并非不是起点node\n    const targetNode = findEventTargetParentNodeId(event.target as HTMLElement)\n    if (targetNode && targetNode !== nodeId) {\n      onSegmentConnect(id, targetNode)\n      return\n    }\n    const panelDom = document.getElementById('diagram-panel')\n    if (panelDom && panelDom.contains(event.target as HTMLElement)) {\n      onShowSelectModel(event, id)\n    }\n    // 否则在空白区域松开 释放\n    onSegmentFail && onSegmentFail(id)\n  })\n\n  useEffect(() => {\n    onPortMount(id, ref.current)\n  }, [id, onPortMount])\n\n  return <b className={className} id={id} ref={ref} />\n})\n","import React from 'react'\nimport { Input } from 'antd'\nimport './style.scss'\nimport { INodeItemProps } from '../../types'\nimport { NodeTypeHeader } from './NodeTypeHeader'\nimport { nodesConfig } from './config'\nimport { Port } from '../Diagram/Port'\n\nexport interface NodeTypeCustomRenderPortProps extends INodeItemProps<any> {}\n\nexport const NodeTypeCustomRenderPort: React.FC<NodeTypeCustomRenderPortProps> = (props) => {\n  const { value, onChange, outputs, nodeId } = props\n\n  const handleInputChange = (e: any) => {\n    const index = e.target.dataset.index\n    const newBranchList = [...value.branchList]\n    newBranchList[index].text = e.target.value\n    onChange({\n      ...value,\n      branchList: newBranchList,\n    })\n  }\n\n  return (\n    <>\n      <NodeTypeHeader\n        icon={nodesConfig.nodeTypeCustomRenderPort.icon}\n        label={nodesConfig.nodeTypeCustomRenderPort.label}\n      />\n      <div className=\"node-content\">\n        {value.branchList.map((item: any, index: number) => (\n          <div className=\"branch-input\" key={index}>\n            <Input placeholder=\"Input message here\" value={item.text} data-index={index} onChange={handleInputChange} />\n            {outputs && <Port id={outputs[index].id} isLinked={outputs[index].isLinked} nodeId={nodeId} />}\n          </div>\n        ))}\n      </div>\n    </>\n  )\n}\n\nNodeTypeCustomRenderPort.displayName = 'NodeTypeCustomRenderPort'\n","import React from 'react'\nimport { Input } from 'antd'\nimport './style.scss'\nimport { INodeItemProps } from '../../types'\nimport { NodeTypeHeader } from './NodeTypeHeader'\nimport { nodesConfig } from './config'\nconst { TextArea } = Input\n\nexport interface NodeTypeNoInputOutputProps extends INodeItemProps<any> {}\n\nexport const NodeTypeNoInputOutput: React.FC<NodeTypeNoInputOutputProps> = (props) => {\n  const { value, onChange } = props\n  const handleInputChange = (e: any) => {\n    onChange({\n      ...value,\n      inputValue: e.target.value,\n    })\n  }\n\n  return (\n    <>\n      <NodeTypeHeader icon={nodesConfig.nodeTypeNoInputOutput.icon} label={nodesConfig.nodeTypeNoInputOutput.label} />\n      <div className=\"node-content\">\n        <TextArea placeholder=\"Input message here\" rows={2} value={value.inputValue} onChange={handleInputChange} />\n      </div>\n    </>\n  )\n}\n\nNodeTypeNoInputOutput.displayName = 'NodeTypeNoInputOutput'\n","import { NodeTypeSingleOutputs } from './NodeTypeSingleOutputs'\nimport { NodeTypeSingleInputs } from './NodeTypeSingleInputs'\nimport { NodeTypeCustomRenderPort } from './NodeTypeCustomRenderPort'\nimport { NodeTypeNoInputOutput } from './NodeTypeNoInputOutput'\nimport { AppleOutlined, WindowsOutlined, GithubOutlined } from '@ant-design/icons'\nimport { v4 as uuidv4 } from 'uuid'\nimport { ICoordinateType, INodeType, NodeTypeEnum } from '../../types'\nimport { NodeTypeMultipleInputsOutputs } from './NodeTypeMultipleInputsOutputs'\n/*\n * 1. 单出口节点\n * 2. 单入口节点\n * 3. 无出入口节点\n * 4. 多出口 多入口节点\n * 5. 自定义渲染节点\n */\nexport enum NodeTypes {\n  nodeTypeSingleOutputs = 'nodeTypeSingleOutputs', // 单出口节点\n  nodeTypeSingleInputs = 'nodeTypeSingleInputs', // 单入口节点\n  nodeTypeNoInputOutput = 'nodeTypeNoInputOutput', // 无出入口节点\n  nodeTypeMultipleInputsOutputs = 'nodeTypeMultipleInputsOutputs', // 多出口 多入口节点\n  nodeTypeCustomRenderPort = 'nodeTypeCustomRenderPort', // 自定义渲染节点\n}\n\nexport const nodesConfig = {\n  [NodeTypes.nodeTypeSingleOutputs]: {\n    component: NodeTypeSingleOutputs,\n    label: '单出口 节点',\n    icon: AppleOutlined,\n    customRenderPort: false,\n    defaultValue: () => {\n      return {\n        id: uuidv4(),\n        coordinates: [0, 0],\n        type: NodeTypes.nodeTypeSingleOutputs,\n        inputs: [],\n        outputs: [{ id: uuidv4(), isLinked: false }],\n        data: {\n          inputValue: '',\n        },\n      }\n    },\n  },\n  [NodeTypes.nodeTypeSingleInputs]: {\n    component: NodeTypeSingleInputs,\n    label: '单入口 节点',\n    icon: WindowsOutlined,\n    customRenderPort: false,\n    defaultValue: () => {\n      return {\n        id: uuidv4(),\n        coordinates: [0, 0],\n        type: NodeTypes.nodeTypeSingleInputs,\n        inputs: [{ id: uuidv4(), isLinked: false }],\n        outputs: [],\n        data: {\n          inputValue: '',\n          selectValue: '',\n        },\n      }\n    },\n  },\n  [NodeTypes.nodeTypeNoInputOutput]: {\n    component: NodeTypeNoInputOutput,\n    label: '无出入口 节点',\n    icon: WindowsOutlined,\n    customRenderPort: false,\n    defaultValue: () => {\n      return {\n        id: uuidv4(),\n        coordinates: [0, 0],\n        type: NodeTypes.nodeTypeNoInputOutput,\n        inputs: [],\n        outputs: [],\n        data: {\n          inputValue: '',\n          selectValue: '',\n        },\n      }\n    },\n  },\n  [NodeTypes.nodeTypeMultipleInputsOutputs]: {\n    component: NodeTypeMultipleInputsOutputs,\n    label: '多出口 多入口 节点',\n    icon: WindowsOutlined,\n    customRenderPort: false,\n    defaultValue: () => {\n      return {\n        id: uuidv4(),\n        coordinates: [0, 0],\n        type: NodeTypes.nodeTypeNoInputOutput,\n        inputs: [\n          { id: uuidv4(), isLinked: false },\n          { id: uuidv4(), isLinked: false },\n        ],\n        outputs: [\n          { id: uuidv4(), isLinked: false },\n          { id: uuidv4(), isLinked: false },\n          { id: uuidv4(), isLinked: false },\n        ],\n        data: {\n          inputValue: '',\n          selectValue: '',\n        },\n      }\n    },\n  },\n  [NodeTypes.nodeTypeCustomRenderPort]: {\n    component: NodeTypeCustomRenderPort,\n    label: '自定义渲染 点 节点',\n    icon: GithubOutlined,\n    customRenderPort: true,\n    defaultValue: () => {\n      const branchList = [\n        { id: uuidv4(), text: '' },\n        { id: uuidv4(), text: '' },\n      ]\n      // 由数据映射输出点\n      const outputs = branchList.map((item) => ({ id: item.id, isLinked: false }))\n      return {\n        id: uuidv4(),\n        coordinates: [0, 0],\n        type: NodeTypes.nodeTypeCustomRenderPort,\n        inputs: [],\n        outputs,\n        data: {\n          inputValue: '',\n          branchList,\n        },\n      }\n    },\n  },\n}\n\nexport const nodesList = Object.entries(nodesConfig).map(([key, value]) => {\n  return {\n    ...value,\n    type: key,\n  }\n})\n\nexport const createNode = (nodeType: NodeTypeEnum, coordinate: ICoordinateType): INodeType => {\n  const { defaultValue } = nodesConfig[nodeType]\n\n  return { ...defaultValue(), coordinates: coordinate }\n}\n","import React from 'react'\nimport { Input } from 'antd'\nimport './style.scss'\nimport { INodeItemProps } from '../../types'\nimport { NodeTypeHeader } from './NodeTypeHeader'\nimport { nodesConfig } from './config'\nconst { TextArea } = Input\n\nexport interface NodeTypeMultipleInputsOutputsProps extends INodeItemProps<any> {}\n\nexport const NodeTypeMultipleInputsOutputs: React.FC<NodeTypeMultipleInputsOutputsProps> = (props) => {\n  const { value, onChange } = props\n  const handleInputChange = (e: any) => {\n    onChange({\n      ...value,\n      inputValue: e.target.value,\n    })\n  }\n\n  return (\n    <>\n      <NodeTypeHeader\n        icon={nodesConfig.nodeTypeMultipleInputsOutputs.icon}\n        label={nodesConfig.nodeTypeMultipleInputsOutputs.label}\n      />\n      <div className=\"node-content\">\n        <TextArea placeholder=\"Input message here\" rows={2} value={value.inputValue} onChange={handleInputChange} />\n      </div>\n    </>\n  )\n}\n\nNodeTypeMultipleInputsOutputs.displayName = 'NodeTypeMultipleInputsOutputs'\n","import classnames from 'classnames'\nimport React from 'react'\nimport { IPointType } from '../../types'\nimport { Port } from './Port'\n\nexport interface DiagramNodePortsProps {\n  ports: IPointType[]\n  nodeId: string\n  type: 'input' | 'output'\n}\n\nexport const DiagramNodePorts: React.FC<DiagramNodePortsProps> = (props) => {\n  const { ports: inputs, nodeId, type } = props\n\n  const className = classnames('diagram-port-wrapper', {\n    'type-input': type === 'input',\n    'type-output': type === 'output',\n  })\n  return (\n    <>\n      <div className={className}>\n        {inputs.map((port) => (\n          <Port key={port.id} id={port.id} isLinked={port.isLinked} nodeId={nodeId} />\n        ))}\n      </div>\n    </>\n  )\n}\n\nDiagramNodePorts.displayName = 'DiagramNodePorts'\n","import React, { useCallback } from 'react'\nimport { Button } from 'antd'\nimport { DeleteOutlined, CopyOutlined } from '@ant-design/icons'\n\n\n// import { DeleteOutlined } from '@ant-design/icons'\n\n\nexport interface DiagramNodeActionButtonsProps {\n  id: string\n  onNodeCopy: (nodeId: string) => void\n  onNodeDelete: (nodeId: string) => void\n}\n\nexport const DiagramNodeActionButtons: React.FC<DiagramNodeActionButtonsProps> = (props) => {\n  const {onNodeDelete, onNodeCopy, id} = props\n\n  const handleNodeDelete = useCallback(() => {\n    onNodeDelete(id)\n  }, [id, onNodeDelete])\n\n  const handleNodeCopy = useCallback(() => {\n    onNodeCopy(id)\n  }, [id, onNodeCopy])\n\n  return (\n    <div className='diagram-node-action'>\n      <Button onClick={handleNodeCopy} icon={<CopyOutlined/>}/>\n      <Button onClick={handleNodeDelete} icon={<DeleteOutlined/>}/>\n    </div>\n  )\n}\n\nDiagramNodeActionButtons.displayName = 'DiagramNodeActionButtons'\n","export interface Listener {\n  cb: Function\n  once: boolean\n}\n\nexport interface EventsType {\n  [eventName: string]: Listener[]\n}\n\n/**\n * const ee = new OnFire();\n *\n * ee.on('click', (...values) => {});\n *\n * ee.on('mouseover', (...values) => {});\n *\n * ee.emit('click', 1, 2, 3);\n * ee.fire('mouseover', {}); // same with emit\n *\n * ee.off();\n */\nexport default class OnFire {\n  static ver = '__VERSION__'\n\n  // 所有事件的监听器\n  es: EventsType = {}\n\n  on(eventName: string, cb: Function, once: boolean = false) {\n    if (!this.es[eventName]) {\n      this.es[eventName] = []\n    }\n\n    this.es[eventName].push({\n      cb,\n      once,\n    })\n  }\n\n  once(eventName: string, cb: Function) {\n    this.on(eventName, cb, true)\n  }\n\n  fire(eventName: string, ...params: any[]) {\n    const listeners = this.es[eventName] || []\n\n    let l = listeners.length\n\n    for (let i = 0; i < l; i++) {\n      const { cb, once } = listeners[i]\n\n      cb.apply(this, params)\n\n      if (once) {\n        listeners.splice(i, 1)\n        i--\n        l--\n      }\n    }\n  }\n\n  off(eventName?: string, cb?: Function) {\n    // clean all\n    if (eventName === undefined) {\n      this.es = {}\n    } else {\n      if (cb === undefined) {\n        // clean the eventName's listeners\n        delete this.es[eventName]\n      } else {\n        const listeners = this.es[eventName] || []\n        // clean the event and listener\n        let l = listeners.length\n        for (let i = 0; i < l; i++) {\n          if (listeners[i].cb === cb) {\n            listeners.splice(i, 1)\n            i--\n            l--\n          }\n        }\n      }\n    }\n  }\n\n  // cname of fire\n  emit(eventName: string, ...params: any[]) {\n    this.fire(eventName, ...params)\n  }\n}\n","import EE from './onfire'\n\nexport const EVENT_NODE_MOVING = 'NODE_MOVING'\nexport const EVENT_NODE_MOVE_END = 'NODE_MOVE_END'\n\nexport const EVENT_AUTO_LAYOUT = 'AUTO_LAYOUT'\n\nexport default new EE()\n","import React, { useCallback, useEffect, useMemo, useRef } from 'react'\nimport useDrag from '../../hooks/useDrag'\nimport { INodeType, ICoordinateType } from '../../types'\nimport { nodesConfig } from '../NodeTypes/config'\nimport { isEqual } from 'lodash-es'\nimport { useScale } from '../Context/DiagramManager'\nimport { DiagramNodePorts } from './DiagramNodePorts'\nimport classnames from 'classnames'\nimport { DiagramNodeActionButtons } from './DiagramNodeActionButtons'\nimport eventBus, { EVENT_NODE_MOVE_END, EVENT_NODE_MOVING } from '../../utils/eventBus'\n\ninterface DiagramNodeProps {\n  nodeInfo: INodeType\n  onNodePositionChange: (id: string, nextCoords: ICoordinateType) => void\n  onNodeValueChange: (id: string, nextNodeValue: any) => void\n  onAddHistory: (id: string, nextCoords: ICoordinateType) => void\n  onNodeMount: (id: string, dom: HTMLDivElement) => void\n  onNodeDelete: (nodeId: string) => void\n  onNodeCopy: (nodeId: string) => void\n  onToggleActiveNodeId: (nodeId: string) => void\n  isActive: boolean\n}\n\nexport const DiagramNode: React.FC<DiagramNodeProps> = React.memo((props) => {\n  const {\n    nodeInfo,\n    onNodeValueChange,\n    onNodePositionChange,\n    onNodeMount,\n    onAddHistory,\n    onToggleActiveNodeId,\n    isActive,\n    onNodeDelete,\n    onNodeCopy,\n  } = props\n\n  const { id, coordinates, type, inputs, data, outputs } = nodeInfo\n\n  const scale = useScale()\n\n  // nodeType\n  const nodeConfig = nodesConfig[type]\n\n  const handleNodeDataChange = (nextNodeData: any) => {\n    onNodeValueChange(id, nextNodeData)\n  }\n\n  // 传给子组件点 Props\n  const nodeItemProps = {\n    value: data,\n    onChange: handleNodeDataChange,\n    nodeId: id,\n    inputs: nodeConfig?.customRenderPort ? inputs : undefined,\n    outputs: nodeConfig?.customRenderPort ? outputs : undefined,\n  }\n\n  const ref: any = useRef(null)\n\n  const { onDragStart, onDrag, onDragEnd } = useDrag({ throttleBy: 16, ref }) // get the drag n drop methods\n  const dragStartPoint = useRef(coordinates) // keeps the drag start point in a persistent reference\n\n  // when drag starts, save the starting coordinates into the `dragStartPoint` ref\n  onDragStart(() => {\n    dragStartPoint.current = coordinates\n  })\n\n  // whilst dragging calculates the next coordinates and perform the `onNodePositionChange` callback\n  onDrag((event: MouseEvent, info: any) => {\n    event.stopImmediatePropagation()\n    event.stopPropagation()\n    const nextCoords: ICoordinateType = [\n      dragStartPoint.current[0] + info.offset[0] / scale,\n      dragStartPoint.current[1] + info.offset[1] / scale,\n    ]\n\n    onNodePositionChange(id, nextCoords)\n    eventBus.emit(EVENT_NODE_MOVING, id, nextCoords)\n  })\n\n  onDragEnd((event: MouseEvent) => {\n    if (!isEqual(dragStartPoint.current, coordinates)) {\n      onAddHistory(id, dragStartPoint.current)\n    }\n    eventBus.emit(EVENT_NODE_MOVE_END)\n  })\n\n  const handleClick = useCallback(\n    (event: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n      if (event.shiftKey) {\n        onToggleActiveNodeId(id)\n      }\n    },\n    [id, onToggleActiveNodeId]\n  )\n\n  useEffect(() => {\n    onNodeMount(id, ref.current)\n  }, [id, onNodeMount])\n\n  const className = useMemo(() => {\n    return classnames('diagram-node', {\n      active: isActive,\n    })\n  }, [isActive])\n\n  if (!nodeConfig.component) {\n    console.warn(`NodeType \"${type}\" does not exist`)\n\n    return null\n  }\n\n  return (\n    <div\n      id={id}\n      className={className}\n      ref={ref}\n      style={{ left: coordinates[0], top: coordinates[1] }}\n      onClick={handleClick}\n    >\n      {nodeConfig.component && React.createElement(nodeConfig.component, nodeItemProps)}\n      {!nodeConfig.customRenderPort && (\n        <>\n          <DiagramNodePorts ports={inputs} nodeId={id} type=\"input\" />\n          <DiagramNodePorts ports={outputs} nodeId={id} type=\"output\" />\n        </>\n      )}\n      <DiagramNodeActionButtons id={id} onNodeDelete={onNodeDelete} onNodeCopy={onNodeCopy} />\n    </div>\n  )\n})\n\nDiagramNode.displayName = 'DiagramNode'\n","import React from 'react'\nimport { DiagramNode } from './DiagramNode'\nimport { ICoordinateType, INodeType } from '../../types'\n\ninterface NodesCanvasProps {\n  nodes: INodeType[]\n  onNodeMount: (id: string, dom: HTMLDivElement) => void\n  activeNodeIds: string[]\n  onNodePositionChange: (id: string, nextCoords: ICoordinateType) => void\n  onNodeValueChange: (id: string, nextNodeValue: any) => void\n  onAddHistory: (id: string, nextCoords: ICoordinateType) => void\n  onNodeDelete: (nodeId: string) => void\n  onNodeCopy: (nodeId: string) => void\n  onToggleActiveNodeId: (nodeId: string) => void\n}\n\nexport const NodesCanvas: React.FC<NodesCanvasProps> = React.memo((props) => {\n  const { nodes, activeNodeIds, ...others } = props\n\n  return (\n    <>\n      {nodes.map((node) => (\n        <DiagramNode isActive={activeNodeIds.includes(node.id)} nodeInfo={node} key={node.id} {...others} />\n      ))}\n    </>\n  )\n})\n\nNodesCanvas.displayName = 'NodesCanvas'\n","import { ICoordinateType } from '../types'\n\nconst roundPoint = (point: ICoordinateType): ICoordinateType => [Math.floor(point[0]), Math.floor(point[1])]\n\n// 贝塞尔曲线算法\nconst makeBezierCurve = (from: ICoordinateType, to: ICoordinateType) => {\n  if (to[0] >= from[0]) {\n    return getCubicBezierPath(from, to)\n  } else {\n    return getAdvancedCubicBezierPath(from, to)\n  }\n}\n\nconst getPointsString = (points: ICoordinateType[]) => {\n  return points.map((item) => `${item[0]},${item[1]}`).join(' ')\n}\n\n// 正向 贝塞尔曲线\nconst getCubicBezierPath = (from: ICoordinateType, to: ICoordinateType) => {\n  const controlPointForStart: ICoordinateType = [(to[0] + from[0]) / 2, from[1]]\n  const controlPointForEnd: ICoordinateType = [(to[0] + from[0]) / 2, to[1]]\n\n  return `M ${from[0]},${from[1]} C ${getPointsString([controlPointForStart, controlPointForEnd])} ${to[0]},${to[1]}`\n}\n\n// 反向 贝塞尔曲线\nconst getAdvancedCubicBezierPath = (from: ICoordinateType, to: ICoordinateType) => {\n  const midX = (from[0] + to[0]) / 2\n  const midY = (from[1] + to[1]) / 2\n\n  return `M${from[0]},${from[1]} ${from[0] + 20},${from[1]} C ${from[0] + 100},${from[1]} ${from[0] + 130},${\n    (midY + from[1]) / 2\n  }  ${midX},${midY} C ${midX},${midY} ${to[0] - 130},${(midY + to[1]) / 2} ${to[0] - 2},${to[1]} M ${to[0] - 2},${\n    to[1]\n  } ${to[0]},${to[1]}`\n}\n\n/**\n * 生成连点之间的贝塞尔曲线\n */\nconst makeSvgPath = (startPoint?: ICoordinateType, endPoint?: ICoordinateType) => {\n  if (!startPoint || !endPoint) return ''\n  const roundedStart = roundPoint(startPoint)\n  const roundedEnd = roundPoint(endPoint)\n\n  // const start = `${roundedStart[0]}, ${roundedStart[1]}`\n  // const end = `${roundedEnd[0]}, ${roundedEnd[1]}`\n\n  // 生成 直线\n  // return `M ${start}, ${end}`\n\n  // 生成 曲线\n  return makeBezierCurve(roundedStart, roundedEnd)\n}\n\nexport default makeSvgPath\n","import React, { useCallback, useMemo, useRef } from 'react'\nimport makeSvgPath from '../../utils/makeSvgPath'\nimport { ICoordinateType, ILinkType } from '../../types'\nimport { isEqual } from 'lodash-es'\nimport { computedLinkSvgInfo } from '../../utils'\n\ninterface LinkProps {\n  input: ICoordinateType\n  output: ICoordinateType\n  link: ILinkType\n  onDelete: (link: ILinkType) => void\n}\n\nexport const Link: React.FC<LinkProps> = React.memo(\n  (props) => {\n    const { input, output, link, onDelete } = props\n    const svgRef = useRef<SVGSVGElement>(null)\n\n    /*\n     * 画出 link 的 svg 矩形容器，和位置，并且重新计算在 矩形容器内的起点和终点\n     * */\n    const { width, height, left, top, start, end } = useMemo(() => computedLinkSvgInfo(input, output), [input, output])\n\n    /*\n     * 根据两点坐标生成 svg path 路径\n     * */\n    const path = useMemo(() => makeSvgPath(start as ICoordinateType, end as ICoordinateType), [start, end])\n\n    const handleDelete = useCallback(() => {\n      onDelete(link)\n    }, [onDelete, link])\n\n    const handleMouseOver = useCallback(() => {\n      svgRef.current?.classList.add('hover')\n    }, [])\n\n    const handleMouseOut = useCallback(() => {\n      svgRef.current?.classList.remove('hover')\n    }, [])\n\n    return (\n      <svg\n        ref={svgRef}\n        className={'diagram-link'}\n        style={{ left, top }}\n        width={width}\n        height={height}\n        pointerEvents=\"none\"\n      >\n        <path d={path} className=\"bi-link-path\" />\n        <path\n          d={path}\n          className=\"bi-link-ghost\"\n          onDoubleClick={handleDelete}\n          onMouseOver={handleMouseOver}\n          onMouseOut={handleMouseOut}\n        />\n      </svg>\n    )\n  },\n  (prev, next) => {\n    /*\n     *  memo 默认是浅比较 只比较 props 第一层\n     *  由于 props 上面 的 input output 等属性在外层每次会重新创建 导致浅层 比较地址 永远等于 false ，使得组件每次都会render 导致memo无效\n     * 所以使用 isEqual 进行值的比较 进行优化\n     */\n    return isEqual(prev, next)\n  }\n)\n\nLink.displayName = 'Link'\n","import React, { useMemo } from 'react'\nimport { Link } from './Link'\nimport { ILinkType, INodeType, ICoordinateType, IPortRefs, INodeRefs, IPointType } from '../../types'\nimport { useDiagramManager } from '../Context/DiagramManager'\n\ninterface LinkCanvasProps {\n  nodes: INodeType[]\n  links: ILinkType[]\n  onDelete: (link: ILinkType) => void\n}\n\n/*\n * link 起点终点 数据类型\n * */\nexport interface EntityPutType {\n  startCoordinates: ICoordinateType\n  endCoordinates: ICoordinateType\n  link: ILinkType\n}\n\nexport const LinksCanvas: React.FC<LinkCanvasProps> = React.memo((props) => {\n  const { nodes, onDelete, links } = props\n\n  const { canvasRef, portRefs, nodeRefs, scale } = useDiagramManager()\n\n  const result = useMemo(() => {\n    const res: EntityPutType[] = []\n\n    links.forEach((link) => {\n      const { input, output } = link\n      const startCoordinates = computedLinkCoordinate({\n        nodes,\n        entityId: input,\n        nodeRefs,\n        portRefs,\n        canvasRef,\n        scale,\n      })\n      const endCoordinates = computedLinkCoordinate({\n        nodes,\n        entityId: output,\n        nodeRefs,\n        portRefs,\n        canvasRef,\n        scale,\n      })\n      if (startCoordinates && endCoordinates) {\n        res.push({\n          link,\n          startCoordinates,\n          endCoordinates,\n        })\n      }\n    })\n    return res\n    //  eslint-disable-next-line\n  }, [nodes, links, nodeRefs, portRefs, canvasRef]) // 不要依赖 scale 因为缩放的时候不用重新计算位置\n\n  return (\n    <>\n      {result.map((item) => (\n        <Link\n          link={item.link}\n          input={item.startCoordinates}\n          output={item.endCoordinates}\n          onDelete={onDelete}\n          key={`${item.link.input}-${item.link.output}`}\n        />\n      ))}\n    </>\n  )\n})\nLinksCanvas.displayName = 'LinksCanvas'\n\n/*\n * 计算点相对于node左上角的相对值\n */\nexport const calculatingPortRelativeNode = (nodeDom: Element, portDom: Element, scale: number) => {\n  const nodeRect = nodeDom.getBoundingClientRect()\n  const portRect = portDom.getBoundingClientRect()\n  return {\n    offsetLeft: (portRect.left - nodeRect.left) / scale,\n    offsetTop: (portRect.top - nodeRect.top) / scale,\n  }\n}\n\n/*\n * 计算点的坐标\n */\n\ninterface IFindPortCoordinate {\n  nodeCoordinates: ICoordinateType\n  ports: IPointType[]\n  entityId: string\n  portRefs: IPortRefs\n  nodeDom: HTMLDivElement\n  scale: number\n}\nconst findPortCoordinate = ({\n  nodeCoordinates,\n  ports,\n  entityId,\n  portRefs,\n  nodeDom,\n  scale,\n}: IFindPortCoordinate): ICoordinateType | null => {\n  for (let j = 0; j < ports.length; j++) {\n    const input = ports[j]\n\n    if (input.id === entityId) {\n      const portDom = portRefs[entityId]\n\n      if (!portDom) return null\n\n      // const { offsetLeft, offsetTop, offsetWidth, offsetHeight } = portDom\n      const { offsetWidth, offsetHeight } = portDom\n      // 不依赖 position absolute 定位 可以随意渲染 port 位置\n      const { offsetLeft, offsetTop } = calculatingPortRelativeNode(nodeDom, portDom, scale)\n\n      return [nodeCoordinates[0] + offsetLeft + offsetWidth / 2, nodeCoordinates[1] + offsetTop + offsetHeight / 2]\n    }\n  }\n  return null\n}\n\n/*\n * 计算 link 起点终点坐标\n * 1. 如果找到 id 是 node 类型线，实际坐标为 x 为该 node 的 left 值，y坐标为该node 的 top + node高度的一半\n * 2. 如果找到 id 是 port 类型线，实际坐标为 x 为该 port 的 父元素 node 的 left + 点相对 node 的偏移量 +点的宽度的一半，y 轴坐标同理\n * */\ninterface IComputedLinkCoordinate {\n  nodes: INodeType[]\n  entityId: string\n  nodeRefs: INodeRefs\n  portRefs: IPortRefs\n  canvasRef: HTMLDivElement | null\n  scale: number\n}\n\nconst computedLinkCoordinate = ({\n  nodes,\n  entityId,\n  nodeRefs,\n  portRefs,\n  canvasRef,\n  scale,\n}: IComputedLinkCoordinate): ICoordinateType | null => {\n  for (let i = 0; i < nodes.length; i++) {\n    const node = nodes[i]\n    const nodeEl = nodeRefs[node.id]\n\n    // 如果 id 是 nodeId\n    if (node.id === entityId) {\n      if (!nodeEl) return null\n      return [node.coordinates[0], node.coordinates[1] + nodeEl.offsetHeight / 2]\n    } else {\n      const inputRes = findPortCoordinate({\n        nodeCoordinates: node.coordinates,\n        ports: node.inputs,\n        entityId,\n        portRefs,\n        nodeDom: nodeEl,\n        scale,\n      })\n      if (inputRes) return inputRes\n\n      const outputRes = findPortCoordinate({\n        nodeCoordinates: node.coordinates,\n        ports: node.outputs,\n        entityId,\n        portRefs,\n        nodeDom: nodeEl,\n        scale,\n      })\n\n      if (outputRes) return outputRes\n    }\n  }\n  return null\n}\n","import React, { useMemo } from 'react'\nimport makeSvgPath from '../../utils/makeSvgPath'\nimport { ISegmentType } from '../../types'\n\nexport interface SegmentProps {\n  segment: ISegmentType\n}\n\nexport const Segment: React.FC<SegmentProps> = React.memo(({segment}) => {\n  const {from, to, id} = segment\n  const path = useMemo(() => makeSvgPath(from, to), [from, to])\n\n  return (\n    <svg className=\"diagram-segment-canvas\">\n      <g className=\"diagram-segment-link\" id={id}>\n        <path d={path}/>\n        <circle r=\"5\" cx={to[0]} cy={to[1]}/>\n      </g>\n    </svg>\n  )\n})\n\nSegment.displayName = 'Segment'\n\n\n","import { useLayoutEffect, useMemo, useRef } from 'react'\n\ntype Fn<ARGS extends any[], R> = (...args: ARGS) => R\nconst useEventCallback = <A extends any[], R>(fn: Fn<A, R>): Fn<A, R> => {\n  let ref = useRef(fn)\n  useLayoutEffect(() => {\n    ref.current = fn\n  })\n  return useMemo(\n    () => (...args) => {\n      const { current } = ref\n      return current(...args)\n    },\n    []\n  )\n}\nexport default useEventCallback\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport { ICoordinateType, NodeTypeEnum } from '../../types'\nimport { nodesList } from '../NodeTypes/config'\n\nexport interface SelectModelProps {\n  position?: ICoordinateType\n  onChange: (nodeType?: NodeTypeEnum) => void\n}\n\nexport const SelectModel: React.FC<SelectModelProps> = React.memo((prop) => {\n  const { position, onChange } = prop\n\n  if (!position) {\n    return null\n  }\n\n  const handleClose = () => {\n    onChange()\n  }\n\n  const handleItemClick = (event: React.MouseEvent<HTMLLIElement, MouseEvent>) => {\n    onChange(event.currentTarget.dataset.type as NodeTypeEnum)\n  }\n  const stopEvent = (event: React.MouseEvent<HTMLUListElement, MouseEvent>) => {\n    event.stopPropagation()\n  }\n\n  return ReactDOM.createPortal(\n    <div className=\"select-model\" onClick={handleClose}>\n      <ul\n        className=\"select-model-content\"\n        style={{ left: position[0], top: position[1], position: 'absolute' }}\n        onClick={stopEvent}\n      >\n        {nodesList.map((node) => (\n          <li key={node.type} className=\"select-model-item\" onClick={handleItemClick} data-type={node.type}>\n            {node.icon && React.createElement(node.icon)}\n            <div className=\"select-model-text\">{node.label}</div>\n          </li>\n        ))}\n      </ul>\n    </div>,\n    document.body\n  )\n})\n\nSelectModel.displayName = 'SelectModel'\n","import { groupBy, isEqual, maxBy, omit } from 'lodash-es'\nimport { getNodeStyle } from '.'\nimport { IDiagramType, ILinkType, INodeRefs, INodeStyle, INodeType, IPointType } from '../types'\n\nconst checkPortIsNodeSon = (ports: IPointType[], entityId: string) => {\n  for (let j = 0; j < ports.length; j++) {\n    const input = ports[j]\n    if (input.id === entityId) {\n      return true\n    }\n  }\n  return false\n}\n\nconst findPortFatherNodeId = (entityId: string, nodes: INodeType[]) => {\n  for (let i = 0; i < nodes.length; i++) {\n    const node = nodes[i]\n    // 如果 id 是 nodeId\n    if (node.id === entityId) {\n      return node.id\n    } else {\n      if (checkPortIsNodeSon(node.inputs, entityId)) return node.id\n      if (checkPortIsNodeSon(node.outputs, entityId)) return node.id\n    }\n  }\n  return entityId\n}\n\nconst checkIsStartLink = (linkInput: string, links: ILinkType[], nodes: INodeType[]) =>\n  !links.find((link) => link.output === findPortFatherNodeId(linkInput, nodes))\n\ninterface ExtendActionDto extends INodeType {\n  row: number\n  column: number\n  style: INodeStyle\n}\n\n/*\n * 自动排列 需要根据实际的点和线 连接放松排列 这里的自动排列涵盖情况有限 重新排列效果仅供参考\n */\nexport default function autoLayout(value: IDiagramType, nodeRefs: INodeRefs) {\n  const { links = [], nodes = [] } = value\n  let row = 1\n  const extendNodes = nodes.map((node) => {\n    return {\n      ...node,\n      row: 0,\n      column: 0,\n      style: getNodeStyle(nodeRefs[node.id]),\n    }\n  })\n\n  const recursionLookup = (\n    linkEndId: string,\n    baseColumn: number,\n    extendNodes: ExtendActionDto[],\n    links: ILinkType[],\n    catchNodeIds: string[]\n  ) => {\n    if (catchNodeIds.includes(linkEndId)) return\n    catchNodeIds.push(linkEndId)\n    const currentNode = extendNodes.find((node) => node.id === findPortFatherNodeId(linkEndId, extendNodes))\n    if (!currentNode) return\n    currentNode.row = currentNode.row || row\n    currentNode.column = currentNode.column || baseColumn\n    baseColumn++\n    let outputHasLinkNum = 0\n\n    currentNode.outputs.forEach((port) => {\n      const findLink = links.find((link) => link.input === port.id)\n      if (findLink) {\n        outputHasLinkNum++\n        if (outputHasLinkNum > 1) {\n          row++\n        }\n        recursionLookup(findLink.output, baseColumn, extendNodes, links, catchNodeIds)\n      }\n    })\n  }\n\n  links.forEach((link) => {\n    if (checkIsStartLink(link.input, links, extendNodes)) {\n      const portFatherNodeId = findPortFatherNodeId(link.input, extendNodes)\n      const catchNodeIds = [portFatherNodeId]\n      const currentNode = extendNodes.find((node) => node.id === portFatherNodeId)\n      if (!currentNode) return\n      currentNode.row = currentNode.row || row\n      currentNode.column = 1\n      recursionLookup(link.output, 2, extendNodes, links, catchNodeIds)\n      row++\n    }\n  })\n\n  // if is init data update row and column\n  extendNodes.forEach((node) => {\n    if (node.row === 0) {\n      node.row = row\n      node.column = 1\n      row++\n    }\n  })\n\n  const extendNodesCopy = [...extendNodes]\n  extendNodesCopy.forEach(({ outputs }) => {\n    const nextNodeIds: string[] = []\n    outputs.forEach((port) => {\n      if (port.isLinked) {\n        const findLink = links.find((link) => link.input === port.id)\n        if (findLink) {\n          nextNodeIds.push(findLink.output)\n        }\n      }\n    })\n    extendNodes.sort((a, b) => {\n      return nextNodeIds.findIndex((nodeId) => a.id === nodeId) - nextNodeIds.findIndex((nodeId) => b.id === nodeId)\n    })\n  })\n\n  const SPACING = 50\n  const LAYOUT_BASIC_COORDINATE = {\n    LEFT: 100,\n    TOP: 100,\n  }\n\n  const COLUMN_STEP_WIDTH = 200 + SPACING\n  const groupRowMap = groupBy(extendNodes, (item) => item.row)\n  const groupRows = Object.values(groupRowMap)\n\n  // row start top\n  let currentTop = LAYOUT_BASIC_COORDINATE.TOP\n\n  groupRows.forEach((aRow, rowIndex) => {\n    // sort by column\n    aRow.sort((a, b) => a.column - b.column)\n\n    aRow.forEach((cell, cellIndex) => {\n      if (cellIndex === 0 && rowIndex > 0) {\n        const preRow = groupRows[rowIndex - 1]\n\n        const currentAfterPreRow = preRow.filter((preCell) => preCell.column >= cell.column)\n\n        const currentAfterPreRowMaxHeightList = currentAfterPreRow.map((cell) => cell.style.height)\n\n        const rowMaxHeight = maxBy(currentAfterPreRowMaxHeightList) || 0\n        currentTop += rowMaxHeight + SPACING\n      }\n      if (cell.column) {\n        cell.coordinates = [(cell.column - 1) * COLUMN_STEP_WIDTH + LAYOUT_BASIC_COORDINATE.LEFT, currentTop]\n      }\n    })\n  })\n\n  const newNodes = extendNodes.map((node) => {\n    return {\n      ...omit(node, 'column', 'row', 'style'),\n    }\n  })\n  return { links: links, nodes: newNodes }\n}\n\nexport const diffNodesCoordinates = (oldNodes: INodeType[], newNodes: INodeType[]) => {\n  return newNodes.some(({ id, coordinates }) => {\n    const find = oldNodes.find((item) => item.id === id)\n    if (!find) {\n      return true\n    } else if (!isEqual(find.coordinates, coordinates)) {\n      return true\n    } else {\n      return false\n    }\n  })\n}\n\nconst toFixed2 = (num: number) => Number(num.toFixed(2))\n\nexport const computedAnimationStep = (\n  oldNodes: INodeType[],\n  newNodes: INodeType[],\n  stepCount: number\n): INodeTypeWithStep[] => {\n  return oldNodes.map((node) => {\n    const findNextNode = newNodes.find((item) => item.id === node.id)\n    const xStep = findNextNode ? toFixed2((findNextNode.coordinates[0] - node.coordinates[0]) / stepCount) : 0\n    const yStep = findNextNode ? toFixed2((findNextNode.coordinates[1] - node.coordinates[1]) / stepCount) : 0\n    return {\n      ...node,\n      xStep,\n      yStep,\n    }\n  })\n}\n\ninterface INodeTypeWithStep extends INodeType {\n  xStep: number\n  yStep: number\n}\n\ninterface IAutoLayoutAnimation {\n  originNodes: INodeType[]\n  futureNodes: INodeType[]\n  animationFn: (nodes: INodeType[]) => void\n  stepCount: number\n}\n\nexport const autoLayoutAnimation = ({ originNodes, futureNodes, animationFn, stepCount }: IAutoLayoutAnimation) => {\n  return new Promise((resolve, reject) => {\n    try {\n      let animationCount = 0\n      let nodeWithStep: INodeTypeWithStep[] = computedAnimationStep(originNodes, futureNodes, stepCount)\n      const step = () => {\n        animationCount = animationCount + 1\n        nodeWithStep = nodeWithStep.map((item) => {\n          return {\n            ...item,\n            coordinates: [item.coordinates[0] + item.xStep, item.coordinates[1] + item.yStep],\n          }\n        })\n        const nextNodes: INodeType[] = nodeWithStep.map((item) => ({ ...omit(item, ['xStep', 'yStep']) }))\n\n        animationFn(nextNodes)\n\n        if (animationCount < stepCount) {\n          requestAnimationFrame(step)\n        } else {\n          animationFn(futureNodes) // 最后多执行一次保证位置正确\n          resolve(futureNodes)\n        }\n      }\n      requestAnimationFrame(step)\n    } catch (error) {\n      reject(error)\n    }\n  })\n}\n","import { useEffect } from 'react'\nimport eventBus from '../utils/eventBus'\n\ninterface UseEventType {\n  type: string\n  onChange: any\n}\nconst useEventBus = ({ type, onChange }: UseEventType, dep = []) => {\n  useEffect(() => {\n    eventBus.on(type, onChange)\n    return () => {\n      eventBus.off(type, onChange)\n    }\n  }, [type, onChange, dep])\n}\nexport default useEventBus\n","import { ICoordinateType, IDiagramType, INodeType, IPasteLinkType, ITransform } from '../types'\nimport { v4 as uuidv4 } from 'uuid'\nimport { cloneDeep, minBy } from 'lodash-es'\nimport { getNodeStyle } from '.'\n\n/*\n * 生成copy数据\n */\nexport const createCopyValue = (value: IDiagramType, activeNodeIds: string[]) => {\n  const newNodes = value.nodes.filter((node) => activeNodeIds.includes(node.id))\n\n  // 1. 找到原始 node 边界\n  const minX = minBy(newNodes, 'coordinates[0]')?.coordinates[0] || 0\n  const minY = minBy(newNodes, 'coordinates[1]')?.coordinates[1] || 0\n\n  return {\n    nodes: newNodes.map((node) => ({\n      ...node,\n      coordinates: [node.coordinates[0] - minX, node.coordinates[1] - minY],\n    })),\n    links: value.links,\n  }\n}\n\nconst updatePasteLink = (links: IPasteLinkType[], oldId: string, newId: string) =>\n  links.map((link) => {\n    const inputUpdated = link.input === oldId\n    const outputUpdated = link.output === oldId\n    return {\n      ...link,\n      input: inputUpdated ? newId : link.input,\n      output: outputUpdated ? newId : link.output,\n      inputUpdated: inputUpdated || link.inputUpdated,\n      outputUpdated: outputUpdated || link.outputUpdated,\n    }\n  })\n\n/*\n * 生成copy数据\n */\nexport const createPasteValue = (value: IDiagramType, offset: { x: number; y: number }) => {\n  let newLinks: IPasteLinkType[] = value.links\n\n  const newNodes = value.nodes.map((item) => {\n    const newNodeId = uuidv4()\n    const newCoordinates: ICoordinateType = [item.coordinates[0] + offset.x, item.coordinates[1] + offset.y]\n    newLinks = updatePasteLink(newLinks, item.id, newNodeId)\n\n    return {\n      ...item,\n      // 重新设置 node 坐标\n      coordinates: newCoordinates,\n      inputs: item.inputs.map((port) => {\n        const newPortId = uuidv4()\n        newLinks = updatePasteLink(newLinks, port.id, newPortId)\n\n        return { ...port, id: newPortId }\n      }),\n      outputs: item.outputs.map((port) => {\n        const newPortId = uuidv4()\n        newLinks = updatePasteLink(newLinks, port.id, newPortId)\n\n        return { ...port, id: newPortId }\n      }),\n      id: newNodeId,\n    }\n  })\n\n  return {\n    nodes: newNodes,\n    links: newLinks\n      .filter((link) => link.inputUpdated && link.outputUpdated)\n      .map(({ inputUpdated, outputUpdated, ...link }) => ({ ...link })),\n  }\n}\n\n/*\n * 计算在屏幕范围的中心位置，在 画布内的坐标\n */\nexport const calculatePasteOriginCoordination = (transform: ITransform, panelDom: HTMLDivElement) => {\n  const { scale, translateX, translateY } = transform\n  const { width, height } = getNodeStyle(panelDom)\n\n  return {\n    x: -translateX / scale + width / scale / 3,\n    y: -translateY / scale + height / scale / 2,\n  }\n}\n\nexport const createSinglePasteValue = (originNode: INodeType): INodeType => {\n  const nodeData = cloneDeep(originNode)\n\n  return {\n    ...nodeData,\n    id: uuidv4(),\n    outputs: nodeData.outputs.map((output) => ({\n      id: uuidv4(),\n      isLinked: false,\n    })),\n    inputs: nodeData.outputs.map((input) => ({\n      id: uuidv4(),\n      isLinked: false,\n    })),\n    coordinates: [nodeData.coordinates[0] + 20, nodeData.coordinates[1] + 20],\n  }\n}\n","import React, { useCallback, useState, useRef } from 'react'\nimport { DiagramCanvas } from './DiagramCanvas'\nimport { NodesCanvas } from './NodesCanvas'\nimport { LinksCanvas } from './LinksCanvas'\nimport { Segment } from './Segment'\nimport './style.scss'\nimport {\n  IDiagramType,\n  ILinkType,\n  ISegmentType,\n  IPortRefs,\n  INodeRefs,\n  ITransform,\n  ICoordinateType,\n  NodeTypeEnum,\n  INodeType,\n} from '../../types'\nimport { isEqual } from 'lodash-es'\nimport useEventCallback from '../../hooks/useEventCallback'\nimport { batchUpdateCoordinates, calculatingCoordinates, findIndexById, oneNodeDelete } from '../../utils'\nimport { createNode } from '../NodeTypes/config'\n// import { MarkLine } from './MarkLine'\nimport { SelectModel } from './SelectModel'\nimport autoLayout, { autoLayoutAnimation, diffNodesCoordinates } from '../../utils/autoLayout'\nimport { EVENT_AUTO_LAYOUT } from '../../utils/eventBus'\nimport useEventBus from '../../hooks/useEventBus'\nimport { createSinglePasteValue } from '../../utils/copyPaste'\ninterface DiagramProps {\n  value: IDiagramType\n  onChange: (value: IDiagramType, notAddHistory?: boolean) => void\n  onAddHistory: (value: IDiagramType) => void\n  transform: ITransform\n  activeNodeIds: string[]\n  onToggleActiveNodeId: (nodeId: string) => void\n}\nconst STEP_COUNT = 60 // auto layout 动画执行总次数\n\nexport const Diagram: React.FC<DiagramProps> = React.memo((props) => {\n  const { value, onChange, onAddHistory, transform, activeNodeIds, onToggleActiveNodeId } = props\n  const [segment, setSegment] = useState<ISegmentType | undefined>()\n  const [selectModelPosition, setSelectModelPosition] = useState<ICoordinateType>()\n  const { current: portRefs } = useRef<IPortRefs>({}) // 保存所有 Port 的 Dom 节点\n  const { current: nodeRefs } = useRef<INodeRefs>({}) // 保存所有 Node 的 Dom 节点\n  const startPortIdRef = useRef<string>() // 保存所有 Node 的 Dom 节点\n  const isAutoLayoutRef = useRef<boolean>(false) // 保存所有 Node 的 Dom 节点\n\n  const handleNodePositionChange = useEventCallback((nodeId: string, nextCoordinates: ICoordinateType) => {\n    const nextNodes = batchUpdateCoordinates(nodeId, nextCoordinates, value.nodes, activeNodeIds)\n    onChange({ ...value, nodes: nextNodes }, true)\n  })\n\n  const handleNodeValueChange = useEventCallback((nodeId: string, nextNodeValue: any) => {\n    const nextNodes = [...value.nodes]\n    const index = findIndexById(nodeId, nextNodes)\n    nextNodes[index] = { ...nextNodes[index], data: nextNodeValue }\n    onChange({ ...value, nodes: nextNodes })\n  })\n\n  const handleAddHistory = useEventCallback((nodeId: string, nextCoordinates: ICoordinateType) => {\n    const nextNodes = batchUpdateCoordinates(nodeId, nextCoordinates, value.nodes, activeNodeIds)\n    onAddHistory({ ...value, nodes: nextNodes })\n  })\n\n  const handleNodeCopy = useEventCallback((nodeId: string) => {\n    const index = findIndexById(nodeId, value.nodes)\n    const newNode = createSinglePasteValue(value.nodes[index])\n    onChange({ ...value, nodes: [...value.nodes, newNode] })\n  })\n\n  const handleNodeDelete = useEventCallback((nodeId: string) => {\n    const nextValue = oneNodeDelete(value, nodeId)\n    onChange(nextValue)\n  })\n\n  // when a port is registered, save it to the local reference\n  const onPortRegister = useEventCallback((portId: string, portEl: HTMLElement) => {\n    portRefs[portId] = portEl\n  })\n\n  // when a node is registered, save it to the local reference\n  const onNodeRegister = useEventCallback((nodeId: string, nodeEl: HTMLDivElement) => {\n    // const rect = nodeEl.getBoundingClientRect()\n    nodeRefs[nodeId] = nodeEl\n  })\n\n  // when a new segment is dragged, save it to the local state\n  const onDragNewSegment = useCallback((portId, from, to) => {\n    setSegment({ id: `segment-${portId}`, from, to })\n  }, [])\n\n  // when a segment fails to connect, reset the segment state\n  const onSegmentFail = useCallback(() => {\n    setSegment(undefined)\n  }, [])\n\n  const onShowSelectModel = useEventCallback((event: MouseEvent, input: string) => {\n    startPortIdRef.current = input\n    setSelectModelPosition([event.clientX, event.clientY])\n    setSegment(undefined)\n  })\n\n  // when a segment connects, update the links schema, perform the onChange callback\n  // with the new data, then reset the segment state\n  const onSegmentConnect = useEventCallback((input: string, output: string) => {\n    const linkIsExists = value.links.findIndex((link) => link.input === input && link.output === output) > -1\n    if (!linkIsExists) {\n      const nextLinks = [...value.links, { input, output }]\n\n      onChange({ ...value, links: nextLinks })\n    }\n    setSegment(undefined)\n  })\n\n  // when links change, performs the onChange callback with the new incoming data\n  const onLinkDelete = useEventCallback((link: ILinkType) => {\n    const nextLinks = value.links.filter((item) => !isEqual(item, link))\n    onChange({ ...value, links: nextLinks })\n  })\n\n  const handleSelectModelChange = useEventCallback((nodeType?: NodeTypeEnum) => {\n    if (nodeType && selectModelPosition) {\n      const coordinates: ICoordinateType = calculatingCoordinates(\n        { clientX: selectModelPosition[0], clientY: selectModelPosition[1] } as MouseEvent,\n        document.getElementById('diagram-canvas'),\n        transform.scale\n      )\n      const newNode = createNode(nodeType, coordinates)\n      onChange({ ...value, nodes: [...value.nodes, newNode] })\n      // nodes 更新后 渲染 link\n      setTimeout(() => {\n        onSegmentConnect(startPortIdRef.current || '', newNode.id)\n      }, 20)\n    }\n    setSelectModelPosition(undefined)\n  })\n\n  const handleAutoLayout = useCallback(() => {\n    const nextValue = autoLayout(value, nodeRefs)\n    if (diffNodesCoordinates(value.nodes, nextValue.nodes) && !isAutoLayoutRef.current) {\n      const params = {\n        originNodes: value.nodes,\n        futureNodes: nextValue.nodes,\n        animationFn: (nodes: INodeType[]) => onChange({ ...nextValue, nodes: nodes }, true),\n        stepCount: STEP_COUNT,\n      }\n      isAutoLayoutRef.current = true\n\n      autoLayoutAnimation(params)\n        .then(() => {\n          onAddHistory(value) // 成功后把原始位置追加到历史记录\n        })\n        .finally(() => (isAutoLayoutRef.current = false))\n    }\n  }, [value, nodeRefs, onChange, onAddHistory, isAutoLayoutRef])\n\n  useEventBus({ type: EVENT_AUTO_LAYOUT, onChange: handleAutoLayout })\n\n  return (\n    <DiagramCanvas\n      portRefs={portRefs}\n      nodeRefs={nodeRefs}\n      transform={transform}\n      onDragNewSegment={onDragNewSegment}\n      onSegmentFail={onSegmentFail}\n      onSegmentConnect={onSegmentConnect}\n      onShowSelectModel={onShowSelectModel}\n      onPortMount={onPortRegister}\n    >\n      <NodesCanvas\n        nodes={value.nodes}\n        onNodeMount={onNodeRegister}\n        onNodePositionChange={handleNodePositionChange}\n        onNodeValueChange={handleNodeValueChange}\n        onNodeDelete={handleNodeDelete}\n        onNodeCopy={handleNodeCopy}\n        onAddHistory={handleAddHistory}\n        onToggleActiveNodeId={onToggleActiveNodeId}\n        activeNodeIds={activeNodeIds}\n      />\n      {value.links.length > 0 && <LinksCanvas nodes={value.nodes} links={value.links} onDelete={onLinkDelete} />}\n      {segment && <Segment segment={segment} />}\n      {/* <MarkLine onNodePositionChange={handleNodePositionChange} /> */}\n      <SelectModel position={selectModelPosition} onChange={handleSelectModelChange} />\n    </DiagramCanvas>\n  )\n})\n\nDiagram.displayName = 'Diagram'\n","import { useReducer, useCallback } from 'react'\nimport { IDiagramType } from '../types'\n\n// 初始化useReducer中的state\nconst initialState = {\n  // 当我们每次添加新state时，用来储存更新前状态的数组\n  past: [],\n  // 当前的state值\n  present: null,\n  // 让我们可以用使用重做功能的，future数组\n  future: [],\n}\n\n// 根据action处理state的改变\nconst reducer = (state: any, action: any) => {\n  const { past, present, future } = state\n  const { newPresent } = action\n\n  switch (action.type) {\n    case 'UNDO':\n      const previous = past[past.length - 1]\n      const newPast = past.slice(0, past.length - 1)\n\n      return {\n        past: newPast,\n        present: previous,\n        future: [present, ...future],\n      }\n    case 'REDO':\n      const next = future[0]\n      const newFuture = future.slice(1)\n\n      return {\n        past: [...past, present],\n        present: next,\n        future: newFuture,\n      }\n    case 'SET':\n      return {\n        past: [...past],\n        present: newPresent,\n        future: [],\n      }\n\n    case 'SET_WIDTH_HISTORY':\n      if (newPresent === present) {\n        return state\n      }\n      return {\n        past: [...past, present],\n        present: newPresent,\n        future: [],\n      }\n\n    case 'ADD_A_HISTORY':\n      if (newPresent === present) {\n        return state\n      }\n      return {\n        past: [...past, newPresent],\n        present: present,\n        future: [],\n      }\n\n    case 'CLEAR':\n      const { initialPresent } = action\n\n      return {\n        ...initialState,\n        present: initialPresent,\n      }\n  }\n}\n\n// Hook\nexport const useHistory = (initialPresent: IDiagramType) => {\n  const [state, dispatch] = useReducer(reducer, {\n    ...initialState,\n    present: initialPresent,\n  })\n\n  const canUndo = state.past.length !== 0\n  const canRedo = state.future.length !== 0\n\n  const undo = useCallback(() => {\n    if (canUndo) {\n      dispatch({ type: 'UNDO' })\n    }\n  }, [canUndo, dispatch])\n\n  const redo = useCallback(() => {\n    if (canRedo) {\n      dispatch({ type: 'REDO' })\n    }\n  }, [canRedo, dispatch])\n\n  // 只设置值 不追加历史记录 例如 移动 node的过程不需要记录\n  const set = useCallback((newPresent) => dispatch({ type: 'SET', newPresent }), [dispatch])\n\n  // 设置值 并且追加历史记录 例如 增加删除节点，修改节点data数据等\n  const setWithHistory = useCallback((newPresent) => dispatch({ type: 'SET_WIDTH_HISTORY', newPresent }), [dispatch])\n\n  // 仅追加一条历史记录不设置值 例如 节点移动后，把节点拖拽的起始位置 追加进入历史栈\n  const addAHistory = useCallback((newPresent) => dispatch({ type: 'ADD_A_HISTORY', newPresent }), [dispatch])\n\n  const clear = useCallback(() => dispatch({ type: 'CLEAR', initialPresent }), [dispatch, initialPresent])\n\n  return { present: state.present, set, setWithHistory, addAHistory, undo, redo, clear, canUndo, canRedo }\n}\n","import React from 'react'\n\nimport './style.scss'\nimport IconClick from '../../static/icon-click.png'\nimport IconMove from '../../static/icon-move.png'\nimport IconWheel from '../../static/icon-wheel.png'\nimport { isMac } from '../../utils'\n\nexport interface ShortcutsPanelProps {}\n\nconst CTRL_OR_CMD = isMac ? 'CMD' : 'Ctrl'\n// const ALT_OR_OPT = isMac ? 'OPT' : 'Alt'\n\nconst hotkeyList = [\n  { text: '撤销', hotKeys: [{ key: CTRL_OR_CMD }, { key: 'Z' }] },\n  { text: '多选', hotKeys: [{ key: 'Shift' }, { icon: IconClick }] },\n  { text: '重做', hotKeys: [{ key: CTRL_OR_CMD }, { key: 'Shift' }, { key: 'Z' }] },\n  { text: '全选', hotKeys: [{ key: CTRL_OR_CMD }, { key: 'A' }] },\n  { text: '复制', hotKeys: [{ key: CTRL_OR_CMD }, { key: 'C' }] },\n  { text: '缩放', hotKeys: [{ key: CTRL_OR_CMD }, { icon: IconWheel }] },\n  { text: '粘贴', hotKeys: [{ key: CTRL_OR_CMD }, { key: 'V' }] },\n  { text: '移动画布', hotKeys: [{ key: 'Space' }, { icon: IconMove }] },\n  { text: '删除', hotKeys: [{ key: 'Del' }] },\n  // { text: '自动排列', hotKeys: [{ key: CTRL_OR_CMD }, { key: 'Shift' }, { key: 'A' }] },\n]\n\nexport const ShortcutsPanel: React.FC<ShortcutsPanelProps> = React.memo(() => {\n  return (\n    <ul className=\"shortcuts-panel\">\n      {hotkeyList.map((item, index) => (\n        <li key={index} className=\"shortcuts-panel-item\">\n          <div className=\"shortcuts-panel-title\">{item.text} :</div>\n          <div className=\"shortcuts-panel-list\">\n            {item.hotKeys.map((keyItem, keyIndex) => (\n              <React.Fragment key={keyIndex}>\n                {keyIndex > 0 && <span className=\"shortcuts-panel-plus\">+</span>}\n                <div className=\"shortcuts-panel-key\">\n                  {keyItem.key}\n                  {keyItem.icon && <img className=\"shortcuts-panel-icon\" src={keyItem.icon} alt={item.text} />}\n                </div>\n              </React.Fragment>\n            ))}\n          </div>\n        </li>\n      ))}\n    </ul>\n  )\n})\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAE8ElEQVRoQ+2ZbWibVRTH/+c+6YugTKjMTVaoTBRBcFBRHCpVvw3FJmkc7sv8IO1sm3RTaZNqWdyHPunswCVrXQu6itjh0jRxU/ZpWFEYsk0niqK2UFDsVrYxcYy+5LlHbmpqDGlznydFWmy/tfe8/H/3nHse7i1hjf9QKfobAqHzyn8kaj5USpxSfIsC+Hw+Ix6PW4WSrHoAd0voGSHYOzd7reXU4ODNfIhVDeALh8v56kwKRBsl0zfzs1fa8iFWNYDa7fo9wRqjjAaIUCUZ56/9ObV3bGhoJluJVQ+QD8GSzonL5W3xeHhOra0JgByIo0S4QzKPjcYiry01Odx7Oh8QLmxj4hoibGCGC8zXSdAkW/SdMf3Lt0sNBSfTqOgUygZ9rvn16jIXH5YkzdHDkXO5ydSkkpu2Pg/gBSK6azkhDFwH4yNhVRyP94dvOBGd66MNoJwKjVR3c/v9hss4AODuQmKYuR+SbzCJGiKuI6KNyo4ZVyRgJmPm56VA2ALIT+RuDT4lBHUT4FpKRBrclIpGLmTX3c0djwlD+ImwdQGE+xOxyHtOIQoCZA9nftDcL25GiEv0Lide+ecDZCspN9/TRsCujA3zoVQsctwJhCMAz97OzWTJYSK6rVjSQgBZH28gtJsAPysGi5pH+7q/LhYvf91RC3kCoR4BPK2TbDkA5e8JdB4Q4B0MnhRTEzvtTijbAO6W0L2GgWEd8Uu10L8mWHP4VmnMnFLVTEvZlTrSc1o3trKzDeBtDQVJoEE3SbEKqDje1mAjCWpk4GIiar6kG9sZQCD0KQF36ibRAfD427cIMlIZQemKOjvfB1sV8DV2bOBKcUZXvE4LLR5ofyhJhGrLgj/ZZ57VzWELwO3veNAg8a5ucDsAnkAoKoDtsBAe6TM/0c1hC6A+EKx1gQZ0g9sCaA3uF4KeZSCWiJrv6+ZYhQA8mIhGBtcBCu1AtoXUR4csGtLZJQs4m+wzrxaz9Sy20H9QAQZfSEQjTcVE2VlfB9DZrZwWWq9A/oatt9D/q4UYE4mYuVMHWtdmsYUkm4kjkYSun60v8d8X+A+YcTMRM5/QTaJj520NDpCgWkjZNWLjTmALwLdv3y1sVX6hBFlz8zuSR3undcTp2Hj9wc/UpcYCvZiMdn+v4+P0PvAhAfcx86GEw4t4vrj6l4O1rjIaYNCsmCp/MvvypwNhqwIq4OLtifGruDTeYPcOW0iUxx/sFUR1EjgzGjU7dIRnbWwDuFtCVcKgkwSuWIkq5N4x0vPclHrnnzckHRDbAJkqBEKvqDcddZilZTUl+w/+qJMs32ZhM/gYQT1H0lcj0e4Wu3EcAajDLNOVw+oKmHkilAgk+8yf7STPiBfoVy90aiMY1q7R2MHf7MRwdIizCRb+d4BjanJkKgG87bo0/rHOmaj3tz9skLE/8zjAsCxLvprs7/nSrviSAJSzeiMSgmNEVKV+Z+AnCXnCNYOx+GDPH7mCfL5weXrT7KPE8AqB7Rn7BfCuUh54HbVQrjDVCobAGyA8nvt3Bi4T6HcQWyxxO4irCVSRtWHGDxbSb6Zib0042XnHU2ipZGqWizLaLRiPgGAsZaeEk8QJmh4/rdNuxeBKrkChycKwtgkyagDekulTommL5aSYMy6ODnZPFRNlZ33FAewkXwnbdYCV2MVSYqxXoJTdWwnfNV+BvwALEYtPTIIeoAAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,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\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAFiUlEQVRoQ+2Zf2hbVRTHzzkvbVNxWFEclQ4L/kJRLEwGGwjCZLAxMT8WpkNh+8N2tEnbqbRJEFfYTLLZuZH0hwuoFXQiaX6IIuyPgsoUNiwIE8fKKsrAlTFBmbq2y7tH7mtfeE1/vNs0td1o/0pz3zvnfO75nnPfO0G4xf/wFo8flAHcgc6nUDj+zPS+/dtqglYCkMETUAIA/mVBTasJwhbADB4R7pA7zwzXVhPEggDultA9SPAmIm9AwHoDAOAiM/yqOcYPp44fv7HScrLNgAxwV0toJ2jQJT/ngZty8djwSgdu+r/9AKTmWfC9ud6jQyalq6Vjq0bUJv8XSOFsPPKTueb1B73M2g8rVdgzMlDoNiySPKkZAJqj8nqqr+tvq2R8jZ136aAZRY1OfgkYtq1UYRcAiruNGTADJ9PxWNIK4PEHDxLh89bv7LqThE4lj/xV7topAOzyh+JAsKXYgSqA0aEEJ9M9saSnMVyLVbqLATchQD0iritsCMM1QDgvQJxx5KuHirO7WMACgO/AgWqhOxMI0MAAP7Lgy0ZQiF9nE9FvrIbdLZ0vIGKDISHCRxDgUcH8KWh0CnVoQ+TnZm8ETiBw1cys8XUAPEVjVR+lUl2Tiw3e8D9D2yaEDrnB3uiX5ppxHlTgA0ZNTFaOWHfN2xpsZIZ1LPAiEXSYB95cmaQrzoGbd/+zQaukzUC0XYJPH46XWFBnKY1gVhuVmchPOjdke6MjZhALnQOu/cF6qIDNDsTXF9rBuaToag5u0xzYhgDrmfm6QApYO5xKRpZ8DrhbQju16UNusQDyepldIu5GxCeNRqDhvsyJyBWV4GdJqPgm9/437kNnZR3qYgsi7p1ax25BMKLhjQs6V9egzp/NJ5sZep+jm5nrRv3lnQOI8CAzn08nYvvKAmAtbKtBWbCZROyYpzV0hAC2qjibS0LW+zzt4VoUMCgLXdehK2upwYXs20qoGKIQfKCjjlDLqQRvFOoCGTBteP3BRiSUTeFSOhF9UcW2LYA0YkIw8wW58/I7byD0KiI0qThRBXDtba9xrKs+DQiarsMeayOZz48SgAHh66q09mpvIPihLLxyAkhbnkCojxA2scAT6Z7Ix3b2lQGKDXkDoW9Vite8T0VCRmZbg40I2CgAv8rEI28tC4DMBtdOfG9nXLULWa8zzxwGHk7HY7YSLSkD8lmHnPzFcgC4WoMbHYAn1wAW2t3bKgOD8ejTi5GS3bX/u4TWAIpSspYBO40ap6Wlja5JaE1CKpopusb6KIHa+DPlnJHu8nduB6JDy3oSTz10hb+TLx/58fzuXPKd0RL2Yc5bvP7wy0jcLgQMZXqinXZ2S3oWmgIIfSKnCjqIQ9n4kc/tHKmuewLBbkJ8lhn70onIB3b3lQ7gD7ch8SuC4VwmEW22c6Sy7mvuulM4xk8jYFX+Jjfl+u2n4CUDuFvDT2jAAzIw1bcnOwjzLY+Z/6Cx0R2pVEq3u6dkAKuM5CSPrlxqUnE4X0ByAkIVFYPyJckcUdoFL9eXBCAHwhrS+9IQA5xKx6PvqjgtvmZ6rHISER5n4N9Jm9it2tmWBDCdhdcQYI8BwTxAY6P9i8mE1L3umDhBAA3AoOdBD+QSR8+pbsSSAXw+n6avfyhCZM6H8CzfFMfS/bFf7IJwt4Q2k8YhBLzfqCWGSDYRzdjdZ11fMoA0ZkDUPnyQgHdMyynPzGcE8xDm9eHse91XTaeeQEcdI24kRpc51WDACaFzVHWYVXYA06B8IWcN2hGgxuqEjd8G+Sri1E7PWGP4WQg4rDIDmiszZcmA1bDRy2nSBcSF8fksxwy6QDjLDOni3x4WI58ldyE7Z3LyDJp4TNOphpGrkHFCJ3HZ4ZgcUe0ydj7KngE7h+Vev+UB/gN5EApeyCXHVgAAAABJRU5ErkJggg==\"","import React, { useCallback } from 'react'\nimport { Button, Popover } from 'antd'\n\nimport './style.scss'\nimport eventBus, { EVENT_AUTO_LAYOUT } from '../../utils/eventBus'\nimport { ShortcutsPanel } from './ShortcutsPanel'\n\nexport interface ToolbarProps {\n  undo: () => void\n  redo: () => void\n  canUndo: boolean\n  canRedo: boolean\n  scale: number\n}\n\nexport const Toolbar: React.FC<ToolbarProps> = React.memo(({ undo, redo, canUndo, canRedo, scale }) => {\n  const handleAutoLayout = useCallback(() => {\n    eventBus.emit(EVENT_AUTO_LAYOUT)\n  }, [])\n\n  return (\n    <div className=\"toolbar\">\n      <Button disabled>{(scale * 100).toFixed(0)}%</Button>\n      <Button disabled={!canUndo} onClick={undo}>\n        撤销\n      </Button>\n      <Button disabled={!canRedo} onClick={redo}>\n        重做\n      </Button>\n      <Popover trigger=\"click\" placement=\"right\" content={<ShortcutsPanel />} overlayClassName=\"scale-popover\">\n        <Button>快捷键</Button>\n      </Popover>\n      <Button onClick={handleAutoLayout}>自动排列</Button>\n    </div>\n  )\n})\n","import React, { useCallback } from 'react'\n\nimport './style.scss'\n\nexport interface NodeListItemProps {\n  icon: React.FC\n  label: string\n  type: string\n}\n\nexport const NodeListItem: React.FC<NodeListItemProps> = React.memo(({ icon, label, type }) => {\n  const handleDragStart = useCallback(\n    (event: any) => {\n      event.dataTransfer?.setData('nodeType', type)\n    },\n    [type]\n  )\n  return (\n    <div className=\"node-list-item\" draggable onDragStart={handleDragStart}>\n      {icon && React.createElement(icon)}\n      <div className=\"node-list-text\">{label}</div>\n    </div>\n  )\n})\n\nNodeListItem.displayName = 'NodeListItem'\n","import React, { memo } from 'react'\nimport './style.scss'\nimport { NodeListItem } from './NodeListItem'\nimport { nodesList } from '../NodeTypes/config'\n\nexport interface NodeListProps {}\n\nexport const NodeList: React.FC<NodeListProps> = memo(() => {\n  return (\n    <div className=\"node-list\">\n      {nodesList.map((node) => (\n        <NodeListItem key={node.type} icon={node.icon} type={node.type} label={node.label} />\n      ))}\n    </div>\n  )\n})\n\nNodeList.displayName = 'NodeList'\n","import { useEffect, useRef } from 'react'\n\nfunction useEventListener(\n  eventName: string,\n  handler: (event?: any) => void,\n  element?: Window | Document | HTMLElement | HTMLDivElement | null,\n  options?: any\n) {\n  // 创建一个储存处理方法的ref\n  const savedHandler = useRef<any>()\n  const target = element || document\n\n  // 当处理函数改变的时候更新ref.current的方法\n  // 这样可以使我们的总是获取到最新的处理函数\n  // 并且不需要在它的effect依赖数组中传递\n  // 并且避免有可能每次渲染重新引起effect方法\n  useEffect(() => {\n    savedHandler.current = handler\n  }, [handler])\n\n  useEffect(\n    () => {\n      // 确认是否支持addEventListener\n      const isSupported = target && target.addEventListener\n      if (!isSupported) return\n\n      // 创建一个调用储存在ref中函数的事件监听\n      const eventListener = (event: any) => savedHandler.current(event)\n\n      // 添加事件监听\n      target.addEventListener(eventName, eventListener, options)\n\n      // 在cleanup的回调中，清除事件监听\n      return () => {\n        target.removeEventListener(eventName, eventListener)\n      }\n    },\n    [eventName, target, options] // 当元素或者绑定事件改变时，重新运行\n  )\n}\nexport default useEventListener\n","export const SCALE_STEP = 0.05\n\nexport const DRAG_STATE = {\n  DEFAULT: 'DEFAULT',\n  START: 'START',\n  MOVE: 'MOVE',\n  END: 'END',\n  SELECTION: 'SELECTION',\n}\n\nexport const CURSOR_MAP = {\n  [DRAG_STATE.DEFAULT]: 'default',\n  [DRAG_STATE.SELECTION]: 'default',\n  [DRAG_STATE.START]: 'grab',\n  [DRAG_STATE.MOVE]: 'grabbing',\n}\n","import { IDiagramType } from '../types'\n\nexport const defaultValue: IDiagramType = {\n  links: [\n    { input: 'port-1', output: 'node-2' },\n    { input: 'port-1', output: 'ebac3f07-598e-4e2f-9e81-e67e542322d8' },\n    { input: 'node-5-port-1', output: 'node-2' },\n    { input: 'node-1-port-1', output: 'node-5' },\n    { input: 'node-5-port-2', output: 'node-4' },\n    { input: 'node-4-port-3', output: 'node-3' },\n  ],\n  nodes: [\n    {\n      id: 'node-1',\n      coordinates: [100, 100],\n      inputs: [],\n      outputs: [{ id: 'node-1-port-1', isLinked: true }],\n      type: 'nodeTypeSingleOutputs',\n      data: { inputValue: 'defaultValue' },\n    },\n    {\n      id: 'node-2',\n      coordinates: [600, 100],\n      type: 'nodeTypeSingleInputs',\n      inputs: [{ id: 'node-2-port-1', isLinked: false }],\n      outputs: [],\n      data: { inputValue: 'test' },\n    },\n    {\n      id: 'node-3',\n      coordinates: [850, 297],\n      type: 'nodeTypeNoInputOutput',\n      inputs: [],\n      outputs: [],\n      data: { inputValue: 'test' },\n    },\n    {\n      id: 'node-4',\n      coordinates: [600, 297],\n      type: 'nodeTypeMultipleInputsOutputs',\n      inputs: [\n        { id: 'node-4-port-1', isLinked: false },\n        { id: 'node-4-port-2', isLinked: false },\n      ],\n      outputs: [\n        { id: 'node-4-port-3', isLinked: false },\n        { id: 'node-4-port-4', isLinked: false },\n        { id: 'node-4-port-5', isLinked: false },\n      ],\n      data: { inputValue: 'test' },\n    },\n    {\n      id: 'node-5',\n      coordinates: [350, 100],\n      type: 'nodeTypeCustomRenderPort',\n      inputs: [],\n      outputs: [\n        { id: 'node-5-port-1', isLinked: false },\n        { id: 'node-5-port-2', isLinked: false },\n      ],\n      data: {\n        branchList: [\n          { text: 'button-1', id: 'd0ce404a' },\n          { text: 'button-2', id: '1751249f' },\n        ],\n      },\n    },\n  ],\n}\n\nconst manyNode: any = new Array(1000).fill({}).map((item, index) => {\n  return {\n    id: 'node-' + index,\n    coordinates: [index * 40 + 200, index * 50],\n    inputs: [],\n    outputs: [{ id: 'port-' + index, isLinked: false }],\n    type: 'nodeTypeInput',\n    data: {\n      inputValue: 'defaultValue',\n    },\n  }\n})\n\nconst manyLink = new Array(999).fill({}).map((item, index) => {\n  return { input: 'port-' + index, output: 'node-' + (index + 1) }\n})\n\nexport const bigDataValue = {\n  nodes: manyNode,\n  links: manyLink,\n}\n","import React, { useCallback, useMemo, useRef, useState, memo } from 'react'\nimport { Diagram } from './components/Diagram'\nimport { useHistory } from './hooks/useHistory'\nimport { Toolbar } from './components/Toolbar/Toolbar'\nimport { NodeList } from './components/NodeList/NodeList'\nimport { IDiagramType, ICoordinateType, IMousePosition, ITransform, ISelectionArea } from './types'\nimport { createNode } from './components/NodeTypes/config'\nimport { throttle } from 'lodash-es'\nimport {\n  calculatingCoordinates,\n  checkIsFocusInPanel,\n  checkMouseDownTargetIsDrawPanel,\n  checkWheelDirection,\n  collideCheck,\n  computedWheelDelta,\n  isTriggerScale,\n  oneNodeDelete,\n} from './utils'\nimport { useHotkeys } from 'react-hotkeys-hook'\nimport useEventCallback from './hooks/useEventCallback'\nimport useEventListener from './hooks/useEventListener'\nimport { HOT_KEY_DEL, HOT_KEY_REDO, HOT_KEY_SELECT_ALL, HOT_KEY_SPACE, HOT_KEY_UNDO } from './constant/hotKeys'\nimport { CURSOR_MAP, DRAG_STATE, SCALE_STEP } from './constant'\nimport { defaultValue } from './utils/creatMockData'\nimport { calculatePasteOriginCoordination, createCopyValue, createPasteValue } from './utils/copyPaste'\nimport hotkeys from 'hotkeys-js'\n\n// import { useThrottleFn } from 'react-use'\n\nfunction DiagramPanel() {\n  const {\n    present,\n    set,\n    setWithHistory,\n    addAHistory,\n    undo: handleUndo,\n    redo: handleRedo,\n    canUndo,\n    canRedo,\n  } = useHistory(defaultValue)\n\n  const value = present as IDiagramType\n  const [transform, setTransform] = useState<ITransform>({\n    scale: 1,\n    translateX: 0,\n    translateY: 0,\n  })\n  const [selectionArea, setSelectionArea] = useState<ISelectionArea | undefined>()\n  const [dragState, setDragState] = useState<string>(DRAG_STATE.DEFAULT)\n  const mouseDownStartPosition = useRef<IMousePosition | undefined>()\n  const [activeNodeIds, setActiveNodeIds] = useState<string[]>([])\n\n  const panelRef = useRef<HTMLDivElement>(null)\n  const selectionAreaRef = useRef<HTMLDivElement>(null)\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const panelRect = useMemo(() => panelRef.current?.getBoundingClientRect() || { x: 0, y: 0 }, [panelRef.current])\n\n  // eslint-disable-next-line\n  const handleThrottleSetTransform = useCallback(\n    throttle((transform) => {\n      setTransform(transform)\n    }, 20),\n    [setTransform]\n  )\n\n  const handleChange = useCallback(\n    (newValue: IDiagramType, notAddHistory?: boolean) => {\n      if (notAddHistory) {\n        set(newValue)\n      } else {\n        setWithHistory(newValue)\n      }\n    },\n    [set, setWithHistory]\n  )\n\n  const handleAddHistory = useCallback(\n    (newValue: IDiagramType) => {\n      addAHistory(newValue)\n    },\n    [addAHistory]\n  )\n\n  const handleDrop = useCallback(\n    (event: any) => {\n      if (event) {\n        event = window.event\n      }\n      const nodeType = event.dataTransfer.getData('nodeType')\n\n      const coordinates: ICoordinateType = calculatingCoordinates(\n        event,\n        document.getElementById('diagram-canvas'),\n        transform.scale\n      )\n\n      const newNode = createNode(nodeType, coordinates)\n      handleChange({ ...value, nodes: [...value.nodes, newNode] })\n    },\n    [handleChange, transform, value]\n  )\n\n  const handleDrag = useCallback((e: any) => {\n    e.preventDefault()\n  }, [])\n\n  // 控制滚轮缩放\n  const handlePanelScale = useEventCallback((event: WheelEvent) => {\n    const { wheelDown, wheelUp } = checkWheelDirection(event)\n\n    let { scale, translateX, translateY } = transform\n\n    const offsetX = ((event.clientX - panelRect.x - translateX) * SCALE_STEP) / scale\n    const offsetY = ((event.clientY - panelRect.y - translateY) * SCALE_STEP) / scale\n\n    if (wheelDown) {\n      scale = scale - SCALE_STEP\n      translateX = translateX + offsetX\n      translateY = translateY + offsetY\n    }\n    if (wheelUp) {\n      scale = scale + SCALE_STEP\n      translateX = translateX - offsetX\n      translateY = translateY - offsetY\n    }\n\n    if (scale > 1 || scale < 0.1) return\n\n    setTransform({\n      scale: Number(scale.toFixed(2)),\n      translateX,\n      translateY,\n    })\n  })\n\n  // 控制滚轮移动画布\n  const handlePanelTranslate = useEventCallback((event: WheelEvent) => {\n    const { deltaY, deltaX } = computedWheelDelta(event)\n    const { translateX, translateY } = transform\n\n    setTransform({\n      ...transform,\n      translateX: translateX - deltaX,\n      translateY: translateY - deltaY,\n    })\n  })\n\n  const handleWheel = useEventCallback((event: WheelEvent) => {\n    if (panelRef.current?.contains(event.target as Node)) {\n      event.preventDefault()\n      event.returnValue = false\n      if (isTriggerScale(event)) {\n        handlePanelScale(event)\n      } else {\n        handlePanelTranslate(event)\n      }\n    }\n  })\n\n  const handleMouseDown = useEventCallback((event) => {\n    mouseDownStartPosition.current = {\n      x: event.clientX,\n      y: event.clientY,\n      relativeX: event.clientX - transform.translateX,\n      relativeY: event.clientY - transform.translateY,\n    }\n    if (checkMouseDownTargetIsDrawPanel(event, panelRef.current)) {\n      if (dragState === DRAG_STATE.START) {\n        setDragState(DRAG_STATE.MOVE)\n      } else {\n        setDragState(DRAG_STATE.SELECTION)\n        setActiveNodeIds([])\n      }\n    }\n  })\n\n  // eslint-disable-next-line\n  const handleThrottleSetSelectionArea = useCallback(\n    throttle((e) => {\n      if (mouseDownStartPosition.current && panelRef.current) {\n        // const panelRect = panelRef.current.getBoundingClientRect()\n        setSelectionArea({\n          left: Math.min(e.clientX, mouseDownStartPosition.current.x) - panelRect.x,\n          top: Math.min(e.clientY, mouseDownStartPosition.current.y) - panelRect.y,\n          width: Math.abs(e.clientX - mouseDownStartPosition.current.x),\n          height: Math.abs(e.clientY - mouseDownStartPosition.current.y),\n        })\n        const selectAreaDom = selectionAreaRef.current\n        const activeNodeIds = value.nodes\n          .map((v) => v.id)\n          .filter((id) => {\n            return collideCheck(selectAreaDom, document.getElementById(id))\n          })\n\n        setActiveNodeIds(activeNodeIds)\n      }\n    }, 20),\n    [transform, value]\n  )\n\n  const handleMouseUp = useEventCallback((event) => {\n    if (dragState === DRAG_STATE.MOVE) {\n      setDragState(DRAG_STATE.START)\n    } else {\n      setDragState(DRAG_STATE.DEFAULT)\n    }\n    setSelectionArea(undefined)\n    mouseDownStartPosition.current = undefined\n  })\n\n  const handleMouseMove = useEventCallback((event) => {\n    if (dragState === DRAG_STATE.MOVE && mouseDownStartPosition.current) {\n      handleThrottleSetTransform({\n        ...transform,\n        translateX: event.clientX - mouseDownStartPosition.current.relativeX,\n        translateY: event.clientY - mouseDownStartPosition.current.relativeY,\n      })\n    }\n\n    if (dragState === DRAG_STATE.SELECTION) {\n      handleThrottleSetSelectionArea(event)\n    }\n  })\n\n  const handleSpaceHotKey = useEventCallback((event: KeyboardEvent) => {\n    if (hotkeys.isPressed(HOT_KEY_SPACE)) {\n      if (event.type === 'keydown' && dragState === DRAG_STATE.DEFAULT) {\n        setDragState(DRAG_STATE.START)\n      }\n      if (event.type === 'keyup') {\n        setDragState(DRAG_STATE.DEFAULT)\n      }\n    }\n  })\n\n  const handleSelectAll = useEventCallback((event: KeyboardEvent) => {\n    if (checkIsFocusInPanel(panelRef.current)) {\n      event.preventDefault()\n      setActiveNodeIds(value.nodes.map((node) => node.id))\n    }\n  })\n\n  const handleBatchDelete = useEventCallback(() => {\n    if (checkIsFocusInPanel(panelRef.current) && activeNodeIds.length) {\n      let nextValue = { ...value }\n      activeNodeIds.forEach((nodeId) => {\n        nextValue = oneNodeDelete(nextValue, nodeId)\n      })\n      handleChange(nextValue)\n    }\n  })\n\n  const handleBatchCopy = useEventCallback((event: React.ClipboardEvent) => {\n    if (checkIsFocusInPanel(panelRef.current) && activeNodeIds.length) {\n      event.preventDefault()\n      // activeNodeIds\n      const originCopyData = createCopyValue(value, activeNodeIds)\n\n      event.clipboardData.setData('text/json', JSON.stringify(originCopyData))\n    }\n  })\n\n  const handleBatchPaste = useEventCallback((event: React.ClipboardEvent) => {\n    if (checkIsFocusInPanel(panelRef.current)) {\n      event.preventDefault()\n      // 计算 node 粘贴的偏移量\n      const pasteOffset = panelRef.current\n        ? calculatePasteOriginCoordination(transform, panelRef.current)\n        : { x: 20, y: 20 }\n\n      const pasteString = event.clipboardData.getData('text/json')\n      if (pasteString) {\n        const newValue = createPasteValue(JSON.parse(pasteString), pasteOffset)\n\n        handleChange({ links: [...value.links, ...newValue.links], nodes: [...value.nodes, ...newValue.nodes] })\n      }\n    }\n  })\n\n  const handleToggleActiveNodeId = useEventCallback((nodeId: string) => {\n    let nextActiveNodeIds = [...activeNodeIds]\n    const findIndex = nextActiveNodeIds.findIndex((activeNodeId) => activeNodeId === nodeId)\n    if (findIndex > -1) {\n      nextActiveNodeIds.splice(findIndex, 1)\n    } else {\n      nextActiveNodeIds = [...nextActiveNodeIds, nodeId]\n    }\n    setActiveNodeIds(nextActiveNodeIds)\n  })\n\n  const cursor = useMemo(() => {\n    return CURSOR_MAP[dragState]\n  }, [dragState])\n\n  const hideSelectionArea = useMemo(() => dragState !== DRAG_STATE.SELECTION, [dragState])\n\n  const selectionAreaStyled = useMemo(\n    () => ({\n      left: selectionArea?.left,\n      top: selectionArea?.top,\n      width: selectionArea?.width,\n      height: selectionArea?.height,\n    }),\n    [selectionArea]\n  )\n\n  /*\n   * bind some hotkeys\n   */\n  useHotkeys(HOT_KEY_UNDO, handleUndo, {}, [handleUndo])\n  useHotkeys(HOT_KEY_REDO, handleRedo, {}, [handleRedo])\n  useHotkeys(HOT_KEY_SELECT_ALL, handleSelectAll, {}, [handleSelectAll])\n  useHotkeys(HOT_KEY_DEL, handleBatchDelete, {}, [handleBatchDelete])\n  // hotkeys-js 直接使用 'space' mac 空格有兼容问题\n  useHotkeys('*', handleSpaceHotKey, { keyup: true, keydown: true }, [handleSpaceHotKey])\n\n  useEventListener('wheel', handleWheel, null, { passive: false })\n\n  useEventListener('mouseup', handleMouseUp)\n  useEventListener('mousemove', handleMouseMove)\n  useEventListener('mousedown', handleMouseDown)\n\n  useEventListener('copy', handleBatchCopy)\n  useEventListener('paste', handleBatchPaste)\n\n  return (\n    <>\n      <div\n        id=\"diagram-panel\"\n        ref={panelRef}\n        className=\"diagram-panel\"\n        onDrop={handleDrop}\n        onDragEnter={handleDrag}\n        onDragOver={handleDrag}\n        tabIndex={1}\n        style={{ cursor }}\n      >\n        <Diagram\n          value={value}\n          transform={transform}\n          onChange={handleChange}\n          onAddHistory={handleAddHistory}\n          activeNodeIds={activeNodeIds}\n          onToggleActiveNodeId={handleToggleActiveNodeId}\n        />\n        <div\n          ref={selectionAreaRef}\n          className=\"diagram-selection-area\"\n          hidden={hideSelectionArea}\n          style={selectionAreaStyled}\n        />\n      </div>\n      <Toolbar undo={handleUndo} redo={handleRedo} canUndo={canUndo} scale={transform.scale} canRedo={canRedo} />\n      <NodeList />\n    </>\n  )\n}\n\nexport default memo(DiagramPanel)\n","export const HOT_KEY_UNDO = 'ctrl+z, cmd+z'\nexport const HOT_KEY_REDO = 'ctrl+shift+z, cmd+shift+z'\nexport const HOT_KEY_SELECT_ALL = 'ctrl+a, cmd+a'\nexport const HOT_KEY_DEL = 'del, backspace'\nexport const HOT_KEY_AUTO_LAYOUT = 'ctrl+shift+a, cmd+shift+a'\nexport const HOT_KEY_SPACE = 'space'\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport DiagramPanel from './DiagramPanel'\nimport reportWebVitals from './reportWebVitals'\n\nReactDOM.render(\n  <React.StrictMode>\n    <DiagramPanel />\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals()\n"],"sourceRoot":""}