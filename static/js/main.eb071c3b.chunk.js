(this["webpackJsonpreact-diagram-demo"]=this["webpackJsonpreact-diagram-demo"]||[]).push([[0],{121:function(e,t,n){},122:function(e,t,n){},149:function(e,t,n){},152:function(e,t,n){},153:function(e,t,n){"use strict";n.r(t);var o=n(1),c=n(0),r=n.n(c),i=n(30),u=n.n(i),s=(n(149),n(11)),d=n(4),l=n(29),f={canvasRef:null,portRefs:{},nodeRefs:{},scale:1},p=Object(c.createContext)(f),j=p.Provider,b=function(){return Object(c.useContext)(p)},O={onDragNewSegment:function(e,t,n){},onSegmentFail:function(e){},onSegmentConnect:function(e,t){},onShowSelectModel:function(e,t){},onPortMount:function(e,t){}},m=Object(c.createContext)(O),v=m.Provider,g=r.a.memo((function(e){var t=e.children,n=e.portRefs,a=e.nodeRefs,r=e.transform,i=e.onDragNewSegment,u=e.onSegmentFail,s=e.onSegmentConnect,d=e.onShowSelectModel,f=e.onPortMount,p=r.scale,b=r.translateX,O=r.translateY,m=Object(c.useState)(null),g=Object(l.a)(m,2),h=g[0],y=g[1],A=Object(c.useRef)(null);Object(c.useEffect)((function(){y(A.current)}),[]);var x=Object(c.useMemo)((function(){return{canvasRef:h,portRefs:n,nodeRefs:a,scale:p}}),[h,n,a,p]),C=Object(c.useMemo)((function(){return{onDragNewSegment:i,onSegmentFail:u,onSegmentConnect:s,onShowSelectModel:d,onPortMount:f}}),[i,u,s,d,f]);return Object(o.jsx)("div",{id:"diagram-canvas",className:"diagram-canvas",ref:A,style:{transform:"matrix(".concat(p,",0,0,").concat(p,",").concat(b,",").concat(O,")")},children:Object(o.jsx)(j,{value:x,children:Object(o.jsx)(v,{value:C,children:t})})})}));g.displayName="DiagramCanvas";var h=n(111),y=n(164),A=["INPUT","TEXTAREA"],x={ref:null,throttleBy:16},C=function(e){return[e.clientX,e.clientY]},k=function(e){return Object(c.useCallback)((function(t){e.current&&t===e.current||(e.current=t)}),[e])},R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=e.ref,n=Object(c.useRef)(),o=Object(c.useRef)(),a=Object(c.useRef)(),r=Object(c.useRef)({isDragging:!1,start:[0,0],end:[0,0],offset:[0,0]}),i=r.current,u=Object(c.useCallback)((function(e){var o=e.target.tagName;i.isDragging||!(null===t||void 0===t?void 0:t.current.contains(e.target))||A.includes(o)||(i.isDragging=!0,i.end=[0,0],i.offset=[0,0],i.start=C(e),n.current&&n.current(e,Object(d.a)({},i)))}),[t,i,n]),s=Object(c.useCallback)(Object(y.a)((function(e){i.isDragging&&(i.offset=[e.clientX-i.start[0],e.clientY-i.start[1]],o.current&&o.current(e,Object(d.a)({},i)))}),e.throttleBy),[t,i,o]),l=Object(c.useCallback)((function(e){i.isDragging&&(i.isDragging=!1,i.end=C(e),a.current&&a.current(e,Object(d.a)({},i)))}),[i,a]);return Object(c.useEffect)((function(){var e=function(e){return u(e)},n=function(e){return s(e)},o=function(e){return l(e)};return(null===t||void 0===t?void 0:t.current)&&(t.current.addEventListener("mousedown",e),document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)),function(){(null===t||void 0===t?void 0:t.current)&&(t.current.removeEventListener("mousedown",e),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",o))}}),[t,u,s,l]),{ref:t,onDragStart:k(n),onDrag:k(o),onDragEnd:k(a)}},T=n(32),D=n(160),N=(n(61),function(e){var t=e.icon,n=e.label;return Object(o.jsxs)("h4",{className:"node-header",children:[t&&Object(o.jsx)("div",{className:"node-header-icon",children:r.a.createElement(t)}),Object(o.jsx)("div",{className:"node-header-text",children:n})]})});N.displayName="NodeTypeHeader";var I=D.a.TextArea,E=function(e){var t=e.value,n=e.onChange;return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(N,{icon:ce.nodeTypeSingleOutputs.icon,label:ce.nodeTypeSingleOutputs.label}),Object(o.jsx)("div",{className:"node-content",children:Object(o.jsx)(I,{placeholder:"Input message here",rows:2,value:t.inputValue,onChange:function(e){n(Object(d.a)(Object(d.a)({},t),{},{inputValue:e.target.value}))}})})]})};E.displayName="NodeTypeSingleOutputs";var S=n(158),w=D.a.TextArea,L=function(e){var t=e.value,n=e.onChange;return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(N,{icon:ce.nodeTypeSingleInputs.icon,label:ce.nodeTypeSingleInputs.label}),Object(o.jsxs)("div",{className:"node-content",children:[Object(o.jsx)(w,{placeholder:"Input message here",rows:2,value:t.inputValue,onChange:function(e){n(Object(d.a)(Object(d.a)({},t),{},{inputValue:e.target.value}))}}),Object(o.jsx)("div",{style:{marginTop:8},children:Object(o.jsxs)(S.a,{style:{width:"100%"},value:t.selectValue,onChange:function(e){n(Object(d.a)(Object(d.a)({},t),{},{selectValue:e}))},children:[Object(o.jsx)(S.a.Option,{value:"jack",children:"Jack"}),Object(o.jsx)(S.a.Option,{value:"lucy",children:"Lucy"}),Object(o.jsx)(S.a.Option,{value:"disabled",children:"Disabled"}),Object(o.jsx)(S.a.Option,{value:"Yiminghe",children:"yiminghe"})]})})]})]})};L.displayName="NodeTypeSingleInputs";var M=n(33),V=function(e,t,n){var o=(null===t||void 0===t?void 0:t.getBoundingClientRect())||{x:0,y:0};return[Z((e.clientX-o.x)/n),Z((e.clientY-o.y)/n)]},B=function e(t){if(!t)return null;var n=t.id,o=t.classList.contains("diagram-node");return n&&o?n:o?null:e(t.parentElement)},H=function(e,t){return t.findIndex((function(t){return t.id===e}))},Y=function(e){var t=e,n=t.offsetWidth,o=t.offsetHeight;return{width:n,height:o,left:t.offsetLeft,top:t.offsetTop,right:t.offsetLeft+n,bottom:t.offsetTop+o}},P=function(e,t,n,o){var a=Object(s.a)(n),c=H(e,a),r=t[0]-n[c].coordinates[0],i=t[1]-n[c].coordinates[1];return o.forEach((function(e){a.some((function(t,n){return t.id===e&&(a[n]=Object(d.a)(Object(d.a)({},a[n]),{},{coordinates:[Z(t.coordinates[0]+r),Z(t.coordinates[1]+i)]}),!0)}))})),a[c]=Object(d.a)(Object(d.a)({},a[c]),{},{coordinates:[Z(t[0]),Z(t[1])]}),a},K=function(e,t){var n=Object(s.a)(e.nodes),o=H(t,n),a=e.nodes[o],c=a.outputs.map((function(e){return e.id})),r=a.inputs.map((function(e){return e.id}));return n.splice(o,1),{links:e.links.filter((function(e){return!r.includes(e.output)&&!c.includes(e.input)&&e.input!==t&&e.output!==t})),nodes:n}},U=function(e){return document.activeElement===e},Z=function(e){var t=e%2;return 2*Math.floor(e/2)+(t=t>1?2:0)},Q=/macintosh|mac os x/i.test(navigator.userAgent),z=n(6),F=n.n(z),W=r.a.memo((function(e){var t=e.id,n=e.isLinked,a=e.nodeId,r=b(),i=r.scale,u=r.canvasRef,s=Object(c.useContext)(m),d=s.onDragNewSegment,l=s.onSegmentFail,f=s.onSegmentConnect,p=s.onShowSelectModel,j=s.onPortMount,O=Object(c.useRef)(null),v=Object(c.useRef)(),g=F()("diagram-port",{"is-linked":n}),h=R({ref:O,throttleBy:16}),y=h.onDragStart,A=h.onDrag,x=h.onDragEnd;return y((function(e){if(e.stopImmediatePropagation(),e.stopPropagation(),u&&O.current){var t=u.getBoundingClientRect(),n=t.x,o=t.y,a=O.current.getBoundingClientRect(),c=a.x,r=a.y,s=a.width,d=a.height;v.current=[(c-n+s/2)/i,(r-o+d/2)/i]}})),A((function(e){if(v.current){e.stopImmediatePropagation(),e.stopPropagation();var n=V(e,u,i);d(t,v.current,n)}})),x((function(e){var n=e.target;if(n.classList.contains("diagram-port")&&n.id!==t)f(t,n.id);else{var o=B(e.target);if(o&&o!==a)f(t,o);else{var c=document.getElementById("diagram-panel");c&&c.contains(e.target)&&p(e,t),l&&l(t)}}})),Object(c.useEffect)((function(){j(t,O.current)}),[t,j]),Object(o.jsx)("b",{className:g,id:t,ref:O})})),X=function(e){var t=e.value,n=e.onChange,a=e.outputs,c=e.nodeId,r=function(e){var o=e.target.dataset.index,a=Object(s.a)(t.branchList);a[o].text=e.target.value,n(Object(d.a)(Object(d.a)({},t),{},{branchList:a}))};return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(N,{icon:ce.nodeTypeCustomRenderPort.icon,label:ce.nodeTypeCustomRenderPort.label}),Object(o.jsx)("div",{className:"node-content",children:t.branchList.map((function(e,t){return Object(o.jsxs)("div",{className:"branch-input",children:[Object(o.jsx)(D.a,{placeholder:"Input message here",value:e.text,"data-index":t,onChange:r}),a&&Object(o.jsx)(W,{id:a[t].id,isLinked:a[t].isLinked,nodeId:c})]},t)}))})]})};X.displayName="NodeTypeCustomRenderPort";var G=D.a.TextArea,q=function(e){var t=e.value,n=e.onChange;return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(N,{icon:ce.nodeTypeNoInputOutput.icon,label:ce.nodeTypeNoInputOutput.label}),Object(o.jsx)("div",{className:"node-content",children:Object(o.jsx)(G,{placeholder:"Input message here",rows:2,value:t.inputValue,onChange:function(e){n(Object(d.a)(Object(d.a)({},t),{},{inputValue:e.target.value}))}})})]})};q.displayName="NodeTypeNoInputOutput";var J,_,$=n(167),ee=n(168),te=n(169),ne=n(162),oe=D.a.TextArea,ae=function(e){var t=e.value,n=e.onChange;return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(N,{icon:ce.nodeTypeMultipleInputsOutputs.icon,label:ce.nodeTypeMultipleInputsOutputs.label}),Object(o.jsx)("div",{className:"node-content",children:Object(o.jsx)(oe,{placeholder:"Input message here",rows:2,value:t.inputValue,onChange:function(e){n(Object(d.a)(Object(d.a)({},t),{},{inputValue:e.target.value}))}})})]})};ae.displayName="NodeTypeMultipleInputsOutputs",function(e){e.nodeTypeSingleOutputs="nodeTypeSingleOutputs",e.nodeTypeSingleInputs="nodeTypeSingleInputs",e.nodeTypeNoInputOutput="nodeTypeNoInputOutput",e.nodeTypeMultipleInputsOutputs="nodeTypeMultipleInputsOutputs",e.nodeTypeCustomRenderPort="nodeTypeCustomRenderPort"}(_||(_={}));var ce=(J={},Object(T.a)(J,_.nodeTypeSingleOutputs,{component:E,label:"\u5355\u51fa\u53e3 \u8282\u70b9",icon:$.a,customRenderPort:!1,defaultValue:function(){return{id:Object(ne.a)(),coordinates:[0,0],type:_.nodeTypeSingleOutputs,inputs:[],outputs:[{id:Object(ne.a)(),isLinked:!1}],data:{inputValue:""}}}}),Object(T.a)(J,_.nodeTypeSingleInputs,{component:L,label:"\u5355\u5165\u53e3 \u8282\u70b9",icon:ee.a,customRenderPort:!1,defaultValue:function(){return{id:Object(ne.a)(),coordinates:[0,0],type:_.nodeTypeSingleInputs,inputs:[{id:Object(ne.a)(),isLinked:!1}],outputs:[],data:{inputValue:"",selectValue:""}}}}),Object(T.a)(J,_.nodeTypeNoInputOutput,{component:q,label:"\u65e0\u51fa\u5165\u53e3 \u8282\u70b9",icon:ee.a,customRenderPort:!1,defaultValue:function(){return{id:Object(ne.a)(),coordinates:[0,0],type:_.nodeTypeNoInputOutput,inputs:[],outputs:[],data:{inputValue:"",selectValue:""}}}}),Object(T.a)(J,_.nodeTypeMultipleInputsOutputs,{component:ae,label:"\u591a\u51fa\u53e3 \u591a\u5165\u53e3 \u8282\u70b9",icon:ee.a,customRenderPort:!1,defaultValue:function(){return{id:Object(ne.a)(),coordinates:[0,0],type:_.nodeTypeNoInputOutput,inputs:[{id:Object(ne.a)(),isLinked:!1},{id:Object(ne.a)(),isLinked:!1}],outputs:[{id:Object(ne.a)(),isLinked:!1},{id:Object(ne.a)(),isLinked:!1},{id:Object(ne.a)(),isLinked:!1}],data:{inputValue:"",selectValue:""}}}}),Object(T.a)(J,_.nodeTypeCustomRenderPort,{component:X,label:"\u81ea\u5b9a\u4e49\u6e32\u67d3 \u70b9 \u8282\u70b9",icon:te.a,customRenderPort:!0,defaultValue:function(){var e=[{id:Object(ne.a)(),text:""},{id:Object(ne.a)(),text:""}],t=e.map((function(e){return{id:e.id,isLinked:!1}}));return{id:Object(ne.a)(),coordinates:[0,0],type:_.nodeTypeCustomRenderPort,inputs:[],outputs:t,data:{inputValue:"",branchList:e}}}}),J),re=Object.entries(ce).map((function(e){var t=Object(l.a)(e,2),n=t[0],o=t[1];return Object(d.a)(Object(d.a)({},o),{},{type:n})})),ie=function(e,t){var n=ce[e].defaultValue;return Object(d.a)(Object(d.a)({},n()),{},{coordinates:t})},ue=n(155),se=function(e){var t=e.ports,n=e.nodeId,a=e.type,c=F()("diagram-port-wrapper",{"type-input":"input"===a,"type-output":"output"===a});return Object(o.jsx)(o.Fragment,{children:Object(o.jsx)("div",{className:c,children:t.map((function(e){return Object(o.jsx)(W,{id:e.id,isLinked:e.isLinked,nodeId:n},e.id)}))})})};se.displayName="DiagramNodePorts";var de=n(139),le=n(170),fe=n(171),pe=function(e){var t=e.onNodeDelete,n=e.onNodeCopy,a=e.id,r=Object(c.useCallback)((function(){t(a)}),[a,t]),i=Object(c.useCallback)((function(){n(a)}),[a,n]);return Object(o.jsxs)("div",{className:"diagram-node-action",children:[Object(o.jsx)(de.a,{onClick:i,icon:Object(o.jsx)(le.a,{})}),Object(o.jsx)(de.a,{onClick:r,icon:Object(o.jsx)(fe.a,{})})]})};pe.displayName="DiagramNodeActionButtons";var je=n(133),be=n(134),Oe=function(){function e(){Object(je.a)(this,e),this.es={}}return Object(be.a)(e,[{key:"on",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.es[e]||(this.es[e]=[]),this.es[e].push({cb:t,once:n})}},{key:"once",value:function(e,t){this.on(e,t,!0)}},{key:"fire",value:function(e){for(var t=this.es[e]||[],n=t.length,o=arguments.length,a=new Array(o>1?o-1:0),c=1;c<o;c++)a[c-1]=arguments[c];for(var r=0;r<n;r++){var i=t[r],u=i.cb,s=i.once;u.apply(this,a),s&&(t.splice(r,1),r--,n--)}}},{key:"off",value:function(e,t){if(void 0===e)this.es={};else if(void 0===t)delete this.es[e];else for(var n=this.es[e]||[],o=n.length,a=0;a<o;a++)n[a].cb===t&&(n.splice(a,1),a--,o--)}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];this.fire.apply(this,[e].concat(n))}}]),e}();Oe.ver="__VERSION__";var me="AUTO_LAYOUT",ve=new Oe,ge=r.a.memo((function(e){var t=e.nodeInfo,n=e.onNodeValueChange,a=e.onNodePositionChange,i=e.onNodeMount,u=e.onAddHistory,s=e.onToggleActiveNodeId,d=e.isActive,l=e.onNodeDelete,f=e.onNodeCopy,j=t.id,b=t.coordinates,O=t.type,m=t.inputs,v=t.data,g=t.outputs,h=Object(c.useContext)(p).scale,y=ce[O],A={value:v,onChange:function(e){n(j,e)},nodeId:j,inputs:(null===y||void 0===y?void 0:y.customRenderPort)?m:void 0,outputs:(null===y||void 0===y?void 0:y.customRenderPort)?g:void 0},x=Object(c.useRef)(null),C=R({throttleBy:16,ref:x}),k=C.onDragStart,T=C.onDrag,D=C.onDragEnd,N=Object(c.useRef)(b);k((function(){N.current=b})),T((function(e,t){e.stopImmediatePropagation(),e.stopPropagation();var n=[N.current[0]+t.offset[0]/h,N.current[1]+t.offset[1]/h];a(j,n),ve.emit("NODE_MOVING",j,n)})),D((function(e){Object(ue.a)(N.current,b)||u(j,N.current),ve.emit("NODE_MOVE_END")}));var I=Object(c.useCallback)((function(e){e.shiftKey&&s(j)}),[j,s]);Object(c.useEffect)((function(){i(j,x.current)}),[j,i]);var E=Object(c.useMemo)((function(){return F()("diagram-node",{active:d})}),[d]);return y.component?Object(o.jsxs)("div",{id:j,className:E,ref:x,style:{left:b[0],top:b[1]},onClick:I,children:[y.component&&r.a.createElement(y.component,A),!y.customRenderPort&&Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(se,{ports:m,nodeId:j,type:"input"}),Object(o.jsx)(se,{ports:g,nodeId:j,type:"output"})]}),Object(o.jsx)(pe,{id:j,onNodeDelete:l,onNodeCopy:f})]}):(console.warn('NodeType "'.concat(O,'" does not exist')),null)}));ge.displayName="DiagramNode";var he=r.a.memo((function(e){var t=e.nodes,n=e.activeNodeIds,a=Object(h.a)(e,["nodes","activeNodeIds"]);return Object(o.jsx)(o.Fragment,{children:t.map((function(e){return Object(o.jsx)(ge,Object(d.a)({isActive:n.includes(e.id),nodeInfo:e},a),e.id)}))})}));he.displayName="NodesCanvas";var ye=function(e){return[Math.floor(e[0]),Math.floor(e[1])]},Ae=function(e,t){var n,o=[(t[0]+e[0])/2,e[1]],a=[(t[0]+e[0])/2,t[1]];return"M ".concat(e[0],",").concat(e[1]," C ").concat((n=[o,a],n.map((function(e){return"".concat(e[0],",").concat(e[1])})).join(" "))," ").concat(t[0],",").concat(t[1])},xe=function(e,t){var n=(e[0]+t[0])/2,o=(e[1]+t[1])/2;return"M".concat(e[0],",").concat(e[1]," ").concat(e[0]+20,",").concat(e[1]," C ").concat(e[0]+100,",").concat(e[1]," ").concat(e[0]+130,",").concat((o+e[1])/2,"  ").concat(n,",").concat(o," C ").concat(n,",").concat(o," ").concat(t[0]-130,",").concat((o+t[1])/2," ").concat(t[0]-2,",").concat(t[1]," M ").concat(t[0]-2,",").concat(t[1]," ").concat(t[0],",").concat(t[1])},Ce=function(e,t){if(!e||!t)return"";var n,o,a=ye(e),c=ye(t);return n=a,(o=c)[0]>=n[0]?Ae(n,o):xe(n,o)},ke=r.a.memo((function(e){var t=e.input,n=e.output,a=e.link,r=e.onDelete,i=Object(c.useRef)(null),u=Object(c.useMemo)((function(){return function(e,t){var n=Math.abs(t[0]-e[0]),o=Math.abs(t[1]-e[1]),a=0,c=0,r={x:0,y:0},i={x:0,y:0};return t[0]>e[0]?(a=e[0],r.x=0,i.x=n):(a=t[0],r.x=n,i.x=0),t[1]>e[1]?(c=e[1],r.y=0,i.y=o):(c=t[1],r.y=o,i.y=0),{width:Math.floor(n)||1,height:Math.floor(o)||1,left:Math.floor(a),top:Math.floor(c),start:[r.x,r.y],end:[i.x,i.y]}}(t,n)}),[t,n]),s=u.width,d=u.height,l=u.left,f=u.top,p=u.start,j=u.end,b=Object(c.useMemo)((function(){return Ce(p,j)}),[p,j]),O=Object(c.useCallback)((function(){r(a)}),[r,a]),m=Object(c.useCallback)((function(){var e;null===(e=i.current)||void 0===e||e.classList.add("hover")}),[]),v=Object(c.useCallback)((function(){var e;null===(e=i.current)||void 0===e||e.classList.remove("hover")}),[]);return Object(o.jsxs)("svg",{ref:i,className:"diagram-link",style:{left:l,top:f},width:s,height:d,pointerEvents:"none",children:[Object(o.jsx)("path",{d:b,className:"bi-link-path"}),Object(o.jsx)("path",{d:b,className:"bi-link-ghost",onDoubleClick:O,onMouseOver:m,onMouseOut:v})]})}),(function(e,t){return Object(ue.a)(e,t)}));ke.displayName="Link";var Re=r.a.memo((function(e){var t=e.nodes,n=e.onDelete,a=e.links,r=b(),i=r.canvasRef,u=r.portRefs,s=r.nodeRefs,d=r.scale,l=Object(c.useMemo)((function(){var e=[];return a.forEach((function(n){var o=n.input,a=n.output,c=Ne({nodes:t,entityId:o,nodeRefs:s,portRefs:u,canvasRef:i,scale:d}),r=Ne({nodes:t,entityId:a,nodeRefs:s,portRefs:u,canvasRef:i,scale:d});c&&r&&e.push({link:n,startCoordinates:c,endCoordinates:r})})),e}),[t,a,s,u,i]);return Object(o.jsx)(o.Fragment,{children:l.map((function(e){return Object(o.jsx)(ke,{link:e.link,input:e.startCoordinates,output:e.endCoordinates,onDelete:n},"".concat(e.link.input,"-").concat(e.link.output))}))})}));Re.displayName="LinksCanvas";var Te=function(e,t,n){var o=e.getBoundingClientRect(),a=t.getBoundingClientRect();return{offsetLeft:(a.left-o.left)/n,offsetTop:(a.top-o.top)/n}},De=function(e){for(var t=e.nodeCoordinates,n=e.ports,o=e.entityId,a=e.portRefs,c=e.nodeDom,r=e.scale,i=0;i<n.length;i++){if(n[i].id===o){var u=a[o];if(!u)return null;var s=u.offsetWidth,d=u.offsetHeight,l=Te(c,u,r),f=l.offsetLeft,p=l.offsetTop;return[t[0]+f+s/2,t[1]+p+d/2]}}return null},Ne=function(e){for(var t=e.nodes,n=e.entityId,o=e.nodeRefs,a=e.portRefs,c=(e.canvasRef,e.scale),r=0;r<t.length;r++){var i=t[r],u=o[i.id];if(i.id===n)return u?[i.coordinates[0],i.coordinates[1]+u.offsetHeight/2]:null;var s=De({nodeCoordinates:i.coordinates,ports:i.inputs,entityId:n,portRefs:a,nodeDom:u,scale:c});if(s)return s;var d=De({nodeCoordinates:i.coordinates,ports:i.outputs,entityId:n,portRefs:a,nodeDom:u,scale:c});if(d)return d}return null},Ie=r.a.memo((function(e){var t=e.segment,n=t.from,a=t.to,r=t.id,i=Object(c.useMemo)((function(){return Ce(n,a)}),[n,a]);return Object(o.jsx)("svg",{className:"diagram-segment-canvas",children:Object(o.jsxs)("g",{className:"diagram-segment-link",id:r,children:[Object(o.jsx)("path",{d:i}),Object(o.jsx)("circle",{r:"5",cx:a[0],cy:a[1]})]})})}));Ie.displayName="Segment";n(152);var Ee=function(e){var t=Object(c.useRef)(e);return Object(c.useLayoutEffect)((function(){t.current=e})),Object(c.useMemo)((function(){return function(){var e=t.current;return e.apply(void 0,arguments)}}),[])},Se=r.a.memo((function(e){var t=e.position,n=e.onChange;if(!t)return null;var a=function(e){n(e.currentTarget.dataset.type)};return u.a.createPortal(Object(o.jsx)("div",{className:"select-model",onClick:function(){n()},children:Object(o.jsx)("ul",{className:"select-model-content",style:{left:t[0],top:t[1],position:"absolute"},onClick:function(e){e.stopPropagation()},children:re.map((function(e){return Object(o.jsxs)("li",{className:"select-model-item",onClick:a,"data-type":e.type,children:[e.icon&&r.a.createElement(e.icon),Object(o.jsx)("div",{className:"select-model-text",children:e.label})]},e.type)}))})}),document.body)}));Se.displayName="SelectModel";var we=n(161),Le=n(165),Me=n(157),Ve=function(e,t){for(var n=0;n<e.length;n++){if(e[n].id===t)return!0}return!1},Be=function(e,t){for(var n=0;n<t.length;n++){var o=t[n];if(o.id===e)return o.id;if(Ve(o.inputs,e))return o.id;if(Ve(o.outputs,e))return o.id}return e};function He(e,t){var n=e.links,o=void 0===n?[]:n,a=e.nodes,c=1,r=(void 0===a?[]:a).map((function(e){return Object(d.a)(Object(d.a)({},e),{},{row:0,column:0,style:Y(t[e.id])})})),i=function e(t,n,o,a,r){if(!r.includes(t)){r.push(t);var i=o.find((function(e){return e.id===Be(t,o)}));if(i){i.row=i.row||c,i.column=i.column||n,n++;var u=0;i.outputs.forEach((function(t){var i=a.find((function(e){return e.input===t.id}));i&&(++u>1&&c++,e(i.output,n,o,a,r))}))}}};o.forEach((function(e){if(function(e,t,n){return!t.find((function(t){return t.output===Be(e,n)}))}(e.input,o,r)){var t=Be(e.input,r),n=[t],a=r.find((function(e){return e.id===t}));if(!a)return;a.row=a.row||c,a.column=1,i(e.output,2,r,o,n),c++}})),r.forEach((function(e){0===e.row&&(e.row=c,e.column=1,c++)})),Object(s.a)(r).forEach((function(e){var t=e.outputs,n=[];t.forEach((function(e){if(e.isLinked){var t=o.find((function(t){return t.input===e.id}));t&&n.push(t.output)}})),r.sort((function(e,t){return n.findIndex((function(t){return e.id===t}))-n.findIndex((function(e){return t.id===e}))}))}));var u=100,l=100,f=Object(we.a)(r,(function(e){return e.row})),p=Object.values(f),j=l;p.forEach((function(e,t){e.sort((function(e,t){return e.column-t.column})),e.forEach((function(e,n){if(0===n&&t>0){var o=p[t-1].filter((function(t){return t.column>=e.column})).map((function(e){return e.style.height})),a=Object(Le.a)(o)||0;j+=a+50}e.column&&(e.coordinates=[250*(e.column-1)+u,j])}))}));var b=r.map((function(e){return Object(d.a)({},Object(Me.a)(e,"column","row","style"))}));return{links:o,nodes:b}}var Ye=function(e){return Number(e.toFixed(2))},Pe=function(e){var t=e.originNodes,n=e.futureNodes,o=e.animationFn,a=e.stepCount;return new Promise((function(e,c){try{var r=0,i=function(e,t,n){return e.map((function(e){var o=t.find((function(t){return t.id===e.id})),a=o?Ye((o.coordinates[0]-e.coordinates[0])/n):0,c=o?Ye((o.coordinates[1]-e.coordinates[1])/n):0;return Object(d.a)(Object(d.a)({},e),{},{xStep:a,yStep:c})}))}(t,n,a);requestAnimationFrame((function t(){r+=1;var c=(i=i.map((function(e){return Object(d.a)(Object(d.a)({},e),{},{coordinates:[e.coordinates[0]+e.xStep,e.coordinates[1]+e.yStep]})}))).map((function(e){return Object(d.a)({},Object(Me.a)(e,["xStep","yStep"]))}));o(c),r<a?requestAnimationFrame(t):(o(n),e(n))}))}catch(u){c(u)}}))},Ke=function(e){var t=e.type,n=e.onChange,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(c.useEffect)((function(){return ve.on(t,n),function(){ve.off(t,n)}}),[t,n,o])},Ue=n(166),Ze=n(156),Qe=function(e,t,n){return e.map((function(e){var o=e.input===t,a=e.output===t;return Object(d.a)(Object(d.a)({},e),{},{input:o?n:e.input,output:a?n:e.output,inputUpdated:o||e.inputUpdated,outputUpdated:a||e.outputUpdated})}))},ze=r.a.memo((function(e){var t=e.value,n=e.onChange,a=e.onAddHistory,r=e.transform,i=e.activeNodeIds,u=e.onToggleActiveNodeId,f=Object(c.useState)(),p=Object(l.a)(f,2),j=p[0],b=p[1],O=Object(c.useState)(),m=Object(l.a)(O,2),v=m[0],h=m[1],y=Object(c.useRef)({}).current,A=Object(c.useRef)({}).current,x=Object(c.useRef)(),C=Object(c.useRef)(!1),k=Ee((function(e,o){var a=P(e,o,t.nodes,i);n(Object(d.a)(Object(d.a)({},t),{},{nodes:a}),!0)})),R=Ee((function(e,o){var a=Object(s.a)(t.nodes),c=H(e,a);a[c]=Object(d.a)(Object(d.a)({},a[c]),{},{data:o}),n(Object(d.a)(Object(d.a)({},t),{},{nodes:a}))})),T=Ee((function(e,n){var o=P(e,n,t.nodes,i);a(Object(d.a)(Object(d.a)({},t),{},{nodes:o}))})),D=Ee((function(e){var o=H(e,t.nodes),a=function(e){var t=Object(Ze.a)(e);return Object(d.a)(Object(d.a)({},t),{},{id:Object(ne.a)(),outputs:t.outputs.map((function(e){return{id:Object(ne.a)(),isLinked:!1}})),inputs:t.outputs.map((function(e){return{id:Object(ne.a)(),isLinked:!1}})),coordinates:[t.coordinates[0]+20,t.coordinates[1]+20]})}(t.nodes[o]);n(Object(d.a)(Object(d.a)({},t),{},{nodes:[].concat(Object(s.a)(t.nodes),[a])}))})),N=Ee((function(e){var o=K(t,e);n(o)})),I=Ee((function(e,t){y[e]=t})),E=Ee((function(e,t){A[e]=t})),S=Object(c.useCallback)((function(e,t,n){b({id:"segment-".concat(e),from:t,to:n})}),[]),w=Object(c.useCallback)((function(){b(void 0)}),[]),L=Ee((function(e,t){x.current=t,h([e.clientX,e.clientY]),b(void 0)})),M=Ee((function(e,o){if(!(t.links.findIndex((function(t){return t.input===e&&t.output===o}))>-1)){var a=[].concat(Object(s.a)(t.links),[{input:e,output:o}]);n(Object(d.a)(Object(d.a)({},t),{},{links:a}))}b(void 0)})),B=Ee((function(e){var o=t.links.filter((function(t){return!Object(ue.a)(t,e)}));n(Object(d.a)(Object(d.a)({},t),{},{links:o}))})),Y=Ee((function(e){if(e&&v){var o=V({clientX:v[0],clientY:v[1]},document.getElementById("diagram-canvas"),r.scale),a=ie(e,o);n(Object(d.a)(Object(d.a)({},t),{},{nodes:[].concat(Object(s.a)(t.nodes),[a])})),setTimeout((function(){M(x.current||"",a.id)}),20)}h(void 0)})),U=Object(c.useCallback)((function(){var e,o=He(t,A);if(e=t.nodes,o.nodes.some((function(t){var n=t.id,o=t.coordinates,a=e.find((function(e){return e.id===n}));return!a||!Object(ue.a)(a.coordinates,o)}))&&!C.current){var c={originNodes:t.nodes,futureNodes:o.nodes,animationFn:function(e){return n(Object(d.a)(Object(d.a)({},o),{},{nodes:e}),!0)},stepCount:60};C.current=!0,Pe(c).then((function(){a(t)})).finally((function(){return C.current=!1}))}}),[t,A,n,a,C]);return Ke({type:me,onChange:U}),Object(o.jsxs)(g,{portRefs:y,nodeRefs:A,transform:r,onDragNewSegment:S,onSegmentFail:w,onSegmentConnect:M,onShowSelectModel:L,onPortMount:I,children:[Object(o.jsx)(he,{nodes:t.nodes,onNodeMount:E,onNodePositionChange:k,onNodeValueChange:R,onNodeDelete:N,onNodeCopy:D,onAddHistory:T,onToggleActiveNodeId:u,activeNodeIds:i}),t.links.length>0&&Object(o.jsx)(Re,{nodes:t.nodes,links:t.links,onDelete:B}),j&&Object(o.jsx)(Ie,{segment:j}),Object(o.jsx)(Se,{position:v,onChange:Y})]})}));ze.displayName="Diagram";var Fe={past:[],present:null,future:[]},We=function(e,t){var n=e.past,o=e.present,a=e.future,c=t.newPresent;switch(t.type){case"UNDO":var r=n[n.length-1];return{past:n.slice(0,n.length-1),present:r,future:[o].concat(Object(s.a)(a))};case"REDO":var i=a[0],u=a.slice(1);return{past:[].concat(Object(s.a)(n),[o]),present:i,future:u};case"SET":return{past:Object(s.a)(n),present:c,future:[]};case"SET_WIDTH_HISTORY":return c===o?e:{past:[].concat(Object(s.a)(n),[o]),present:c,future:[]};case"ADD_A_HISTORY":return c===o?e:{past:[].concat(Object(s.a)(n),[c]),present:o,future:[]};case"CLEAR":var l=t.initialPresent;return Object(d.a)(Object(d.a)({},Fe),{},{present:l})}},Xe=n(163),Ge=(n(121),Q?"CMD":"Ctrl"),qe=[{text:"\u64a4\u9500",hotKeys:[{key:Ge},{key:"Z"}]},{text:"\u591a\u9009",hotKeys:[{key:"Shift"},{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAE8ElEQVRoQ+2ZbWibVRTH/+c+6YugTKjMTVaoTBRBcFBRHCpVvw3FJmkc7sv8IO1sm3RTaZNqWdyHPunswCVrXQu6itjh0jRxU/ZpWFEYsk0niqK2UFDsVrYxcYy+5LlHbmpqDGlznydFWmy/tfe8/H/3nHse7i1hjf9QKfobAqHzyn8kaj5USpxSfIsC+Hw+Ix6PW4WSrHoAd0voGSHYOzd7reXU4ODNfIhVDeALh8v56kwKRBsl0zfzs1fa8iFWNYDa7fo9wRqjjAaIUCUZ56/9ObV3bGhoJluJVQ+QD8GSzonL5W3xeHhOra0JgByIo0S4QzKPjcYiry01Odx7Oh8QLmxj4hoibGCGC8zXSdAkW/SdMf3Lt0sNBSfTqOgUygZ9rvn16jIXH5YkzdHDkXO5ydSkkpu2Pg/gBSK6azkhDFwH4yNhVRyP94dvOBGd66MNoJwKjVR3c/v9hss4AODuQmKYuR+SbzCJGiKuI6KNyo4ZVyRgJmPm56VA2ALIT+RuDT4lBHUT4FpKRBrclIpGLmTX3c0djwlD+ImwdQGE+xOxyHtOIQoCZA9nftDcL25GiEv0Lide+ecDZCspN9/TRsCujA3zoVQsctwJhCMAz97OzWTJYSK6rVjSQgBZH28gtJsAPysGi5pH+7q/LhYvf91RC3kCoR4BPK2TbDkA5e8JdB4Q4B0MnhRTEzvtTijbAO6W0L2GgWEd8Uu10L8mWHP4VmnMnFLVTEvZlTrSc1o3trKzDeBtDQVJoEE3SbEKqDje1mAjCWpk4GIiar6kG9sZQCD0KQF36ibRAfD427cIMlIZQemKOjvfB1sV8DV2bOBKcUZXvE4LLR5ofyhJhGrLgj/ZZ57VzWELwO3veNAg8a5ucDsAnkAoKoDtsBAe6TM/0c1hC6A+EKx1gQZ0g9sCaA3uF4KeZSCWiJrv6+ZYhQA8mIhGBtcBCu1AtoXUR4csGtLZJQs4m+wzrxaz9Sy20H9QAQZfSEQjTcVE2VlfB9DZrZwWWq9A/oatt9D/q4UYE4mYuVMHWtdmsYUkm4kjkYSun60v8d8X+A+YcTMRM5/QTaJj520NDpCgWkjZNWLjTmALwLdv3y1sVX6hBFlz8zuSR3undcTp2Hj9wc/UpcYCvZiMdn+v4+P0PvAhAfcx86GEw4t4vrj6l4O1rjIaYNCsmCp/MvvypwNhqwIq4OLtifGruDTeYPcOW0iUxx/sFUR1EjgzGjU7dIRnbWwDuFtCVcKgkwSuWIkq5N4x0vPclHrnnzckHRDbAJkqBEKvqDcddZilZTUl+w/+qJMs32ZhM/gYQT1H0lcj0e4Wu3EcAajDLNOVw+oKmHkilAgk+8yf7STPiBfoVy90aiMY1q7R2MHf7MRwdIizCRb+d4BjanJkKgG87bo0/rHOmaj3tz9skLE/8zjAsCxLvprs7/nSrviSAJSzeiMSgmNEVKV+Z+AnCXnCNYOx+GDPH7mCfL5weXrT7KPE8AqB7Rn7BfCuUh54HbVQrjDVCobAGyA8nvt3Bi4T6HcQWyxxO4irCVSRtWHGDxbSb6Zib0042XnHU2ipZGqWizLaLRiPgGAsZaeEk8QJmh4/rdNuxeBKrkChycKwtgkyagDekulTommL5aSYMy6ODnZPFRNlZ33FAewkXwnbdYCV2MVSYqxXoJTdWwnfNV+BvwALEYtPTIIeoAAAAABJRU5ErkJggg=="}]},{text:"\u91cd\u505a",hotKeys:[{key:Ge},{key:"Shift"},{key:"Z"}]},{text:"\u5168\u9009",hotKeys:[{key:Ge},{key:"A"}]},{text:"\u590d\u5236",hotKeys:[{key:Ge},{key:"C"}]},{text:"\u7f29\u653e",hotKeys:[{key:Ge},{icon:"data:image/png;base64,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"}]},{text:"\u7c98\u8d34",hotKeys:[{key:Ge},{key:"V"}]},{text:"\u79fb\u52a8\u753b\u5e03",hotKeys:[{key:"Space"},{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAFiUlEQVRoQ+2Zf2hbVRTHzzkvbVNxWFEclQ4L/kJRLEwGGwjCZLAxMT8WpkNh+8N2tEnbqbRJEFfYTLLZuZH0hwuoFXQiaX6IIuyPgsoUNiwIE8fKKsrAlTFBmbq2y7tH7mtfeE1/vNs0td1o/0pz3zvnfO75nnPfO0G4xf/wFo8flAHcgc6nUDj+zPS+/dtqglYCkMETUAIA/mVBTasJwhbADB4R7pA7zwzXVhPEggDultA9SPAmIm9AwHoDAOAiM/yqOcYPp44fv7HScrLNgAxwV0toJ2jQJT/ngZty8djwSgdu+r/9AKTmWfC9ud6jQyalq6Vjq0bUJv8XSOFsPPKTueb1B73M2g8rVdgzMlDoNiySPKkZAJqj8nqqr+tvq2R8jZ136aAZRY1OfgkYtq1UYRcAiruNGTADJ9PxWNIK4PEHDxLh89bv7LqThE4lj/xV7topAOzyh+JAsKXYgSqA0aEEJ9M9saSnMVyLVbqLATchQD0iritsCMM1QDgvQJxx5KuHirO7WMACgO/AgWqhOxMI0MAAP7Lgy0ZQiF9nE9FvrIbdLZ0vIGKDISHCRxDgUcH8KWh0CnVoQ+TnZm8ETiBw1cys8XUAPEVjVR+lUl2Tiw3e8D9D2yaEDrnB3uiX5ppxHlTgA0ZNTFaOWHfN2xpsZIZ1LPAiEXSYB95cmaQrzoGbd/+zQaukzUC0XYJPH46XWFBnKY1gVhuVmchPOjdke6MjZhALnQOu/cF6qIDNDsTXF9rBuaToag5u0xzYhgDrmfm6QApYO5xKRpZ8DrhbQju16UNusQDyepldIu5GxCeNRqDhvsyJyBWV4GdJqPgm9/437kNnZR3qYgsi7p1ax25BMKLhjQs6V9egzp/NJ5sZep+jm5nrRv3lnQOI8CAzn08nYvvKAmAtbKtBWbCZROyYpzV0hAC2qjibS0LW+zzt4VoUMCgLXdehK2upwYXs20qoGKIQfKCjjlDLqQRvFOoCGTBteP3BRiSUTeFSOhF9UcW2LYA0YkIw8wW58/I7byD0KiI0qThRBXDtba9xrKs+DQiarsMeayOZz48SgAHh66q09mpvIPihLLxyAkhbnkCojxA2scAT6Z7Ix3b2lQGKDXkDoW9Vite8T0VCRmZbg40I2CgAv8rEI28tC4DMBtdOfG9nXLULWa8zzxwGHk7HY7YSLSkD8lmHnPzFcgC4WoMbHYAn1wAW2t3bKgOD8ejTi5GS3bX/u4TWAIpSspYBO40ap6Wlja5JaE1CKpopusb6KIHa+DPlnJHu8nduB6JDy3oSTz10hb+TLx/58fzuXPKd0RL2Yc5bvP7wy0jcLgQMZXqinXZ2S3oWmgIIfSKnCjqIQ9n4kc/tHKmuewLBbkJ8lhn70onIB3b3lQ7gD7ch8SuC4VwmEW22c6Sy7mvuulM4xk8jYFX+Jjfl+u2n4CUDuFvDT2jAAzIw1bcnOwjzLY+Z/6Cx0R2pVEq3u6dkAKuM5CSPrlxqUnE4X0ByAkIVFYPyJckcUdoFL9eXBCAHwhrS+9IQA5xKx6PvqjgtvmZ6rHISER5n4N9Jm9it2tmWBDCdhdcQYI8BwTxAY6P9i8mE1L3umDhBAA3AoOdBD+QSR8+pbsSSAXw+n6avfyhCZM6H8CzfFMfS/bFf7IJwt4Q2k8YhBLzfqCWGSDYRzdjdZ11fMoA0ZkDUPnyQgHdMyynPzGcE8xDm9eHse91XTaeeQEcdI24kRpc51WDACaFzVHWYVXYA06B8IWcN2hGgxuqEjd8G+Sri1E7PWGP4WQg4rDIDmiszZcmA1bDRy2nSBcSF8fksxwy6QDjLDOni3x4WI58ldyE7Z3LyDJp4TNOphpGrkHFCJ3HZ4ZgcUe0ydj7KngE7h+Vev+UB/gN5EApeyCXHVgAAAABJRU5ErkJggg=="}]},{text:"\u5220\u9664",hotKeys:[{key:"Del"}]}],Je=r.a.memo((function(){return Object(o.jsx)("ul",{className:"shortcuts-panel",children:qe.map((function(e,t){return Object(o.jsxs)("li",{className:"shortcuts-panel-item",children:[Object(o.jsxs)("div",{className:"shortcuts-panel-title",children:[e.text," :"]}),Object(o.jsx)("div",{className:"shortcuts-panel-list",children:e.hotKeys.map((function(t,n){return Object(o.jsxs)(r.a.Fragment,{children:[n>0&&Object(o.jsx)("span",{className:"shortcuts-panel-plus",children:"+"}),Object(o.jsxs)("div",{className:"shortcuts-panel-key",children:[t.key,t.icon&&Object(o.jsx)("img",{className:"shortcuts-panel-icon",src:t.icon,alt:e.text})]})]},n)}))})]},t)}))})})),_e=r.a.memo((function(e){var t=e.undo,n=e.redo,r=e.canUndo,i=e.canRedo,u=e.scale,s=Object(c.useCallback)((function(){ve.emit(me)}),[]);return Object(c.useEffect)((function(){setTimeout((function(){console.log(a.a)}),5e3)}),[]),Object(o.jsxs)("div",{className:"toolbar",children:[Object(o.jsxs)(de.a,{disabled:!0,children:[(100*u).toFixed(0),"%"]}),Object(o.jsx)(de.a,{disabled:!r,onClick:t,children:"\u64a4\u9500"}),Object(o.jsx)(de.a,{disabled:!i,onClick:n,children:"\u91cd\u505a"}),Object(o.jsx)(Xe.a,{trigger:"click",placement:"right",content:Object(o.jsx)(Je,{}),overlayClassName:"scale-popover",children:Object(o.jsx)(de.a,{children:"\u5feb\u6377\u952e"})}),Object(o.jsx)(de.a,{onClick:s,children:"\u81ea\u52a8\u6392\u5217"})]})})),$e=(n(122),r.a.memo((function(e){var t=e.icon,n=e.label,a=e.type,i=Object(c.useCallback)((function(e){var t;null===(t=e.dataTransfer)||void 0===t||t.setData("nodeType",a)}),[a]);return Object(o.jsxs)("div",{className:"node-list-item",draggable:!0,onDragStart:i,children:[t&&r.a.createElement(t),Object(o.jsx)("div",{className:"node-list-text",children:n})]})})));$e.displayName="NodeListItem";var et=Object(c.memo)((function(){return Object(o.jsx)("div",{className:"node-list",children:re.map((function(e){return Object(o.jsx)($e,{icon:e.icon,type:e.type,label:e.label},e.type)}))})}));et.displayName="NodeList";var tt=n(83);var nt,ot=function(e,t,n,o){var a=Object(c.useRef)(),r=n||document;Object(c.useEffect)((function(){a.current=t}),[t]),Object(c.useEffect)((function(){if(r&&r.addEventListener){var t=function(e){return a.current(e)};return r.addEventListener(e,t,o),function(){r.removeEventListener(e,t)}}}),[e,r,o])},at=.05,ct="DEFAULT",rt="START",it="MOVE",ut="SELECTION",st=(nt={},Object(T.a)(nt,ct,"default"),Object(T.a)(nt,ut,"default"),Object(T.a)(nt,rt,"grab"),Object(T.a)(nt,it,"grabbing"),nt),dt={links:[{input:"port-1",output:"node-2"},{input:"port-1",output:"ebac3f07-598e-4e2f-9e81-e67e542322d8"},{input:"node-5-port-1",output:"node-2"},{input:"node-1-port-1",output:"node-5"},{input:"node-5-port-2",output:"node-4"},{input:"node-4-port-3",output:"node-3"}],nodes:[{id:"node-1",coordinates:[100,100],inputs:[],outputs:[{id:"node-1-port-1",isLinked:!0}],type:"nodeTypeSingleOutputs",data:{inputValue:"defaultValue"}},{id:"node-2",coordinates:[600,100],type:"nodeTypeSingleInputs",inputs:[{id:"node-2-port-1",isLinked:!1}],outputs:[],data:{inputValue:"test"}},{id:"node-3",coordinates:[850,297],type:"nodeTypeNoInputOutput",inputs:[],outputs:[],data:{inputValue:"test"}},{id:"node-4",coordinates:[600,297],type:"nodeTypeMultipleInputsOutputs",inputs:[{id:"node-4-port-1",isLinked:!1},{id:"node-4-port-2",isLinked:!1}],outputs:[{id:"node-4-port-3",isLinked:!1},{id:"node-4-port-4",isLinked:!1},{id:"node-4-port-5",isLinked:!1}],data:{inputValue:"test"}},{id:"node-5",coordinates:[350,100],type:"nodeTypeCustomRenderPort",inputs:[],outputs:[{id:"node-5-port-1",isLinked:!1},{id:"node-5-port-2",isLinked:!1}],data:{branchList:[{text:"button-1",id:"d0ce404a"},{text:"button-2",id:"1751249f"}]}}]};new Array(1e3).fill({}).map((function(e,t){return{id:"node-"+t,coordinates:[40*t+200,50*t],inputs:[],outputs:[{id:"port-"+t,isLinked:!1}],type:"nodeTypeInput",data:{inputValue:"defaultValue"}}})),new Array(999).fill({}).map((function(e,t){return{input:"port-"+t,output:"node-"+(t+1)}}));function lt(){var e=function(e){var t=Object(c.useReducer)(We,Object(d.a)(Object(d.a)({},Fe),{},{present:e})),n=Object(l.a)(t,2),o=n[0],a=n[1],r=0!==o.past.length,i=0!==o.future.length,u=Object(c.useCallback)((function(){r&&a({type:"UNDO"})}),[r,a]),s=Object(c.useCallback)((function(){i&&a({type:"REDO"})}),[i,a]),f=Object(c.useCallback)((function(e){return a({type:"SET",newPresent:e})}),[a]),p=Object(c.useCallback)((function(e){return a({type:"SET_WIDTH_HISTORY",newPresent:e})}),[a]),j=Object(c.useCallback)((function(e){return a({type:"ADD_A_HISTORY",newPresent:e})}),[a]),b=Object(c.useCallback)((function(){return a({type:"CLEAR",initialPresent:e})}),[a,e]);return{present:o.present,set:f,setWithHistory:p,addAHistory:j,undo:u,redo:s,clear:b,canUndo:r,canRedo:i}}(dt),t=e.present,n=e.set,a=e.setWithHistory,r=e.addAHistory,i=e.undo,u=e.redo,f=e.canUndo,p=e.canRedo,j=t,b=Object(c.useState)({scale:1,translateX:0,translateY:0}),O=Object(l.a)(b,2),m=O[0],v=O[1],g=Object(c.useState)(),A=Object(l.a)(g,2),x=A[0],C=A[1],k=Object(c.useState)(ct),R=Object(l.a)(k,2),T=R[0],D=R[1],N=Object(c.useRef)(),I=Object(c.useState)([]),E=Object(l.a)(I,2),S=E[0],w=E[1],L=Object(c.useRef)(null),B=Object(c.useRef)(null),H=Object(c.useMemo)((function(){var e;return(null===(e=L.current)||void 0===e?void 0:e.getBoundingClientRect())||{x:0,y:0}}),[L.current]),P=Object(c.useCallback)(Object(y.a)((function(e){v(e)}),20),[v]),Z=Object(c.useCallback)((function(e,t){t?n(e):a(e)}),[n,a]),z=Object(c.useCallback)((function(e){r(e)}),[r]),F=Object(c.useCallback)((function(e){e&&(e=window.event);var t=e.dataTransfer.getData("nodeType"),n=V(e,document.getElementById("diagram-canvas"),m.scale),o=ie(t,n);Z(Object(d.a)(Object(d.a)({},j),{},{nodes:[].concat(Object(s.a)(j.nodes),[o])}))}),[Z,m,j]),W=Object(c.useCallback)((function(e){e.preventDefault()}),[]),X=Ee((function(e){var t=function(e){return{wheelDown:e.deltaY>0,wheelUp:e.deltaY<0}}(e),n=t.wheelDown,o=t.wheelUp,a=m.scale,c=m.translateX,r=m.translateY,i=(e.clientX-H.x-c)*at/a,u=(e.clientY-H.y-r)*at/a;n&&(a-=at,c+=i,r+=u),o&&(a+=at,c-=i,r-=u),a>1||a<.1||v({scale:Number(a.toFixed(2)),translateX:c,translateY:r})})),G=Ee((function(e){var t=function(e){var t=e.deltaX/2,n=e.deltaY/2;return!Q&&M.a.shift&&(t=n,n=0),{deltaX:t,deltaY:n}}(e),n=t.deltaY,o=t.deltaX,a=m.translateX,c=m.translateY;v(Object(d.a)(Object(d.a)({},m),{},{translateX:a-o,translateY:c-n}))})),q=Ee((function(e){var t;(null===(t=L.current)||void 0===t?void 0:t.contains(e.target))&&(e.preventDefault(),e.returnValue=!1,!function(e){return Q?M.a.command||e.ctrlKey:M.a.ctrl}(e)?G(e):X(e))})),J=Ee((function(e){N.current={x:e.clientX,y:e.clientY,relativeX:e.clientX-m.translateX,relativeY:e.clientY-m.translateY},function(e,t){return e.target===t||e.target===(null===t||void 0===t?void 0:t.firstChild)}(e,L.current)&&(T===rt?D(it):(D(ut),w([])))})),_=Object(c.useCallback)(Object(y.a)((function(e){if(N.current&&L.current){C({left:Math.min(e.clientX,N.current.x)-H.x,top:Math.min(e.clientY,N.current.y)-H.y,width:Math.abs(e.clientX-N.current.x),height:Math.abs(e.clientY-N.current.y)});var t=B.current,n=j.nodes.map((function(e){return e.id})).filter((function(e){return function(e,t){if(e&&t){var n=e.getBoundingClientRect(),o=t.getBoundingClientRect(),a=Math.max(n.x+n.width,o.x+o.width),c=Math.max(n.y+n.height,o.y+o.height),r=Math.min(n.x,o.x),i=Math.min(n.y,o.y);return a-r<=n.width+o.width&&c-i<=n.height+o.height}return!1}(t,document.getElementById(e))}));w(n)}}),20),[m,j]),$=Ee((function(e){D(T===it?rt:ct),C(void 0),N.current=void 0})),ee=Ee((function(e){T===it&&N.current&&P(Object(d.a)(Object(d.a)({},m),{},{translateX:e.clientX-N.current.relativeX,translateY:e.clientY-N.current.relativeY})),T===ut&&_(e)})),te=Ee((function(e){M.a.isPressed("space")&&("keydown"===e.type&&T===ct&&D(rt),"keyup"===e.type&&D(ct))})),oe=Ee((function(e){U(L.current)&&(e.preventDefault(),w(j.nodes.map((function(e){return e.id}))))})),ae=Ee((function(){if(U(L.current)&&S.length){var e=Object(d.a)({},j);S.forEach((function(t){e=K(e,t)})),Z(e)}})),ce=Ee((function(e){if(U(L.current)&&S.length){e.preventDefault();var t=function(e,t){var n,o,a=e.nodes.filter((function(e){return t.includes(e.id)})),c=(null===(n=Object(Ue.a)(a,"coordinates[0]"))||void 0===n?void 0:n.coordinates[0])||0,r=(null===(o=Object(Ue.a)(a,"coordinates[1]"))||void 0===o?void 0:o.coordinates[1])||0;return{nodes:a.map((function(e){return Object(d.a)(Object(d.a)({},e),{},{coordinates:[e.coordinates[0]-c,e.coordinates[1]-r]})})),links:e.links}}(j,S);e.clipboardData.setData("text/json",JSON.stringify(t))}})),re=Ee((function(e){if(U(L.current)){e.preventDefault();var t=L.current?function(e,t){var n=e.scale,o=e.translateX,a=e.translateY,c=Y(t);return{x:-o/n+c.width/n/3,y:-a/n+c.height/n/2}}(m,L.current):{x:20,y:20},n=e.clipboardData.getData("text/json");if(n){var o=function(e,t){var n=e.links;return{nodes:e.nodes.map((function(e){var o=Object(ne.a)(),a=[e.coordinates[0]+t.x,e.coordinates[1]+t.y];return n=Qe(n,e.id,o),Object(d.a)(Object(d.a)({},e),{},{coordinates:a,inputs:e.inputs.map((function(e){var t=Object(ne.a)();return n=Qe(n,e.id,t),Object(d.a)(Object(d.a)({},e),{},{id:t})})),outputs:e.outputs.map((function(e){var t=Object(ne.a)();return n=Qe(n,e.id,t),Object(d.a)(Object(d.a)({},e),{},{id:t})})),id:o})})),links:n.filter((function(e){return e.inputUpdated&&e.outputUpdated})).map((function(e){e.inputUpdated,e.outputUpdated;var t=Object(h.a)(e,["inputUpdated","outputUpdated"]);return Object(d.a)({},t)}))}}(JSON.parse(n),t);Z({links:[].concat(Object(s.a)(j.links),Object(s.a)(o.links)),nodes:[].concat(Object(s.a)(j.nodes),Object(s.a)(o.nodes))})}}})),ue=Ee((function(e){var t=Object(s.a)(S),n=t.findIndex((function(t){return t===e}));n>-1?t.splice(n,1):t=[].concat(Object(s.a)(t),[e]),w(t)})),se=Object(c.useMemo)((function(){return st[T]}),[T]),de=Object(c.useMemo)((function(){return T!==ut}),[T]),le=Object(c.useMemo)((function(){return{left:null===x||void 0===x?void 0:x.left,top:null===x||void 0===x?void 0:x.top,width:null===x||void 0===x?void 0:x.width,height:null===x||void 0===x?void 0:x.height}}),[x]);return Object(tt.a)("ctrl+z, cmd+z",i,{},[i]),Object(tt.a)("ctrl+shift+z, cmd+shift+z",u,{},[u]),Object(tt.a)("ctrl+a, cmd+a",oe,{},[oe]),Object(tt.a)("del, backspace",ae,{},[ae]),Object(tt.a)("*",te,{keyup:!0,keydown:!0},[te]),ot("wheel",q,null,{passive:!1}),ot("mouseup",$),ot("mousemove",ee),ot("mousedown",J),ot("copy",ce),ot("paste",re),Object(o.jsxs)(o.Fragment,{children:[Object(o.jsxs)("div",{id:"diagram-panel",ref:L,className:"diagram-panel",onDrop:F,onDragEnter:W,onDragOver:W,tabIndex:1,style:{cursor:se},children:[Object(o.jsx)(ze,{value:j,transform:m,onChange:Z,onAddHistory:z,activeNodeIds:S,onToggleActiveNodeId:ue}),Object(o.jsx)("div",{ref:B,className:"diagram-selection-area",hidden:de,style:le})]}),Object(o.jsx)(_e,{undo:i,redo:u,canUndo:f,scale:m.scale,canRedo:p}),Object(o.jsx)(et,{})]})}var ft=Object(c.memo)(lt),pt=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,172)).then((function(t){var n=t.getCLS,o=t.getFID,a=t.getFCP,c=t.getLCP,r=t.getTTFB;n(e),o(e),a(e),c(e),r(e)}))};u.a.render(Object(o.jsx)(r.a.StrictMode,{children:Object(o.jsx)(ft,{})}),document.getElementById("root")),pt()},61:function(e,t,n){}},[[153,1,2]]]);
//# sourceMappingURL=main.eb071c3b.chunk.js.map